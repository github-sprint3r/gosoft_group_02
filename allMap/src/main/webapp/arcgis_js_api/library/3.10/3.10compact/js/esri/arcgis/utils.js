// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.10/js/esri/copyright.txt for details.
//>>built
require({cache:{"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(p,f,l,r,q,g,e,c){p=p(e,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(b){this._url.path+="/identify";this._handler=f.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(b,d,u,e,m){try{var h=new c(b);this._successHandler([h],
"onComplete",u,m)}catch(k){this._errorHandler(k,e,m)}},execute:function(b,d,c,e){var m=e.assembly;b=this._encode(f.mixin({},this._url.query,{f:"json"},b.toJson(m&&m[0])));var h=this._handler,k=this._errorHandler;return q({url:this._url.path,content:b,callbackParamName:"callback",load:function(a,n){h(a,n,d,c,e.dfd)},error:function(a){k(a,c,e.dfd)}})},onComplete:function(){}});g._createWrappers(p);l("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyTask",p,r);return p})},"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),
function(p,f,l,r,q,g,e,c,b,d){p=p([b],{declaredClass:"esri.layers._OnDemandMode",constructor:function(b){this.featureLayer=b;this._featureMap={};this._queryErrorHandler=l.hitch(this,this._queryErrorHandler)},initialize:function(b){this.inherited(arguments);var c=this.featureLayer,m=c._srInfo;this._gridLayer=new d(new e(m?m.valid[0]:b.extent.xmin,b.extent.ymax,b.spatialReference),{width:c._tileWidth,height:c._tileHeight},{width:b.width,height:b.height},m);this._cellMap={};this._gridLayer.setResolution(b.extent)},
startup:function(){this._ioQueue=[];this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(b){this._init&&(2>b?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this.inherited(arguments)},drawFeature:function(b){var d=this._gridLayer,c=b.geometry,h=[];if(c)for(var h=
d.getCellsInExtent("point"===c.type?{xmin:c.x,ymin:c.y,xmax:c.x,ymax:c.y}:c.getExtent(),!1).cells,d=this._cellMap,k,a=b.attributes[this.featureLayer.objectIdField],n,s,v,c=0;c<h.length;c++)k=h[c],n=k.latticeID,s=k.row,v=k.col,n?k=d[n]=d[n]||k:(d[s]=d[s]||{},k=d[s][v]=d[s][v]||k),k.features=k.features||[],k.features.push(b),this._addFeatureIIf(a,b),this._incRefCount(a)},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},
refresh:function(){this._zoomHandler()},_enableConnectors:function(){var b=this.map;this._zoomConnect=f.connect(b,"onZoomEnd",this,this._zoomHandler);this._panConnect=f.connect(b,"onPanEnd",this,this._panHandler);this._resizeConnect=f.connect(b,"onResize",this,this._panHandler)},_disableConnectors:function(){f.disconnect(this._zoomConnect);f.disconnect(this._panConnect);f.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var b=this.featureLayer,d=this.map;b.suspended||
(b._fireUpdateStart(),this._clearIIf(),(b=b._trackManager)&&b.clearTracks(),this._cellMap={},this._gridLayer.setResolution(d.extent),this._sendRequest())},_panHandler:function(b){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&b)},_getRequestId:function(b,d){return("_"+b.name+b.layerId+b._ulid+"_"+d.resolution+"_"+(d.latticeID||d.row+"_"+d.col)).replace(/[^a-zA-Z0-9\_]+/g,"_")},_sendRequest:function(b){this._exceeds=!1;var d=this.featureLayer,e=this.map;b=b||e.extent;
e=this._gridLayer.getCellsInExtent(b,d.latticeTiling).cells;if(!d.isEditable())var h=this._cellMap,e=r.filter(e,function(a){if(a.lattice){if(h[a.latticeID])return!1}else if(h[a.row]&&h[a.row][a.col])return!1;return!0});var k=d.getOutFields(),a=d.getDefinitionExpression(),n=d._getOffsettedTE(d._mapTimeExtent),s=d.supportsAdvancedQueries?d.getOrderByFields():null,v=d._usePatch,t=this._ioQueue,y,x=this,A=this._drawFeatures,z,B,C;this._pending=this._pending||0;for(y=0;y<e.length;y++){z=e[y];B=new c;B.geometry=
z.extent||z.lattice;B.outFields=k;B.where=a;d.latticeTiling&&z.extent&&(B.spatialRelationship=c.SPATIAL_REL_CONTAINS);B.returnGeometry=!0;B.timeExtent=n;B.maxAllowableOffset=d._maxOffset;d._ts&&(B._ts=(new Date).getTime());B.orderByFields=s;B.multipatchOption=d.multipatchOption;C=null;if(v&&(C=this._getRequestId(d,z),this._isPending(C)))continue;this._pending++;t.push(d._task.execute(B,function(){var a=z;return function(n){A.apply(x,[n,a])}}.call(this),this._queryErrorHandler,C))}this._removeOldCells(b);
this._endCheck()},_drawFeatures:function(b,d){this._exceeds=this._exceeds||b.exceededTransferLimit;this._finalizeIO();var c=this.map.extent,h=d.extent,k=d.row,a=d.col,n=this.featureLayer.objectIdField,s=b.features,v=this._gridLayer,t=this._cellMap,y=d.latticeID,x=y?t[y]:t[k]&&t[k][a];if(d.resolution!=v._resolution||(y?y!==v.getLatticeID(c):!v.intersects(h,c)))x&&this._removeCell(k,a,y);else if(x)this._updateCell(x,s);else{d.features=s;y?t[y]=d:(t[k]=t[k]||{},t[k][a]=d);h=s.length;for(c=0;c<h;c++)k=
s[c],a=k.attributes[n],this._addFeatureIIf(a,k),this._incRefCount(a)}this._endCheck()},_queryErrorHandler:function(b){this._finalizeIO();this.featureLayer._errorHandler(b);this._endCheck(!0)},_finalizeIO:function(){this._purgeRequests();this._pending--},_endCheck:function(b){if(0===this._pending){this._processIOQueue();var d=this.featureLayer,c=d._trackManager;c&&(c.clearTracks(),c.addFeatures(d.graphics),d._ager&&r.forEach(d.graphics,function(b){b._shape&&d._repaint(b)}),c.moveLatestToFront(),c.drawTracks());
this.featureLayer._fireUpdateEnd(b&&Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)d.onQueryLimitExceeded()}},_processIOQueue:function(b){this._ioQueue=r.filter(this._ioQueue,function(b){return-1<b.fired?!1:!0});b&&r.forEach(this._ioQueue,this._cancelPendingRequest)},_removeOldCells:function(b){var d=this._cellMap,c=this._gridLayer,h,k;for(h in d)if(d[h]){var a=d[h],n=a.latticeID,s=0,v=0;if(n)s++,n!==c.getLatticeID(b)&&
(this._removeCell(null,null,n),v++);else for(k in a)a[k]&&(s++,c.intersects(a[k].extent,b)||(this._removeCell(h,k),v++));v===s&&delete d[h]}},_updateCell:function(b,d){var c=this.featureLayer,h=c.objectIdField,c=c._selectedFeatures,k,a=d.length;b.features=b.features||[];for(k=0;k<a;k++){var n=d[k],s=n.attributes[h],v=this._addFeatureIIf(s,n);v===n?(this._incRefCount(s),b.features.push(v)):s in c||(v.setGeometry(n.geometry),v.setAttributes(n.attributes))}},_removeCell:function(b,d,c){var h=this._cellMap,
k=this.featureLayer,a=k.objectIdField,n=c?h[c]:h[b]&&h[b][d];if(n){c?delete h[c]:delete h[b][d];b=n.features;for(d=0;d<b.length;d++)c=b[d].attributes[a],this._decRefCount(c),c in k._selectedFeatures||this._removeFeatureIIf(c)}}});q("extend-esri")&&l.setObject("layers._OnDemandMode",p,g);return p})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(p,f,l,r,q,g){return p([g,q],{_onMap:function(e){var c=
this.constructor._onMap,b;if(!c||!c.FINAL)delete this.constructor._onMap,c=this.registerConnectEvents(),c.FINAL=!0;e=e.toLowerCase();c[e]?b=this[c[e].method]:(e=this._onCamelCase(e),this[e]&&(b=e));return b},on:function(e,c){var b=this._onMap(e),d=e.replace(/\-/g,""),f="on"+d in this.domNode;return b||!f?this.inherited(arguments):this.own(r(this.domNode,d,c))[0]},emit:function(e,c,b){var d,g,l,m=e.toLowerCase(),h=this.constructor._onMap||this.registerConnectEvents();g=this[this._onMap(m)];c=c||{};
c.target||(c.target=this);g&&(h&&h[m])&&(this._onObj2Arr(function(){d=Array.prototype.slice.call(arguments)},h[m].argKeys)(c),l=f.mixin({},arguments),l[2]=d,l[0]=h[m].name.replace(/^on/,""));return this.inherited(l||arguments)}})})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(p,f,l,r,q,g,e){var c={_isElementShown:function(b){var d=r.get(b);return"hidden"!=d.visibility&&"collapsed"!=d.visibility&&"none"!=
d.display&&"hidden"!=l.get(b,"type")},hasDefaultTabStop:function(b){switch(b.nodeName.toLowerCase()){case "a":return l.has(b,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var d;try{var c=b.contentDocument;if("designMode"in c&&"on"==c.designMode)return!0;d=c.body}catch(e){try{d=b.contentWindow.document.body}catch(f){return!1}}return d&&("true"==d.contentEditable||d.firstChild&&"true"==d.firstChild.contentEditable);default:return"true"==
b.contentEditable}},isTabNavigable:function(b){return l.get(b,"disabled")?!1:l.has(b,"tabIndex")?0<=l.get(b,"tabIndex"):c.hasDefaultTabStop(b)},_getTabNavigable:function(b){function d(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&a.name&&a.name.toLowerCase()}var e,f,m,h,k,a,n={},s=c._isElementShown,v=c.isTabNavigable,t=function(b){for(b=b.firstChild;b;b=b.nextSibling)if(!(1!=b.nodeType||9>=g("ie")&&"HTML"!==b.scopeName||!s(b))){if(v(b)){var c=+l.get(b,"tabIndex");
if(!l.has(b,"tabIndex")||0==c)e||(e=b),f=b;else if(0<c){if(!m||c<h)h=c,m=b;if(!k||c>=a)a=c,k=b}c=d(b);l.get(b,"checked")&&c&&(n[c]=b)}"SELECT"!=b.nodeName.toUpperCase()&&t(b)}};s(b)&&t(b);return{first:n[d(e)]||e,last:n[d(f)]||f,lowest:n[d(m)]||m,highest:n[d(k)]||k}},getFirstInTabbingOrder:function(b,d){var e=c._getTabNavigable(f.byId(b,d));return e.lowest?e.lowest:e.first},getLastInTabbingOrder:function(b,d){var e=c._getTabNavigable(f.byId(b,d));return e.last?e.last:e.highest}};q.mixin(e,c);return c})},
"esri/layers/ServiceGeneratedFeatureCollection":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/webMercatorUtils ../renderers/SimpleRenderer ./layer ./FeatureLayer ../dijit/PopupTemplate".split(" "),function(p,f,l,r,q,g,e,c,b,d,u,w,m,h,k){p=p([m],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",constructor:function(a,n){this.pointSymbol=n&&
n.pointSymbol;this.polylineSymbol=n&&n.polylineSymbol;this.polygonSymbol=n&&n.polygonSymbol;this._outSR=n&&(n.outSpatialReference||n.outSR)||new b({wkid:4326});this._options=l.mixin({},n)},parse:function(){console.error("parse function has not been implemented")},getFeatureLayers:function(){var a=[];this._fLayers&&(a=a.concat(this._fLayers));return a},onRefresh:function(){},onOpacityChange:function(){},refresh:function(){this.loaded&&(this._map&&!this._io&&this.visible)&&this._createLayer()},_createLayer:function(a){var n=
this;this._fireUpdateStart();a=this.parse(a);a.addCallback(function(a){n._io=null;n._initLayer(a)});a.addErrback(function(a){n._io=null;a=l.mixin(Error(),a);a.message="Unable to load resource: "+n.url+" "+(a.message||"");n._fireUpdateEnd(a);n.onError(a)})},_initLayer:function(a){this.loaded&&this._removeInternalLayers();this.name=a.name;this.description=a.description;this.snippet=a.snippet;this.defaultVisibility=void 0!==a.visibility?this.visible=!!a.visibility:this.visible=!0;this.featureInfos=a.featureInfos;
this.fullExtent=this.initialExtent=new d(a.lookAtExtent);this.copyright=a.author||a.copyright;var n;if((a=l.getObject("featureCollection.layers",!1,a))&&0<a.length)this._fLayers=[],r.forEach(a,function(a,b){var d=l.getObject("featureSet.features",!1,a);d&&0<d.length&&(n=l.mixin({outFields:["*"],infoTemplate:a.popupInfo?new k(a.popupInfo):null,editable:!1},this._options),n.id&&(n.id=n.id+"_"+b),a.layerDefinition.capabilities="Query,Data",d=new h(a,n),d.geometryType&&(this["_"+d.geometryType]=d),this._fLayers.push(d))},
this),0===this._fLayers.length&&delete this._fLayers;this.items=[];this._esriGeometryPoint&&(this.items=this.items.concat(this._esriGeometryPoint.graphics),this.pointSymbol&&(a=new w(this.pointSymbol),this._esriGeometryPoint.setRenderer(a)));this._esriGeometryPolyline&&(this.items=this.items.concat(this._esriGeometryPolyline.graphics),this.polylineSymbol&&(a=new w(this.polylineSymbol),this._esriGeometryPolyline.setRenderer(a)));this._esriGeometryPolygon&&(this.items=this.items.concat(this._esriGeometryPolygon.graphics),
this.polygonSymbol&&(a=new w(this.polygonSymbol),this._esriGeometryPolygon.setRenderer(a)));this._fireUpdateEnd();this.loaded&&(this._addInternalLayers(),this.onRefresh())},_addInternalLayers:function(){var a=this._map;this._fireUpdateStart();var n=a.spatialReference,b=this._outSR,d;if(n.wkid)d=n._isWebMercator()&&b._isWebMercator()||n.wkid===b.wkid;else if(n.wkt)d=n.wkt===b.wkt;else{console.log("_setMap - map has invalid spatial reference");return}if(!d)if(n._isWebMercator()&&4326===b.wkid)this._converter=
u.geographicToWebMercator;else if(b._isWebMercator()&&4326===n.wkid)this._converter=u.webMercatorToGeographic;else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return}(n=this._fLayers)&&0<n.length&&r.forEach(n,function(n){if(this._converter){var b=n.graphics,d,c,s=b?b.length:0;for(d=0;d<s;d++)(c=b[d].geometry)&&b[d].setGeometry(this._converter(c))}a.addLayer(n)},this);this.setVisibility(this.visible);
this._fireUpdateEnd()},_removeInternalLayers:function(){var a=this._map;a&&r.forEach(this.getFeatureLayers(),a.removeLayer,a)},setScaleRange:function(a,n){this.inherited(arguments);r.forEach(this.getFeatureLayers(),function(b){b.setScaleRange(a,n)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale},setOpacity:function(a){this.opacity!=a&&(r.forEach(this.getFeatureLayers(),function(n){n.setOpacity(a)}),this.opacity=this._options.opacity=a,this.onOpacityChange(a))},onVisibilityChange:function(a){this._fireUpdateStart();
r.forEach(this.getFeatureLayers(),function(n){n.setVisibility(a)});this._fireUpdateEnd()},_setMap:function(a,n){this.inherited(arguments);this._map=a;var b=this._div=q.create("div",null,n);g.set(b,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return b},_unsetMap:function(a,n){this._io&&this._io.cancel();f.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var b=this._div;b&&(n.removeChild(b),q.destroy(b));this._div=null;this.inherited(arguments)}});
e("extend-esri")&&l.setObject("layers._ServiceGeneratedFeatureCollection",p,c);return p})},"esri/layers/GeoRSSLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../config ../request ./ServiceGeneratedFeatureCollection".split(" "),function(p,f,l,r,q,g,e,c){p=p([c],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(b,d){g.defaults.geoRSSService&&(this.serviceUrl=g.defaults.geoRSSService);
this._createLayer()},parse:function(){return this._io=e({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?!0:void 0,outSR:this._outSR?l.toJson(this._outSR.toJson()):void 0},callbackParamName:"callback"})},_initLayer:function(b){this.inherited(arguments);this.loaded||(this.loaded=!0,this.onLoad(this))}});r("extend-esri")&&f.setObject("layers.GeoRSSLayer",p,q);return p})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../tasks/query ./RenderMode".split(" "),
function(p,f,l,r,q,g,e,c){p=p([c],{declaredClass:"esri.layers._StreamMode",constructor:function(b){console.log("entering 'stream' mode...");this.featureLayer=b;this._featureMap={};this._drawFeatures=f.hitch(this,this._drawFeatures);this._queryErrorHandler=f.hitch(this,this._queryErrorHandler)},startup:function(){this.featureLayer._collection?console.log("Feature layer is a collection"):this._fetchArchive()},propertyChangeHandler:function(b){this._init&&(b?console.debug("StreamLayer: Stream Layer only supports changing map time. Layer id \x3d "+
this.featureLayer.id):this._applyTimeFilter())},drawFeature:function(b){b.visible=this._checkFeatureTimeIntersects(b);this._addTrackedFeature(b)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var b=this.featureLayer;b._collection?(b._fireUpdateStart(),b._refresh(!0),b._fireUpdateEnd()):this._fetchArchive()},_drawFeatures:function(b){this._purgeRequests();b=b.features||[];var d=this.featureLayer.objectIdField,c,e=b.length,f,h;for(c=0;c<e;c++)f=b[c],h=f.attributes[d],this._addFeatureIIf(h,
f),this._incRefCount(h);this._applyTimeFilter(!0)},_applyTimeFilter:function(b){var d=this.featureLayer._trackManager,c;this.inherited(arguments);if(d&&(c=d.trimTracks())&&0<c.length)this._removeFeatures(c),d.refreshTracks()},_addTrackedFeature:function(b){var d=this.featureLayer,c=d._trackManager,e,f=b.attributes[d.objectIdField],h;c&&b.visible&&(c.addFeatures([b]),e=b.attributes[d._trackIdField],h=c.trimTracks([e]));this._addFeatureIIf(f,b);this._incRefCount(f);e&&(this._removeFeatures(h),c.refreshTracks([e]))},
_removeFeatures:function(b){var d=this.featureLayer,c=d.objectIdField;b&&l.forEach(b,function(b){b=b.attributes[c];d._unSelectFeatureIIf(b,this);this._decRefCount(b);this._removeFeatureIIf(b)},this)},_checkFeatureTimeIntersects:function(b){var d=this.featureLayer,c=d.getMap().timeExtent;return!c||!d.timeInfo||!d.timeInfo.startTimeField&&!d.timeInfo.endTimeField?!0:0<d._filterByTime([b],c.startTime,c.endTime).match.length},_fetchArchive:function(){console.log("Stream layer archiving not supported")},
_queryErrorHandler:function(b){this._purgeRequests();var d=this.featureLayer;d._errorHandler(b);d._fireUpdateEnd(b)}});r("extend-esri")&&f.setObject("layers._StreamMode",p,q);return p})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/StatisticDefinition dojo/i18n!dojo/cldr/nls/number".split(" "),function(p,f,l,r,q,g,
e,c,b,d,u,w,m,h,k,a){p=p(null,{declaredClass:"esri.PopupInfo",initialize:function(a,b){if(a){f.mixin(this,b);this.info=a;this.title=this.getTitle;this.content=this.getContent;var d=this._fieldLabels={},c=this._fieldsMap={};a.fieldInfos&&l.forEach(a.fieldInfos,function(a){d[a.fieldName]=a.label;c[a.fieldName]=a});this._relatedFieldPrefix="relationships/";this.titleHasRelatedFields=!!(a.title&&-1!==a.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return r.fromJson(r.toJson(this.info))},
getTitle:function(){},getContent:function(){},getComponents:function(a){var b=this.info,d=new e,c,k;b.fieldInfos&&(k=l.filter(b.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this));k&&0<k.length&&(c=this._getRelatedRecords({graphic:a,fieldsInfo:k}));c?c.then(f.hitch(this,function(){d.resolve(this._getPopupValues(a))}),f.hitch(this,this._handlerErrorResponse,c)):d.resolve(this._getPopupValues(a));return d.promise},_getPopupValues:function(a,b){var c=this.info,k=a.getLayer(),
e=f.clone(a.attributes)||{},h=f.clone(e),A=c.fieldInfos,z="",B="",C,H,I,g,m,q=k&&k._getDateOpts&&k._getDateOpts().properties,u={dateFormat:{properties:q,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};if(this._relatedInfo)for(g in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(g)){var w=this._relatedInfo[g],r=this._relatedLayersInfo[g];w&&(l.forEach(w.relatedFeatures,function(a){for(m in a.attributes)if(a.attributes.hasOwnProperty(m)&&"esriRelCardinalityOneToOne"===
r.relation.cardinality){var b=this._toRelatedFieldName([r.relation.id,m]);e[b]=h[b]=a.attributes[m]}},this),l.forEach(w.relatedStatsFeatures,function(a){for(m in a.attributes)if(a.attributes.hasOwnProperty(m)){var b=this._toRelatedFieldName([r.relation.id,m]);e[b]=h[b]=a.attributes[m]}},this))}A&&l.forEach(A,function(a){H=a.fieldName;h[H]=this._formatValue(h[H],H,u);q&&(a.format&&a.format.dateFormat)&&(a=l.indexOf(q,H),-1<a&&q.splice(a,1))},this);if(k){g=k.types;var p=(w=k.typeIdField)&&e[w];for(H in e)if(e.hasOwnProperty(H)&&
-1===H.indexOf(this._relatedFieldPrefix)&&(I=e[H],d.isDefined(I))){var E=this._getDomainName(k,g,p,H,I);d.isDefined(E)?h[H]=E:H===w&&(E=this._getTypeName(k,I),d.isDefined(E)&&(h[H]=E))}}c.title&&(z=this._processFieldsInLinks(this._fixTokens(c.title),e),z=f.trim(d.substitute(h,z,u)||""));if(b)return{title:z};c.description&&(B=this._processFieldsInLinks(this._fixTokens(c.description),e),B=f.trim(d.substitute(h,B,u)||""));A&&(C=[],l.forEach(A,function(a){(H=a.fieldName)&&a.visible&&C.push([a.label||
H,d.substitute(h,"${"+H+"}",u)||""])}));var Q,N;c.mediaInfos&&(Q=[],l.forEach(c.mediaInfos,function(a){N=0;I=a.value;switch(a.type){case "image":var b=I.sourceURL,b=b&&f.trim(d.substitute(e,this._fixTokens(b)));N=!!b;break;case "piechart":case "linechart":case "columnchart":case "barchart":N=l.some(I.fields,function(a){return d.isDefined(e[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(N){a=f.clone(a);I=a.value;var b=a.title?this._processFieldsInLinks(this._fixTokens(a.title),
e):"",n=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption),e):"";a.title=b?f.trim(d.substitute(h,b,u)||""):"";a.caption=n?f.trim(d.substitute(h,n,u)||""):"";if("image"===a.type)I.sourceURL=d.substitute(e,this._fixTokens(I.sourceURL)),I.linkURL&&(I.linkURL=f.trim(d.substitute(e,this._fixTokens(I.linkURL))||""));else{var c,k;l.forEach(I.fields,function(a,b){if(-1!==a.indexOf(this._relatedFieldPrefix))k=this._getRelatedChartInfos(a,I,e,u),k instanceof Array?I.fields=k:I.fields[b]=k;else{var n=
e[a],n=void 0===n?null:n;c=e[I.normalizeField]||0;n&&c&&(n/=c);I.fields[b]={y:n,tooltip:(this._fieldLabels[a]||a)+":\x3cbr/\x3e"+this._formatValue(n,a,u,!!c)}}},this)}Q.push(a)}},this));return{title:z,description:B,fields:C&&C.length?C:null,mediaInfos:Q&&Q.length?Q:null,formatted:h,editSummary:k&&k.getEditSummary?k.getEditSummary(a):""}},_getRelatedChartInfos:function(a,b,d,c){var k,e,h,z,f,C;k=[];C=this._fromRelatedFieldName(a);f=C[0];e=this._relatedInfo[f];f=this._relatedLayersInfo[f];e&&l.forEach(e.relatedFeatures,
function(e){e=e.attributes;var x,f;for(f in e)if(e.hasOwnProperty(f)&&f===C[1]){x={};z=e[f];b.normalizeField&&(h=-1!==b.normalizeField.indexOf(this._relatedFieldPrefix)?e[this._fromRelatedFieldName(b.normalizeField)[1]]:d[b.normalizeField]);z&&h&&(z/=h);if(b.tooltipField)if(-1!==b.tooltipField.indexOf(this._relatedFieldPrefix)){var g=this._fromRelatedFieldName(b.tooltipField)[1];x.tooltip=e[g]+":\x3cbr/\x3e"+this._formatValue(z,e[g],c,!!h)}else x.tooltip=(this._fieldLabels[a]||a)+":\x3cbr/\x3e"+this._formatValue(z,
b.tooltipField,c,!!h);else x.tooltip=z;x.y=z;k.push(x)}},this);return"esriRelCardinalityOneToMany"===f.relation.cardinality||"esriRelCardinalityManyToMany"===f.relation.cardinality?k:k[0]},getAttachments:function(a){var b=a.getLayer();a=a.attributes;if(this.info.showAttachments&&(b&&b.hasAttachments&&b.objectIdField)&&(a=a&&a[b.objectIdField]))return b.queryAttachmentInfos(a)},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",
longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",
year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"[^\"]+\"/ig,_fixTokens:function(a){return a.replace(/(\{[^\{\r\n]+\})/g,"$$$1")},_processFieldsInLinks:function(a,b){return a&&a.replace(this._reHref,function(a){return a=d.substitute(b,a)})},_formatValue:function(b,c,k,e){var h=this._fieldsMap[c],x=h&&h.format;c="number"===typeof b&&-1===l.indexOf(k.dateFormat.properties,c)&&(!x||!x.dateFormat);if(!d.isDefined(b)||!h||!d.isDefined(x))return c?this._forceLTR(b):b;var f="",z=[],h=x.hasOwnProperty("places")||
x.hasOwnProperty("digitSeparator"),g=x.hasOwnProperty("digitSeparator")?x.digitSeparator:!0;if(h)f="NumberFormat",z.push("places: "+(d.isDefined(x.places)&&(!e||0<x.places)?Number(x.places):"Infinity")),z.length&&(f+="("+z.join(",")+")");else if(x.dateFormat)f="DateFormat"+this._insertOffset(this._dateFormats[x.dateFormat]||this._dateFormats.shortDateShortTime);else return c?this._forceLTR(b):b;b=d.substitute({myKey:b},"${myKey:"+f+"}",k)||"";h&&!g&&a.group&&(b=b.replace(RegExp("\\"+a.group,"g"),
""));return c?this._forceLTR(b):b},_forceLTR:function(a){var b=c("ie");return b&&10>=b?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=d.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,b,c,k,e){var h,f;b&&d.isDefined(c)&&l.some(b,function(b){if(b.id==c){if((h=b.domains&&b.domains[k])&&"inherited"===h.type)h=this._getLayerDomain(a,k),f=!0;return!0}return!1},this);!f&&!h&&(h=this._getLayerDomain(a,
k));if(h&&h.codedValues){var z;l.some(h.codedValues,function(a){return a.code==e?(z=a.name,!0):!1});return z}},_getLayerDomain:function(a,b){var c=a.fields;if(c){var d;l.some(c,function(a){return a.name===b?(d=a.domain,!0):!1});return d}},_getTypeName:function(a,b){var c=a.types;if(c){var d;l.some(c,function(a){return a.id==b?(d=a.name,!0):!1});return d}},_getRelatedRecords:function(a){var b=a.graphic,c=new e,d;this._relatedLayersInfo?this._queryRelatedLayers(b).then(f.hitch(this,function(a){this._setRelatedRecords(b,
a);c.resolve(a)}),f.hitch(this,this._handlerErrorResponse,c)):this._getRelatedLayersInfo(a).then(f.hitch(this,function(a){for(d in a)a.hasOwnProperty(d)&&a[d]&&(this._relatedLayersInfo[d].relatedLayerInfo=a[d]);this._queryRelatedLayers(b).then(f.hitch(this,function(a){this._setRelatedRecords(b,a);c.resolve(a)}),f.hitch(this,this._handlerErrorResponse,c))}),f.hitch(this,this._handlerErrorResponse,c));return c.promise},_getRelatedLayersInfo:function(a){var c=a.fieldsInfo,d,e,h={};d=a.graphic.getLayer();
this._relatedLayersInfo||(this._relatedLayersInfo={});l.forEach(c,function(a){var b,c,n,C;b=this._fromRelatedFieldName(a.fieldName);c=b[0];b=b[1];c&&(this._relatedLayersInfo[c]||(l.some(d.relationships,function(a){if(a.id==c)return C=a,!0}),C&&(this._relatedLayersInfo[c]={relation:C,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[c]&&(this._relatedLayersInfo[c].relatedFields.push(b),a.statisticType&&(n=new k,n.statisticType=a.statisticType,n.onStatisticField=b,n.outStatisticFieldName=
b,this._relatedLayersInfo[c].outStatistics.push(n))))},this);for(e in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(e)&&this._relatedLayersInfo[e]&&(a=this._relatedLayersInfo[e].relation,a=d.url.replace(/[0-9]+$/,a.relatedTableId),this._relatedLayersInfo[e].relatedLayerUrl=a,h[e]=w({url:a,content:{f:"json"},callbackParamName:"callback"}));return b(h)},_queryRelatedLayers:function(a){var c={},d;for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&(c[d]=this._queryRelatedLayer({graphic:a,
relatedInfo:this._relatedLayersInfo[d]}));return b(c)},_queryRelatedLayer:function(a){var c,d,k,e,f,g,z,B,C,H;c=a.graphic;d=c.getLayer().url.match(/[0-9]+$/g)[0];B=a.relatedInfo;z=B.relatedLayerInfo;C=B.relatedLayerUrl;H=B.relation;l.some(z.relationships,function(a){if(a.relatedTableId===parseInt(d,10))return k=a,!0},this);k&&(a=new m,l.some(z.fields,function(a){if(a.name===k.keyField)return f=-1!==l.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],
a.type)?"number":"string",!0}),e="string"===f?k.keyField+"\x3d'"+c.attributes[H.keyField]+"'":k.keyField+"\x3d"+c.attributes[H.keyField],a.where=e,a.outFields=B.relatedFields,B.outStatistics&&(0<B.outStatistics.length&&z.supportsStatistics)&&(g=new m,g.where=a.where,g.outFields=a.outFields,g.outStatistics=B.outStatistics),c=new h(C),e=[],e.push(c.execute(a)),g&&e.push(c.execute(g)));return b(e)},_setRelatedRecords:function(a,b){this._relatedInfo=[];for(var c in b)if(b.hasOwnProperty(c)&&b[c]){var k=
b[c];this._relatedInfo[c]={};this._relatedInfo[c].relatedFeatures=k[0].features;d.isDefined(k[1])&&(this._relatedInfo[c].relatedStatsFeatures=k[1].features)}},_handlerErrorResponse:function(a,b){a.reject(b);console.log(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b}});g("extend-esri")&&(u.PopupInfo=u.PopupInfoTemplate=
p);return p})},"esri/layers/KMLLayer":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style ../kernel ../config ../lang ../request ../SpatialReference ../geometry/webMercatorUtils ../dijit/PopupTemplate ./layer ./KMLFolder ./KMLGroundOverlay ./MapImageLayer ./FeatureLayer".split(" "),function(p,f,l,r,q,g,e,c,b,d,u,w,m,h,k,a,n,s,v,t,y,x){var A=f([s],{declaredClass:"esri.layers.KMLLayer",
serviceUrl:location.protocol+"//utility.arcgis.com/sharing/kml",constructor:function(a,b){a||console.log("KMLLayer:constructor - please provide url for the KML file");this._outSR=b&&b.outSR||new k({wkid:4326});this._options=r.mixin({},b);w.defaults.kmlService&&(this.serviceUrl=w.defaults.kmlService);var c=this.linkInfo=b&&b.linkInfo;c&&(this.visible=!!c.visibility,this._waitingForMap=!!c.viewFormat);(!c||c&&c.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=r.hitch(this,this.refresh);
this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(a){if(a){var b=a.type,c=a.id,d;switch(b){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(a=this["_"+b])&&(d=r.getObject("_mode._featureMap."+c,!1,a));break;case "GroundOverlay":if(a=this._groundLyr){var k=a.getImages(),b=k.length;for(a=0;a<b;a++)if(k[a].id===c){d=k[a];break}}break;case "ScreenOverlay":break;case "NetworkLink":q.some(this._links,function(a){return a.linkInfo&&a.linkInfo.id===
c?(d=a,!0):!1});break;case "Folder":b=(k=this.folders)?k.length:0;for(a=0;a<b;a++)if(k[a].id===c){d=k[a];break}break;default:console.log("KMLLayer:getFeature - unknown feature type")}return d}},getLayers:function(){var a=[];this._groundLyr&&a.push(this._groundLyr);this._fLayers&&(a=a.concat(this._fLayers));this._links&&q.forEach(this._links,function(b){b.declaredClass&&a.push(b)});return a},setFolderVisibility:function(a,b){a&&(this._fireUpdateStart(),(a.visible=b)&&(b=this._areLocalAncestorsVisible(a)),
this._setState(a,b),this._fireUpdateEnd())},onRefresh:function(){},onOpacityChange:function(){},_parseKml:function(a){var b=this;this._fireUpdateStart();this._io=h({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(a),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:g.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(a){b._io=null;b._initLayer(a)},error:function(a){b._io=null;a=r.mixin(Error(),a);a.message="Unable to load KML: "+b.url+" "+
(a.message||"");b._fireUpdateEnd(a);b.onError(a)}})},_initLayer:function(a){this.loaded&&this._removeInternalLayers();this.name=a.name;this.description=a.description;this.snippet=a.snippet;this.visibility=a.visibility;this.featureInfos=a.featureInfos;var b,c,d=this.folders=a.folders,k=[],e;if(d){c=d.length;for(b=0;b<c;b++)e=d[b]=new v(d[b]),-1===e.parentFolderId&&k.push(e)}var d=this._links=a.networkLinks,h;c=d?d.length:0;for(b=0;b<c;b++)d[b].viewRefreshMode&&-1!==d[b].viewRefreshMode.toLowerCase().indexOf("onregion")||
(h=r.mixin({},this._options),h.linkInfo=d[b],h.id&&(h.id=h.id+"_"+b),d[b]=new A(d[b].href,h),d[b]._parentLayer=this,d[b]._parentFolderId=this._getLinkParentId(d[b].linkInfo.id));if((d=a.groundOverlays)&&0<d.length){h=r.mixin({},this._options);h.id&&(h.id+="_mapImage");e=this._groundLyr=new y(h);c=d.length;for(b=0;b<c;b++)e.addImage(new t(d[b]))}if((a=r.getObject("featureCollection.layers",!1,a))&&0<a.length)this._fLayers=[],q.forEach(a,function(a,b){var c=r.getObject("featureSet.features",!1,a);c&&
0<c.length&&(h=r.mixin({outFields:["*"],infoTemplate:a.popupInfo?new n(a.popupInfo):null,editable:!1},this._options),h.id&&(h.id=h.id+"_"+b),a.layerDefinition.capabilities="Query,Data",c=new x(a,h),c.geometryType&&(this["_"+c.geometryType]=c),this._fLayers.push(c))},this),0===this._fLayers.length&&delete this._fLayers;c=k.length;for(b=0;b<c;b++)e=k[b],this._setState(e,e.visible);this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var b=
this._map;this._fireUpdateStart();this._links&&q.forEach(this._links,function(a){a.declaredClass&&(b.addLayer(a),a._waitingForMap&&(a._waitingForMap=null,a.visible?a._parseKml(b):a._wMap=b))});var c=b.spatialReference,d=this._outSR,k;if(!c.equals(d))if(c.isWebMercator()&&4326===d.wkid)k=a.geographicToWebMercator;else if(d.isWebMercator()&&4326===c.wkid)k=a.webMercatorToGeographic;else{console.log("KMLLayer:_setMap - unsupported workflow. Spatial reference of the map and kml layer do not match, and the conversion cannot be done on the client.");
return}this._groundLyr&&(k&&q.forEach(this._groundLyr.getImages(),function(a){a.extent=k(a.extent)}),b.addLayer(this._groundLyr));(c=this._fLayers)&&0<c.length&&q.forEach(c,function(a){if(k){var c=a.graphics,d,n,e=c?c.length:0;for(d=0;d<e;d++)(n=c[d].geometry)&&c[d].setGeometry(k(n))}b.addLayer(a)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var a=this._map;this._links&&q.forEach(this._links,function(a){a.declaredClass&&a._io&&a._io.cancel()});a&&q.forEach(this.getLayers(),
a.removeLayer,a)},_setState:function(a,b){var c=a.featureInfos,d,k,n,e=c?c.length:0,h=b?"show":"hide";for(n=0;n<e;n++)if(d=c[n],k=this.getFeature(d))if("Folder"===d.type)this._setState(k,b&&k.visible);else if("NetworkLink"===d.type)this._setInternalVisibility(k,b);else k[h]()},_areLocalAncestorsVisible:function(a){var b=a.parentFolderId;for(a=a.visible;a&&-1!==b;)b=this.getFeature({type:"Folder",id:b}),a=a&&b.visible,b=b.parentFolderId;return a},_setInternalVisibility:function(a,b){var c=a._parentLayer,
d=a._parentFolderId;for(b=b&&a.visible;b&&c;)b=b&&c.visible,-1<d&&(b=b&&c._areLocalAncestorsVisible(c.getFeature({type:"Folder",id:d}))),d=c._parentFolderId,c=c._parentLayer;this._setIntState(a,b)},_setIntState:function(a,b){a&&q.forEach(a.getLayers(),function(c){c.linkInfo?a._setIntState(c,b&&c.visible&&a._areLocalAncestorsVisible(a.getFeature({type:"Folder",id:c._parentFolderId}))):c.setVisibility(b)})},_getLinkParentId:function(a){var b=-1;this.folders&&q.some(this.folders,function(c){return c.networkLinkIds&&
-1!==q.indexOf(c.networkLinkIds,a)?(b=c.id,!0):!1});return b},_checkAutoRefresh:function(){var a=this.linkInfo;if(a)if(this.visible){if(this.loaded&&this._map){var b=a.refreshMode,c=a.refreshInterval,d=a.viewRefreshMode,a=a.viewRefreshTime;b&&(-1!==b.toLowerCase().indexOf("oninterval")&&0<c)&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*c));d&&(-1!==d.toLowerCase().indexOf("onstop")&&0<a)&&!this._extChgHandle&&(this._extChgHandle=l.connect(this._map,"onExtentChange",this,
this._extentChanged))}}else this._stopAutoRefresh(),l.disconnect(this._extChgHandle),delete this._extChgHandle},_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(b){b=b||this._map;var d={},k=this.linkInfo,n=b&&b.extent,e;this._url.query&&(r.mixin(d,this._url.query),e=!!this._url.query.token);if(u.id&&!e&&(e=u.id.findCredential(this._url.path)))d.token=e.token;if(k){e=k.viewFormat;var h=k.httpQuery,k=k.viewBoundScale;if(n&&e){var f=
n,s=n,g=n.spatialReference;g&&(g.isWebMercator()?f=a.webMercatorToGeographic(n):4326===g.wkid&&(s=a.geographicToWebMercator(n)));n=f.getCenter();s=Math.max(s.getWidth(),s.getHeight());k&&(f=f.expand(k));e=e.replace(/\[bboxWest\]/ig,f.xmin).replace(/\[bboxEast\]/ig,f.xmax).replace(/\[bboxSouth\]/ig,f.ymin).replace(/\[bboxNorth\]/ig,f.ymax).replace(/\[lookatLon\]/ig,n.x).replace(/\[lookatLat\]/ig,n.y).replace(/\[lookatRange\]/ig,s).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,
n.x).replace(/\[lookatTerrainLat\]/ig,n.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,n.x).replace(/\[cameraLat\]/ig,n.y).replace(/\[cameraAlt\]/ig,s).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,b.width).replace(/\[vertPixels\]/ig,b.height).replace(/\[terrainEnabled\]/ig,0);r.mixin(d,c.queryToObject(e))}h&&(h=h.replace(/\[clientVersion\]/ig,u.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,
p.locale),r.mixin(d,c.queryToObject(h)))}b=[];for(var x in d)m.isDefined(d[x])&&b.push(x+"\x3d"+d[x]);return(b=b.join("\x26"))?"?"+b:""},setScaleRange:function(a,b){this.inherited(arguments);q.forEach(this.getLayers(),function(c){c.setScaleRange(a,b)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale},setOpacity:function(a){this.opacity!=a&&(q.forEach(this.getLayers(),function(b){b.setOpacity(a)}),this.opacity=this._options.opacity=a,this.onOpacityChange(a))},_setMap:function(a,
c){this.inherited(arguments);this._map=a;var k=this._div=b.create("div",null,c);d.set(k,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return k},_unsetMap:function(a,c){this._io&&this._io.cancel();this._stopAutoRefresh();l.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var d=this._div;d&&(c.removeChild(d),b.destroy(d));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(a){this.loaded?(this._fireUpdateStart(),
this._setInternalVisibility(this,a),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&a&&(this._waitingForMap||this._parseKml(this._wMap))},refresh:function(){this.loaded&&(this._map&&!this._io&&this.visible)&&this._parseKml()},getFeatureCollection:function(a){var b,c=[];if(a=this.getFeature({type:"Folder",id:a}))(b=q.map(a.featureInfos,function(a){if("esriGeometryPoint"===a.type||"esriGeometryPolyline"===a.type||"esriGeometryPolygon"===a.type)return a.id},this))&&0<b.length&&q.forEach(this._fLayers,
function(a){var d,k;d=a.toJson();d.featureSet.features&&0<d.featureSet.features.length&&(k=q.filter(d.featureSet.features,function(c){if(-1!==q.indexOf(b,c.attributes[a.objectIdField]))return c},this));k&&0<k.length&&(d.featureSet.features=k,c.push(d))},this);return c},getFeatureCount:function(a){a=this.getFeature({type:"Folder",id:a});var b={points:0,polylines:0,polygons:0};a&&q.forEach(a.featureInfos,function(a){"esriGeometryPoint"===a.type&&(b.points+=1);"esriGeometryPolyline"===a.type&&(b.polylines+=
1);"esriGeometryPolygon"===a.type&&(b.polygons+=1)});return b},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});e("extend-esri")&&r.setObject("layers.KMLLayer",A,u);return A})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(p,f,l,r,q,g,e){q.add("highcontrast",function(){var c=e.doc.createElement("div");c.style.cssText="border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("+
(f.blankGif||p.toUrl("./resources/blank.gif"))+");";e.body().appendChild(c);var b=r.getComputedStyle(c),d=b.backgroundImage,b=b.borderTopColor==b.borderRightColor||d&&("none"==d||"url(invalid-url:)"==d);8>=q("ie")?c.outerHTML="":e.body().removeChild(c);return b});g(function(){q("highcontrast")&&l.add(e.body(),"dj_a11y")});return q})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),
function(p,f,l,r,q,g,e){p=p(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(c){var b=c&&c.geometry||this.geometry;c={geometry:b,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?l.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?l.toJson(this.renderingRule.toJson()):
null};b&&(c.geometryType=e.getJsonType(b));b=this.timeExtent;c.time=b?b.toJson().join(","):null;g.isDefined(this.pixelSizeX)&&g.isDefined(this.pixelSizeY)?c.pixelSize=l.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(c.pixelSize=this.pixelSize?l.toJson(this.pixelSize.toJson()):null);return c}});r("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyParameters",p,q);return p})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(p,f,l,r,q,g,e,c,b,d,u,w,m,h,k,a,n,s,v,t,y,x,A){function z(a){return function(b){c[b?"set":"remove"](this.domNode,a,b);this._set(a,b)}}m.add("dijit-legacy-requires",!h.isAsync);m.add("dojo-bidi",!1);m("dijit-legacy-requires")&&n(0,function(){p(["dijit/_base/manager"])});var B={};r=g("dijit._WidgetBase",[s,y],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:z("lang"),dir:"",_setDirAttr:z("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},style:"",title:"",tooltip:"",baseClass:"",
srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:r.blankGif||p.toUrl("dojo/resources/blank.gif"),_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},d;for(d in b.attributeMap)c.push(d);for(d in b)/^on/.test(d)&&(a[d.substring(2).toLowerCase()]=d),/^_set[A-Z](.*)Attr$/.test(d)&&(d=d.charAt(4).toLowerCase()+d.substr(5,d.length-
9),(!b.attributeMap||!(d in b.attributeMap))&&c.push(d))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();this.srcNodeRef=e.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,k.mixin(this,a));this.postMixInProperties();this.id||(this.id=A.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||
(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=t.body(this.ownerDocument);A.add(this);this.buildRendering();var c;if(this.domNode){this._applyAttributes();var d=this.srcNodeRef;d&&(d.parentNode&&this.domNode!==d)&&(d.parentNode.replaceChild(this.domNode,d),c=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();c&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);f.forEach(this.constructor._setterAttrs,
function(b){if(!(b in a)){var c=this._get(b);c&&this.set(b,c)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(f.map(a,function(a){return a+"Rtl"})));b.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,f.forEach(this.getChildren(),function(a){!a._started&&
(!a._destroyed&&k.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();f.forEach(this._connects,k.hitch(this,"disconnect"));f.forEach(this._supportingWidgets,b);this.domNode&&f.forEach(A.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);
A.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?c.remove(this.domNode,"widgetId"):d.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||d.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){f.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;k.isObject(a)?
w.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,d,n){n=3<=arguments.length?n:this.attributeMap[a];f.forEach(k.isArray(n)?n:[n],function(n){var e=this[n.node||n||"domNode"];switch(n.type||"attribute"){case "attribute":k.isFunction(d)&&(d=k.hitch(this,d));n=n.attribute?n.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;e.tagName?c.set(e,n,d):e.set(n,d);break;case "innerText":e.innerHTML="";e.appendChild(this.ownerDocument.createTextNode(d));
break;case "innerHTML":e.innerHTML=d;break;case "class":b.replace(e,d,this[a])}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var d=this[c.s];if(k.isFunction(d))var n=d.apply(this,Array.prototype.slice.call(arguments,1));else{var d=this.focusNode&&!k.isFunction(this.focusNode)?"focusNode":"domNode",e=this[d]&&this[d].tagName,h;if(h=e)if(!(h=
B[e])){h=this[d];var f={},s;for(s in h)f[s.toLowerCase()]=!0;h=B[e]=f}s=h;c=a in this.attributeMap?this.attributeMap[a]:c.s in this?this[c.s]:s&&c.l in s&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?d:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return n||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+c+"Attr",
g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(a,b){var c=this[a];this[a]=b;this._created&&b!==c&&(this._watchCallbacks&&this._watchCallbacks(a,c,b),this.emit("attrmodified-"+a,{detail:{prevValue:c,newValue:b}}))},_get:function(a){return this[a]},emit:function(b,c,d){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var k,n=this["on"+b];n&&(k=n.apply(this,d?d:[c]));this._started&&!this._beingDestroyed&&a.emit(this.domNode,
b.toLowerCase(),c);return k},on:function(b,c){var d=this._onMap(b);return d?l.after(this,d,c,!0):this.own(a(this.domNode,b,c))[0]},_onMap:function(a){var b=this.constructor,c=b._onMap;if(!c){var c=b._onMap={},d;for(d in b.prototype)/^on/.test(d)&&(c[d.replace(/^on/,"").toLowerCase()]=d)}return c["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?A.findWidgets(this.containerNode):
[]},getParent:function(){return A.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,c){return this.own(q.connect(a,b,this,c))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(v.subscribe(a,k.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir:u.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=w.get(this.domNode,"display")},placeAt:function(a,b){var c=!a.tagName&&
A.byId(a);c&&c.addChild&&(!b||"number"===typeof b)?c.addChild(this,b):(c=c?c.containerNode&&!/after|before|replace/.test(b||"")?c.containerNode:c.domNode:e.byId(a,this.ownerDocument),d.place(this.domNode,c,b),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var c=setTimeout(k.hitch(this,function(){c&&(c=null,this._destroyed||k.hitch(this,a)())}),b||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});m("dojo-bidi")&&r.extend(x);
return r})},"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/promise/all ../kernel ../lang ../request ../config ../deferredUtils ../SpatialReference ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./FeatureType ./FeatureTemplate ./FeatureEditResult ./LabelClass ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./TrackManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),
function(p,f,l,r,q,g,e,c,b,d,u,w,m,h,k,a,n,s,v,t,y,x,A,z,B,C,H,I,S,R,Y,ia,aa,D,G,E,Q,N,F,L,X,M,J,P,T,ja,ka,Z,W){var $=v.defaults,K=l(Q,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],
"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(a,b){this._preventInit||this._initFeatureLayer(a,b)},_initFeatureLayer:function(a,b){this.i18n=W;b=b||{};this._outFields=b.outFields;this._loadCallback=b.loadCallback;
var c=b._usePatch;this._usePatch=null===c||void 0===c?!0:c;this._trackIdField=b.trackIdField;this.objectIdField=b.objectIdField;this._maxOffset=null!=b.maxAllowableOffset?b.maxAllowableOffset:this.maxAllowableOffset;this._optEditable=b.editable;this._optAutoGen=b.autoGeneralize;this.editSummaryCallback=b.editSummaryCallback;this.userId=b.userId;this.userIsAdmin=b.userIsAdmin;this.useMapTime=b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0;this.source=b.source;this.gdbVersion=b.gdbVersion;this.orderByFields=
b.orderByFields;this.maxPointCountForAuto=null!=b.maxPointCountForAuto?b.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=b.maxRecordCountForAuto?b.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=b.maxVertexCountForAuto?b.maxVertexCountForAuto:this.maxVertexCountForAuto;this.generalizeForScale=null!=b.generalizeForScale?b.generalizeForScale:this.generalizeForScale;this.queryPagination=null!=b.queryPagination?b.queryPagination:this.url?
this.reHostedFS.test(this.url):!1;this.multipatchOption=b.multipatchOption;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var d=K,c=this.mode=n.isDefined(b.mode)?b.mode:d.MODE_ONDEMAND;this._isStream&&(this.mode=c=d.MODE_STREAM);switch(c){case d.MODE_SNAPSHOT:this.currentMode=d.MODE_SNAPSHOT;this._mode=new P(this);this._isSnapshot=!0;break;case d.MODE_ONDEMAND:case d.MODE_AUTO:this.currentMode=d.MODE_ONDEMAND;this._tileWidth=
b.tileWidth||512;this._tileHeight=b.tileHeight||512;this._mode=new T(this);this.latticeTiling=b.latticeTiling;break;case d.MODE_SELECTION:this.currentMode=d.MODE_SELECTION;this._mode=new ja(this);this._isSelOnly=!0;break;case d.MODE_STREAM:this.currentMode=d.MODE_STREAM,this._mode=new ka(this),this._isStream=!0}this._initLayer=q.hitch(this,this._initLayer);this._selectHandler=q.hitch(this,this._selectHandler);this._editable=!1;if(q.isObject(a)&&a.layerDefinition)return this._collection=!0,this.mode=
this._isStream?d.MODE_STREAM:d.MODE_SNAPSHOT,this._initLayer(a),this;this._task=new S(this.url,{source:this.source,gdbVersion:this.gdbVersion});c=this._url.path;this._fserver=!1;-1!==c.search(/\/FeatureServer\//i)&&(this._fserver=!0);this.mode===d.MODE_AUTO&&this.reHostedFS.test(this.url)&&this._queryLimit();(d=b.resourceInfo)?this._initLayer(d):(this.source&&(d={source:this.source.toJson()},this._url.query=q.mixin(this._url.query,{layer:e.toJson(d)})),this.gdbVersion&&(this._url.query=q.mixin(this._url.query,
{gdbVersion:this.gdbVersion})),s({url:c,content:q.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));this.registerConnectEvents()},_initLayer:function(a,b){if(a||b){this._json=a;this._findCredential();if(this.credential&&this.credential.ssl||a&&a._ssl)this._useSSL(),this._task._useSSL();this._collection&&(this._isStream||(this.currentMode=K.MODE_SNAPSHOT,this._mode=new P(this)),this._isSnapshot=!0,this._featureSet=a.featureSet,this._nextId=
a.nextObjectId,a=a.layerDefinition);this.geometryType=a.geometryType;"string"!==typeof this.multipatchOption&&"esriGeometryMultiPatch"===this.geometryType&&(this.multipatchOption="xyFootprint");if(a.hasOwnProperty("capabilities")){var c=this.capabilities=a.capabilities;c&&-1!==c.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);n.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===
this.geometryType&&(this._editable=!1);this._json=e.toJson(this._json);if(this.isEditable())delete this._maxOffset;else if(this.currentMode!==K.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint()))this._autoGeneralize=n.isDefined(this._optAutoGen)?this._optAutoGen:this.currentMode===K.MODE_ONDEMAND,delete this._optAutoGen;var c=a.effectiveMinScale||a.minScale,k=a.effectiveMaxScale||a.maxScale;!this._hasMin&&c&&this.setMinScale(c);
!this._hasMax&&k&&this.setMaxScale(k);this.layerId=a.id;this.name=a.name;this.description=a.description;this.copyright=a.copyrightText;this.type=a.type;this.displayField=a.displayField;this.defaultDefinitionExpression=a.definitionExpression;this.fullExtent=new aa(a.extent);this.initialExtent=new aa(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new y(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=a.defaultVisibility;if("esriGeometryPoint"===
this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.indexedFields=a.indexedFields;this.maxRecordCount=a.maxRecordCount;this.canModifyLayer=a.canModifyLayer;this.supportsStatistics=a.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:a.supportsAdvancedQueries;this.hasLabels=a.hasLabels;this.canScaleSymbols=a.canScaleSymbols;this.supportsRollbackOnFailure=a.supportsRollbackOnFailure;this.syncCanReturnChanges=a.syncCanReturnChanges;this.isDataVersioned=
a.isDataVersioned;this.editFieldsInfo=a.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=a.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=a.relationships;this.allowGeometryUpdates=n.isDefined(a.allowGeometryUpdates)?a.allowGeometryUpdates:!0;this._isTable="Table"===this.type;for(var h=this.fields=[],k=a.fields,c=0;c<k.length;c++)h.push(new N(k[c]));if(!this.objectIdField){this.objectIdField=
a.objectIdField;if(!this.objectIdField){k=a.fields;for(c=0;c<k.length;c++)if(h=k[c],"esriFieldTypeOID"===h.type){this.objectIdField=h.name;break}}this.objectIdField||console.debug("esri.layers.FeatureLayer: "+n.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!n.isDefined(this._nextId)){k=this.objectIdField;h=-1;if(this._collection&&k)for(var s=(c=this._featureSet)&&c.features,f=s?s.length:0,m,c=0;c<f;c++)m=(m=s[c].attributes)&&m[k],m>h&&(h=m);this._nextId=h+1}this.globalIdField=
a.globalIdField;if(c=this.typeIdField=a.typeIdField)if(c=!this._getField(c)&&this._getField(c,!0))this.typeIdField=c.name;this.visibilityField=a.visibilityField;if(k=a.defaultSymbol)this.defaultSymbol=B.fromJson(k);var v=this.types=[],t=a.types,l,u,h=(c=this.editFieldsInfo)&&c.creatorField,s=c&&c.editorField;m=h||s;f=[];if(t)for(c=0;c<t.length;c++)l=new L(t[c]),u=l.templates,m&&(u&&u.length)&&(f=f.concat(u)),v.push(l);t=a.templates;l=this.templates=[];if(t)for(c=0;c<t.length;c++)v=new X(t[c]),m&&
f.push(v),l.push(v);for(c=0;c<f.length;c++)if(m=q.getObject("prototype.attributes",!1,f[c]))h&&delete m[h],s&&delete m[s];if(c=a.timeInfo)this.timeInfo=new F(c),this._startTimeField=c.startTimeField,this._endTimeField=c.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?c.trackIdField=this._trackIdField:this._trackIdField=c.trackIdField;this.hasAttachments=!this._collection&&a.hasAttachments?!0:!1;this.htmlPopupType=a.htmlPopupType;var c=a.drawingInfo,
w;if((h=c&&c.labelingInfo)&&!this.labelingInfo)this.labelingInfo=g.map(h,function(a){return new J(a)}),this._fixLabelExpr();if(!this.renderer)if(c&&c.renderer){if(w=c.renderer,this.setRenderer(I.fromJson(w)),"classBreaks"===w.type&&this.renderer.setMaxInclusive(!0),!this._collection){var r=w.type,k=[];w=this.renderer;switch(r){case "simple":k.push(w.symbol);break;case "uniqueValue":case "classBreaks":k.push(w.defaultSymbol),k=k.concat(g.map(w.infos,function(a){return a.symbol}))}var k=g.filter(k,
n.isDefined),p=this._url.path+"/images/",R=this._getToken();g.forEach(k,function(a){var b=a.url;b&&(-1===b.search(/https?\:/)&&-1===b.indexOf("data:")&&(a.url=p+b),R&&-1!==a.url.search(/https?\:/)&&(a.url+="?token\x3d"+R))})}}else if(k)t=this.types,0<t.length?(w=new H(this.defaultSymbol,this.typeIdField),g.forEach(t,function(a){w.addValue(a.id,a.symbol)})):w=new C(this.defaultSymbol),this.setRenderer(w);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":r=
new x;break;case "esriGeometryPolyline":r=new A;break;case "esriGeometryPolygon":r=new z;break;default:this.hasXYFootprint()&&(r=new z)}this.setRenderer(r?new C(r):null)}r=c&&c.transparency||0;!this.hasOwnProperty("opacity")&&0<r&&(this.opacity=1-r/100);this.version=a.currentVersion;this.version||(this.version="capabilities"in a||"drawingInfo"in a||"hasAttachments"in a||"htmlPopupType"in a||"relationships"in a||"timeInfo"in a||"typeIdField"in a||"types"in a?10:9.3);if((d("ie")||d("safari"))&&this.isEditable()&&
10.02>this.version)this._ts=!0;this.statistics=a.statistics;this._fixRendererFields();this._checkFields();this._updateCaps();var S=function(){this.currentMode!==K.MODE_SNAPSHOT&&(this.queryPagination=!1);this.loaded=!0;this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))};this._collection?(r=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new Y(r)),this._fcAdded=!0,S.call(this)):this._forceIdentity(this._limitPromise?function(){var a=this;this._limitPromise.then(function(b){a._checkMode(b)});
this._limitPromise.always(function(){a._limitPromise=null;S.call(a)})}:S)}},onRendererChange:function(){this.inherited(arguments);var a=this._getRenderer();this._ager=!(!a||!a.observationAger||!a.observationRenderer);if(a){var b=[],a=g.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],n.isDefined);g.forEach(a,function(a){q.isFunction(a.attributeField)||b.push(a.attributeField);b.push(a.attributeField2);b.push(a.attributeField3)},this);this._rendererFields=g.filter(b,n.isDefined)}else this._rendererFields=
[];this.loaded&&(this._fixRendererFields(),this._checkFields(this._rendererFields),this._collection&&(this._typesDirty=!0))},redraw:function(){this.inherited(arguments);this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(){this.inherited(arguments);var a=this._getRenderer();this._ager=!(!a||!a.observationAger||!a.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(a&&a.trackRenderer)},
_setMap:function(a){var b=this.inherited(arguments),c=this._mode,d=this;c&&c.initialize(a);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=this.on("graphic-node-add",function(a){a=a.graphic.attributes;(a=d._selectedFeatures[a&&a[d.objectIdField]])&&a.attr("data-selected","")});return b},_unsetMap:function(a){var b=this._mode;b&&b.suspend();this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);r.disconnect(this._zoomConnect);
r.disconnect(this._addHandle);this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},refresh:function(){var a=this._mode;a&&a.refresh()},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return g.filter(this._getOutFields(),function(a){return"*"===a||!!this._getField(a)},this)},setEditable:function(a){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),
this;if(!this.loaded)return this._optEditable=a,this;var b=this._editable;this._editable=a;this._updateCaps();if(b!==a)this.onCapabilitiesChange();return this},getEditCapabilities:function(a){var b={canCreate:!1,canUpdate:!1,canDelete:!1};if(!this.loaded||!this.isEditable())return b;var c=a&&a.feature;a=a&&a.userId;var d=g.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],q.trim),k=-1<g.indexOf(d,"editing"),n=k&&-1<g.indexOf(d,"create"),b=k&&-1<g.indexOf(d,"update"),d=k&&-1<g.indexOf(d,
"delete"),e=this.ownershipBasedAccessControlForFeatures,h=this.editFieldsInfo,s=h&&h.creatorField,h=h&&h.realm,c=(c=c&&c.attributes)&&s?c[s]:void 0,f=!!this.userIsAdmin,s=!e||f||!(!e.allowOthersToUpdate&&!e.allowUpdateToOthers),e=!e||f||!(!e.allowOthersToDelete&&!e.allowDeleteToOthers);if(f||k&&!n&&!b&&!d)n=b=d=!0;k={canCreate:n,canUpdate:b,canDelete:d};null===c?(k.canUpdate=b&&s,k.canDelete=d&&e):""!==c&&c&&((a=a||this.getUserId())&&h&&(a=a+"@"+h),a.toLowerCase()!==c.toLowerCase()&&(k.canUpdate=
b&&s,k.canDelete=d&&e));return k},getUserId:function(){var a;this.loaded&&(a=this.credential&&this.credential.userId||this.userId||"");return a},setUserIsAdmin:function(a){this.userIsAdmin=a},setEditSummaryCallback:function(a){this.editSummaryCallback=a},getEditSummary:function(a,b,c){c=n.isDefined(c)?c:(new Date).getTime();var d="";c=this.getEditInfo(a,b,c);(b=b&&b.callback||this.editSummaryCallback)&&(c=b(a,c)||"");if(q.isString(c))d=c;else{if(c){a=c.action;b=c.userId;var k=c.timeValue,e=0;a&&e++;
b&&e++;n.isDefined(k)&&e++;1<e&&(d=("edit"===a?"edit":"create")+(b?"User":"")+(n.isDefined(k)?c.displayPattern:""))}d=d&&n.substitute(c,this.i18n.layers.FeatureLayer[d])}return d},getEditInfo:function(a,b,c){if(this.loaded){c=n.isDefined(c)?c:(new Date).getTime();b=b&&b.action||"last";var d=this.editFieldsInfo,k=d&&d.creatorField,e=d&&d.creationDateField,h=d&&d.editorField,d=d&&d.editDateField,h=(a=a&&a.attributes)&&h?a[h]:void 0,d=a&&d?a[d]:null,k=this._getEditData(a&&k?a[k]:void 0,a&&e?a[e]:null,
c);c=this._getEditData(h,d,c);var s;switch(b){case "creation":s=k;break;case "edit":s=c;break;case "last":s=c||k}s&&(s.action=s===c?"edit":"creation");return s}},_getEditData:function(a,c,d){var k,e,h;n.isDefined(c)&&(e=d-c,h=0>e?"Full":6E4>e?"Seconds":12E4>e?"Minute":36E5>e?"Minutes":72E5>e?"Hour":864E5>e?"Hours":6048E5>e?"WeekDay":"Full");if(void 0!==a||h)k=k||{},k.userId=a,h&&(a=b.format,d=new Date(c),k.minutes=Math.floor(e/6E4),k.hours=Math.floor(e/36E5),k.weekDay=a(d,{datePattern:"EEEE",selector:"date"}),
k.formattedDate=a(d,{selector:"date"}),k.formattedTime=a(d,{selector:"time"}),k.displayPattern=h,k.timeValue=c);return k},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},setMaxAllowableOffset:function(a){this.isEditable()||(this._maxOffset=a);return this},getMaxAllowableOffset:function(){return this._maxOffset},setAutoGeneralize:function(a){if(this.loaded){if(!this.isEditable()&&this.currentMode!==K.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===
this.geometryType||this.hasXYFootprint()))if(this._autoGeneralize=a){if((a=this._map)&&a.loaded)this._maxOffset=Math.floor(a.extent.getWidth()/a.width)}else delete this._maxOffset}else this._optAutoGen=a;return this},setGDBVersion:function(a){if(!this._collection&&a!==this.gdbVersion&&(a||this.gdbVersion))this.gdbVersion=a,this._task.gdbVersion=a,this._url.query=q.mixin(this._url.query,{gdbVersion:a}),this.loaded&&(this.clearSelection(),this._map&&this.refresh()),this.onGDBVersionChange();return this},
setDefinitionExpression:function(a){this._defnExpr=a;(a=this._mode)&&a.propertyChangeHandler(1);return this},getDefinitionExpression:function(){return this._defnExpr},setTimeDefinition:function(a){this._isSnapshot?(this._timeDefn=a,(a=this._mode)&&a.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+this.id+", Layer URL \x3d "+this.url);return this},getTimeDefinition:function(){return this._timeDefn},
setTimeOffset:function(a,b){this._timeOffset=a;this._timeOffsetUnits=b;var c=this._mode;c&&c.propertyChangeHandler(0);return this},setUseMapTime:function(a){this.useMapTime=a;this._toggleTime(!this.suspended);(a=this._mode)&&a.propertyChangeHandler(0)},selectFeatures:function(a,b,d,k){b=b||K.SELECTION_NEW;a=this._getShallowClone(a);var n=this._map,e,s=this,f=t._fixDfd(new c(t._dfdCanceller));a.outFields=this.getOutFields();a.returnGeometry=!0;a.multipatchOption=this.multipatchOption;n&&(a.outSpatialReference=
new y(n.spatialReference.toJson()));if(!this._applyQueryFilters(a,!0))return e={features:[]},this._selectHandler(e,b,d,k,f),f;if(n=this._canDoClientSideQuery(a))f._pendingDfd=h(this._doQuery(a,n)),f._pendingDfd.then(function(a){e={features:a};s._selectHandler(e,b,d,k,f)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,k,f,!0),f;var g=this;this._ts&&(a._ts=(new Date).getTime());(f._pendingDfd=this._task.execute(a)).addCallbacks(function(a){g._selectHandler(a,
b,d,k,f)},function(a){g._resolve([a],null,k,f,!0)})}return f},getSelectedFeatures:function(){var a=this._selectedFeatures,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},clearSelection:function(a){var b=this._selectedFeatures,c=this._mode,d;for(d in b)b.hasOwnProperty(d)&&(this._unSelectFeatureIIf(d,c),c._removeFeatureIIf(d));this._selectedFeatures={};this._isSelOnly&&c._applyTimeFilter(!0);if(!a)this.onSelectionClear();return this},setSelectionSymbol:function(a){if(this._selectionSymbol=
a){var b=this._selectedFeatures,c;for(c in b)b.hasOwnProperty(c)&&b[c].setSymbol(a)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(a){a?(this.labelingInfo=a,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this.onLabelingInfoChange()},_fixLabelExpr:function(){var a=/\[([^\[\]]+)\]/ig,b,c=this,d=function(a,b){var d=c._getField(b,!0);return"["+(d&&d.name||b)+"]"};g.forEach(this.labelingInfo,function(c){if(b=c.labelExpression)c.labelExpression=
b.replace(a,d)})},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(a,b,c,d,k,n){var e=n.assembly,h=n.dfd;this._applyNormalized(a,e&&e[0]);this._applyNormalized(b,e&&e[1]);this.onBeforeApplyEdits(a,b,c);var f={},x=this.objectIdField,e={f:"json"},m=!1;if(this._collection)n={},n.addResults=a?g.map(a,function(){m=!0;return{objectId:this._nextId++,success:!0}},this):null,n.updateResults=b?g.map(b,function(a){m=!0;var b=a.attributes[x];f[b]=a;return{objectId:b,success:!0}},this):
null,n.deleteResults=c?g.map(c,function(a){m=!0;return{objectId:a.attributes[x],success:!0}},this):null,m&&this._editHandler(n,a,f,d,k,h);else{a&&0<a.length&&(e.adds=this._convertFeaturesToJson(a,0,1),m=!0);if(b&&0<b.length){for(n=0;n<b.length;n++){var v=b[n];f[v.attributes[x]]=v}e.updates=this._convertFeaturesToJson(b,0,0,1);m=!0}if(c&&0<c.length){b=[];for(n=0;n<c.length;n++)b.push(c[n].attributes[x]);e.deletes=b.join(",");m=!0}if(m){var t=this;return s({url:this._url.path+"/applyEdits",content:q.mixin(e,
this._url.query),callbackParamName:"callback",load:function(b){t._editHandler(b,a,f,d,k,h)},error:function(a){t._resolve([a],null,k,h,!0)}},{usePost:!0})}}},queryFeatures:function(a,b,c){return this._query("execute","onQueryFeaturesComplete",a,b,c)},queryRelatedFeatures:function(a,b,c){return this._query("executeRelationshipQuery","onQueryRelatedFeaturesComplete",a,b,c)},queryIds:function(a,b,c){return this._query("executeForIds","onQueryIdsComplete",a,b,c)},queryCount:function(a,b,c){return this._query("executeForCount",
"onQueryCountComplete",a,b,c)},queryExtent:function(a,b,c){return this._query("executeForExtent","onQueryExtentComplete",a,b,c)},queryAttachmentInfos:function(a,b,d){var k=this._url.path+"/"+a+"/attachments",n=new c(t._dfdCanceller),e=this;n._pendingDfd=s({url:k,content:q.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:function(c){c=c.attachmentInfos;var d;g.forEach(c,function(b){d=u.objectToQuery({gdbVersion:e._url.query&&e._url.query.gdbVersion,layer:e._url.query&&e._url.query.layer,
token:e._getToken()});b.url=k+"/"+b.id+(d?"?"+d:"");b.objectId=a});e._resolve([c],"onQueryAttachmentInfosComplete",b,n)},error:function(a){e._resolve([a],null,d,n,!0)}});return n},addAttachment:function(a,b,c,d){return this._sendAttachment("add",a,b,c,d)},updateAttachment:function(a,b,c,d,k){c.appendChild(w.create("input",{type:"hidden",name:"attachmentId",value:b}));return this._sendAttachment("update",a,c,d,k)},deleteAttachments:function(a,b,d,k){var n=this._url.path+"/"+a+"/deleteAttachments",
e=new c(t._dfdCanceller),h=this;b={f:"json",attachmentIds:b.join(",")};e._pendingDfd=s({url:n,content:q.mixin(b,this._url.query),callbackParamName:"callback",load:q.hitch(this,function(b){b=b.deleteAttachmentResults;b=g.map(b,function(b){b=new M(b);b.attachmentId=b.objectId;b.objectId=a;return b});h._resolve([b],"onDeleteAttachmentsComplete",d,e)}),error:function(a){h._resolve([a],null,k,e,!0)}},{usePost:!0});return e},addType:function(a){var b=this.types;if(b){if(g.some(b,function(b){return b.id==
a.id?!0:!1}))return!1;b.push(a)}else this.types=[a];return this._typesDirty=!0},deleteType:function(a){if(this._collection){var b=this.types;if(b){var c=-1;g.some(b,function(b,d){return b.id==a?(c=d,!0):!1});if(-1<c)return this._typesDirty=!0,b.splice(c,1)[0]}}},toJson:function(){var a=this._json;if(a=q.isString(a)?e.fromJson(a):q.clone(a)){var a=a.layerDefinition?a:{layerDefinition:a},b=a.layerDefinition,c=this._collection;if(c&&this._typesDirty){b.types=g.map(this.types||[],function(a){return a.toJson()});
var d=this.renderer,k=this.labelingInfo,n=b.drawingInfo;if((d||k)&&!n)n=b.drawingInfo={};n&&(d&&-1===d.declaredClass.indexOf("TemporalRenderer"))&&(n.renderer=d.toJson());k&&(n.labelingInfo=g.map(k,function(a){return a.toJson()}))}d=null;if(!c||this._fcAdded)d={geometryType:b.geometryType,features:this._convertFeaturesToJson(this.graphics,!0)};a.featureSet=q.mixin({},a.featureSet||{},d);c&&(a.nextObjectId=this._nextId,b.capabilities=this.capabilities);return a}},onSelectionComplete:function(){},onSelectionClear:function(){},
onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},
onLabelingInfoChange:function(){},_forceIdentity:function(b){var c=this,d=this._url&&this._url.path;(this.ownershipBasedAccessControlForFeatures||this.userIsAdmin)&&!this._getToken()&&d&&a.id&&a.id._hasPortalSession()&&a.id._doPortalSignIn(d)?a.id.getCredential(d).then(function(){c._findCredential();b.call(c)},function(){b.call(c)}):b.call(this)},_checkMode:function(a){var b=this.geometryType,c=this.maxRecordCount;a=(a=a&&a.features&&a.features[0])&&a.attributes&&a.attributes.exceedslimit;if(this.mode===
K.MODE_AUTO&&!this.isEditable()&&0===a&&(this.queryPagination||("esriGeometryPolyline"===b||"esriGeometryPolygon"===b||"esriGeometryMultipoint"===b||this.hasXYFootprint())&&c>=this.maxRecordCountForAuto||"esriGeometryPoint"===b&&c>=this.maxPointCountForAuto))this.currentMode=K.MODE_SNAPSHOT,this._mode=new P(this),this._isSnapshot=!0,this._autoGeneralize=!1},_queryLimit:function(){var a=this,b=new c;this._limitPromise=b.promise;setTimeout(function(){var c=new R,d=new ia;d.statisticType="exceedslimit";
d.maxPointCount=a.maxPointCountForAuto;d.maxRecordCount=a.maxRecordCountForAuto;d.maxVertexCount=a.maxVertexCountForAuto;d.outStatisticFieldName="exceedslimit";c.outStatistics=[d];a.queryFeatures(c).promise.then(function(a){b.resolve(a)},function(a){b.reject(a)})},0)},_updateCaps:function(){var a=this._editable,b=q.trim(this.capabilities||""),c=g.map(b?b.split(","):[],q.trim),d=g.map(b?b.toLowerCase().split(","):[],q.trim),b=g.indexOf(d,"editing"),k,d={Create:g.indexOf(d,"create"),Update:g.indexOf(d,
"update"),Delete:g.indexOf(d,"delete")};if(a&&-1===b)c.push("Editing");else if(!a&&-1<b){a=[b];for(k in d)-1<d[k]&&a.push(d[k]);a.sort();for(k=a.length-1;0<=k;k--)c.splice(a[k],1)}this.capabilities=c.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);var a=this._mode;a&&a.suspend()},onResume:function(a){this.inherited(arguments);this._toggleTime(!0);this._updateMaxOffset();var b=this._mode,c=this._map,
d=this._getRenderer();if(a.firstOccurrence){this._fixRendererFields();this._checkFields();this.clearSelection();if(this.timeInfo&&(this._trackIdField||d&&(d.latestObservationRenderer||d.trackRenderer)))this._trackManager=new Z(this),this._trackManager.initialize(c);if(this.mode===K.MODE_AUTO&&this.currentMode===K.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint())&&!this.getMaxAllowableOffset())d=this.generalizeForScale,d=this.maxScale?
this.maxScale:this.minScale?Math.min(d,this.minScale):Math.min(d,E.getScale(c,this.initialExtent)),this.setMaxAllowableOffset(c.extent.getWidth()/c.width/c.getScale()*d);this._zoomConnect=r.connect(c,"onZoomEnd",this,this._updateMaxOffset)}b&&(a.firstOccurrence?b.startup():b.resume())},_updateMaxOffset:function(){var a=this._map;a&&a.loaded&&this._autoGeneralize&&(this._maxOffset=Math.floor(a.extent.getWidth()/a.width))},_toggleTime:function(a){var b=this._map;a&&this.timeInfo&&this.useMapTime&&b?
(this._mapTimeExtent=b.timeExtent,this._timeConnect||(this._timeConnect=r.connect(b,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,r.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(a){this._mapTimeExtent=a;(a=this._mode)&&a.propertyChangeHandler(0)},_getOffsettedTE:function(a){var b=this._timeOffset,c=this._timeOffsetUnits;return a&&b&&c?a.offset(-1*b,c):a},_getTimeOverlap:function(a,b){return a&&b?a.intersection(b):a||b},_getTimeFilter:function(a){var b=
this.getTimeDefinition(),c;if(b&&(c=this._getTimeOverlap(b,null),!c))return[!1];if(a){if(a=c?this._getTimeOverlap(a,c):a,!a)return[!1]}else a=c;return[!0,a]},_getAttributeFilter:function(a){var b=this.getDefinitionExpression();return a?b?"("+b+") AND ("+a+")":a:b},_applyQueryFilters:function(a,b){a.where=this._getAttributeFilter(a.where);a.maxAllowableOffset=this._maxOffset;b&&this.supportsAdvancedQueries&&(a.orderByFields=a.orderByFields||this.getOrderByFields());if(this.timeInfo){var c=this._getTimeFilter(a.timeExtent);
if(c[0])a.timeExtent=c[1];else return!1}return!0},_add:function(a){var b=this._selectionSymbol,c=a.attributes,d=this.visibilityField;b&&this._isSelOnly&&a.setSymbol(b);if(d&&c&&c.hasOwnProperty(d))a[c[d]?"show":"hide"]();return this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(a){var b=[],c=this._map;if(!(this._isTable||!c&&!this._collection))if(!a.text&&!(a.where&&a.where!==this.getDefinitionExpression()||a.orderByFields&&
a.orderByFields.length||a.outStatistics)){var d=this._isSnapshot,k=this._isSelOnly,n=a.geometry;if(n)if(!k&&a.spatialRelationship===R.SPATIAL_REL_INTERSECTS&&"extent"===n.type&&(d||c.extent.contains(n)))b.push(1);else return;if(c=a.objectIds)if(d)b.push(2);else{var n=c.length,e=this._mode,h=0,f;for(f=0;f<n;f++)e._getFeature(c[f])&&h++;if(h===n)b.push(2);else return}if(this.timeInfo)if(a=a.timeExtent,c=this._mapTimeExtent,d)a&&b.push(3);else if(k){if(a)return}else if(c)if(-1!==g.indexOf(b,2))a&&b.push(3);
else return;else if(0<b.length)a&&b.push(3);else if(a)return;return 0<b.length?b:null}},_getAbsMid:function(a){return p.toAbsMid?p.toAbsMid(a):f.id.replace(/\/[^\/]*$/ig,"/")+a},_doQuery:function(a,b,d){var k=[],n=this._mode,e=this.objectIdField,h=this,f,s,x=new c,m=new c,v=function(a,b){if(!a.length||!b.length)return a.length?a:b;var c,d,k={};a.length>b.length?(d=a,c=b):(d=b,c=a);for(var n=d.length,h=c.length,f;n--;)f=d[n],k[f.attributes[e]]=!0;for(;h--;)f=c[h],k[f.attributes[e]]||d.push(f);return d};
if(-1!==g.indexOf(b,1)){s=this.graphics;f=s.length;var t=this.spatialIndex||this._map&&this._map.spatialIndex,y,l=a.geometry._normalize(null,!0);null==t&&$.autoSpatialIndexing?y=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(q.hitch(this,q.partial(this._getFromIndex,l,t)),function(a){m.resolve(q.hitch(this,q.partial(this._filterByExtent,s,l)))}):t&&(y=this._getFromIndex(l,t));y?y.then(function(a){for(var b=0;b<a.length;b++)a[b].results&&(k=k.concat(a[b].results));m.resolve(k)}).otherwise(function(a){m.reject(a)}):
m.resolve(this._filterByExtent(s,l))}else m.resolve([]);m.then(function(c){var k=[];if(-1!==g.indexOf(b,2)){var s=a.objectIds;for(f=s.length;f--;){var m=n._getFeature(s[f]);m&&k.push(m)}k=v(c,k)}else k=c;-1!==g.indexOf(b,3)&&this.timeInfo&&(c=a.timeExtent,k=h._filterByTime(k,c.startTime,c.endTime).match);d&&(k=g.map(k,function(a){return a.attributes[e]},this));x.resolve(k)});return x},_getFromIndex:function(a,b){b=b||this.spatialIndex||this._map.spatialIndex;a instanceof Array||(a=[a]);var c=this.id;
return k(g.map(a,function(a){return b.intersects(a,c)}))},_filterByExtent:function(a,b){for(var c=[],d=0,k=a.length;d<k;d++){var n=a[d],e=n.geometry;e&&(this.normalization&&b.length?(b[0].intersects(e)||b[1].intersects(e))&&c.push(n):b.intersects(e)&&c.push(n))}return c},_filterByTime:function(a,b,c){var d=this._startTimeField,k=this._endTimeField,e;this._twoTimeFields||(e=d||k);var h=n.isDefined,f=[],s=[],m,x=a.length,g,v;b=b?b.getTime():-Infinity;c=c?c.getTime():Infinity;if(e)for(m=0;m<x;m++)g=
a[m],v=g.attributes,d=v[e],d>=b&&d<=c?f.push(g):s.push(g);else for(m=0;m<x;m++)g=a[m],v=g.attributes,e=v[d],v=v[k],e=h(e)?e:-Infinity,v=h(v)?v:Infinity,e>=b&&e<=c||v>=b&&v<=c||b>=e&&c<=v?f.push(g):s.push(g);return{match:f,noMatch:s}},_resolve:function(a,b,c,d,k){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&t._resDfd(d,a,k)},_getShallowClone:function(a){var b=new R,c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_query:function(a,b,d,k,n){var e=this,f=this._map,s=new c(t._dfdCanceller),m=
d,g=function(c,d){if(!d&&("execute"===a||"executeRelationshipQuery"===a)){var n,h;if("execute"===a){n=c.features;h=n.length;for(h-=1;0<=h;h--)if(n[h]._layer=e,!e._isTable){var f=e._mode._getFeature(n[h].attributes[e.objectIdField]);f&&n.splice(h,1,f)}}else for(f in c)if(c.hasOwnProperty(f)){n=c[f].features;h=n.length;for(h-=1;0<=h;h--)n[h]._layer=e}}e._resolve([c],b,k,s)};if("executeRelationshipQuery"!==a){m=this._getShallowClone(d);m.outFields=this.getOutFields();m.returnGeometry=d.hasOwnProperty("returnGeometry")?
d.returnGeometry:!d.outStatistics;m.returnGeometry&&(m.multipatchOption=this.multipatchOption);var x;f&&(m.outSpatialReference=new y(f.spatialReference.toJson()));if(!this._applyQueryFilters(m,"execute"===a)){switch(a){case "execute":x=new Y({features:[]});break;case "executeForIds":x=[];break;case "executeForCount":x=0;break;case "executeForExtent":x={}}g(x,!0);return s}if(d="executeForExtent"!==a&&this._canDoClientSideQuery(m))return s._pendingDfd=h(this._doQuery(m,d,"executeForIds"===a||"executeForCount"===
a)),s._pendingDfd.then(function(b){switch(a){case "execute":x=new Y;x.features=b;break;case "executeForIds":x=b;break;case "executeForCount":x=b.length}g(x,!0)}),s}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,n,s,!0),s;this._ts&&(m._ts=(new Date).getTime());(s._pendingDfd=this._task[a](m)).addCallbacks(g,function(a){e._resolve([a],null,n,s,!0)});return s},_convertFeaturesToJson:function(a,b,c,d){var k=[],n=this._selectionSymbol,h=this.visibilityField,
f,s=this.objectIdField;if(this.loaded&&(c||d))f=g.filter(this.fields,function(a){return!1===a.editable&&(!d||a.name!==s)});for(c=0;c<a.length;c++){var m=a[c],x={},v=m.geometry,t=m.attributes,y=m.symbol;if(v&&(!d||!this.loaded||this.allowGeometryUpdates))x.geometry=v.toJson();h?(x.attributes=t=q.mixin({},t),t[h]=m.visible?1:0):t&&(x.attributes=q.mixin({},t));x.attributes&&(f&&f.length)&&g.forEach(f,function(a){delete x.attributes[a.name]});y&&y!==n&&(x.symbol=y.toJson());k.push(x)}return b?k:e.toJson(k)},
_selectHandler:function(a,b,c,d,k){var n;d=K;switch(b){case d.SELECTION_NEW:this.clearSelection(!0);n=!0;break;case d.SELECTION_ADD:n=!0;break;case d.SELECTION_SUBTRACT:n=!1}d=a.features;var e=this._mode,h=[],f=this.objectIdField,s,m;if(n)for(n=0;n<d.length;n++)s=d[n],m=s.attributes[f],s=e._addFeatureIIf(m,s),h.push(s),this._selectFeatureIIf(m,s,e);else for(n=0;n<d.length;n++)s=d[n],m=s.attributes[f],this._unSelectFeatureIIf(m,e),m=e._removeFeatureIIf(m),h.push(m||s);this._isSelOnly&&e._applyTimeFilter(!0);
this._resolve([h,b,a.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",c,k);if(a.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(a,b,c){var d=this._selectedFeatures,k=d[a];k||(c._incRefCount(a),d[a]=b,this._isTable||(this._setSelectSymbol(b),b.attr("data-selected","")));return k||b},_unSelectFeatureIIf:function(a,b){var c=this._selectedFeatures[a];c&&(b._decRefCount(a),delete this._selectedFeatures[a],this._isTable||(this._setUnSelectSymbol(c),
c.attr("data-selected")));return c},_isSelected:function(a){},_setSelectSymbol:function(a){var b=this._selectionSymbol;b&&!this._isSelOnly&&a.setSymbol(b)},_setUnSelectSymbol:function(a){var b=this._selectionSymbol;b&&!this._isSelOnly&&b===a.symbol&&a.setSymbol(null,!0)},_getOutFields:function(){var a=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields).concat(this.dataAttributes),a=g.filter(a,function(a,b,
c){return!!a&&g.indexOf(c,a)===b}),b=q.clone(this._outFields);if(b){if(-1!==g.indexOf(b,"*"))return b;g.forEach(a,function(a){-1===g.indexOf(b,a)&&b.push(a)});return b}return a},_checkFields:function(a){var b=a||this._getOutFields();g.forEach(b,function(a){"*"!==a&&(this._getField(a)||console.debug("esri.layers.FeatureLayer: "+n.substitute({url:this.url,field:a},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);!a&&(!this._isTable&&!this._fserver&&!this._collection)&&
(g.some(this.fields,function(a){return a&&"esriFieldTypeGeometry"===a.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+n.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]")))},_fixRendererFields:function(){var a=this.renderer;this._orderBy=null;if(a&&0<this.fields.length){var b=[],c,d,a=g.filter([a,a.observationRenderer,a.latestObservationRenderer,
a.trackRenderer],n.isDefined),k=[].concat(a);g.forEach(a,function(a){g.forEach(a.rendererInfos,function(a){a.renderer&&k.push(a.renderer)})});g.forEach(k,function(a){if((d=a.attributeField)&&!q.isFunction(d))if(c=!this._getField(d)&&this._getField(d,!0))a.attributeField=c.name;if(d=a.attributeField2)if(c=!this._getField(d)&&this._getField(d,!0))a.attributeField2=c.name;if(d=a.attributeField3)if(c=!this._getField(d)&&this._getField(d,!0))a.attributeField3=c.name;q.isFunction(a.attributeField)||b.push(a.attributeField);
b.push(a.attributeField2);b.push(a.attributeField3);if((d=a.rotationInfo&&a.rotationInfo.field)&&!q.isFunction(d)){if(c=!this._getField(d)&&this._getField(d,!0))d=a.rotationInfo.field=c.name;b.push(d)}if(a.proportionalSymbolInfo){if((d=a.proportionalSymbolInfo.field)&&!q.isFunction(d)){if(c=!this._getField(d)&&this._getField(d,!0))d=a.proportionalSymbolInfo.field=c.name;b.push(d);this._orderBy||(this._orderBy=[d+" DESC"])}if((d=a.proportionalSymbolInfo.normalizationField)&&!q.isFunction(d)){if(c=
!this._getField(d)&&this._getField(d,!0))d=a.proportionalSymbolInfo.normalizationField=c.name;b.push(d)}}if(a.colorInfo){if((d=a.colorInfo.field)&&!q.isFunction(d)){if(c=!this._getField(d)&&this._getField(d,!0))d=a.colorInfo.field=c.name;b.push(d)}if((d=a.colorInfo.normalizationField)&&!q.isFunction(d)){if(c=!this._getField(d)&&this._getField(d,!0))d=a.colorInfo.normalizationField=c.name;b.push(d)}}if(!this._orderBy&&a.addBreak&&!q.isFunction(a.attributeField)&&(a.backgroundFillSymbol||this._hasSizeDiff(a)))this._orderBy=
[a.attributeField+" DESC"]},this);this._rendererFields=g.filter(b,n.isDefined)}},_hasSizeDiff:function(a){var b=Number.MAX_VALUE,c=-Number.MAX_VALUE,d,k;g.forEach(a.infos,function(a){if(k=a.symbol){d=0;switch(k.type){case "simplemarkersymbol":d=k.size;break;case "picturemarkersymbol":d=(k.width+k.height)/2;break;case "simplelinesymbol":case "cartographiclinesymbol":d=k.width;break;case "simplefillsymbol":case "picturefillsymbol":d=k.outline&&k.outline.width}d&&(b=Math.min(b,d),c=Math.max(c,d))}});
return b!==Number.MAX_VALUE&&c!==-Number.MAX_VALUE&&1<Math.abs(c-b)},getOrderByFields:function(){var a=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&a?g.filter(a,function(a){a=a.split(" ")[0];return!!this._getField(a,!0)},this):null},_getField:function(a,b){var c=this.fields;if(!c||0===c.length)return null;var d;b&&(a=a.toLowerCase());g.some(c,function(c){var k=!1;(k=b?c&&c.name.toLowerCase()===a?!0:!1:c&&c.name===a?!0:!1)&&(d=c);return k});return d},_getDateOpts:function(){this._dtOpts||
(this._dtOpts={properties:g.map(g.filter(this.fields,function(a){return!!(a&&"esriFieldTypeDate"===a.type)}),function(a){return a.name})});return this._dtOpts},_applyNormalized:function(a,b){a&&b&&g.forEach(a,function(a,c){a&&b[c]&&a.setGeometry(b[c])})},_editHandler:function(a,b,c,d,k,n){k=a.addResults;var e=a.updateResults;a=a.deleteResults;var h,f,s,m,x=this.objectIdField,v=this._mode,t=this._isTable;h=this.editFieldsInfo;var y=this.getOutFields()||[],l=h&&h.creatorField,A=h&&h.creationDateField,
z=h&&h.editorField,q=h&&h.editDateField;h=h&&h.realm;-1===g.indexOf(y,"*")&&(l&&-1===g.indexOf(y,l)&&(l=null),A&&-1===g.indexOf(y,A)&&(A=null),z&&-1===g.indexOf(y,z)&&(z=null),q&&-1===g.indexOf(y,q)&&(q=null));var y=A||q?(new Date).getTime():null,u=l||z?this.getUserId():void 0;u&&h&&(u=u+"@"+h);if(k)for(h=0;h<k.length;h++)k[h]=new M(k[h]),t||(f=k[h],f.success&&(f=f.objectId,s=b[h],(m=s._graphicsLayer)&&m!==this&&m.remove(s),m=s.attributes||{},m[x]=f,l&&(m[l]=u),z&&(m[z]=u),A&&(m[A]=y),q&&(m[q]=y),
s.setAttributes(m),v._init&&v.drawFeature(s)));if(e)for(h=0;h<e.length;h++)if(e[h]=new M(e[h]),!t&&(f=e[h],f.success)){f=f.objectId;s=c[f];if(b=v._getFeature(f))b.geometry!==s.geometry&&b.setGeometry(D.fromJson(s.geometry.toJson())),this._repaint(b,f);s=b||s;m=s.attributes||{};z&&(m[z]=u);q&&(m[q]=y);s.setAttributes(m)}if(a){c=[];for(h=0;h<a.length;h++)if(a[h]=new M(a[h]),!t&&(f=a[h],f.success&&(f=f.objectId,s=v._getFeature(f))))this._unSelectFeatureIIf(f,v)&&c.push(s),s._count=0,v._removeFeatureIIf(f);
if(0<c.length)this.onSelectionComplete(c,K.SELECTION_SUBTRACT)}this._resolve([k,e,a],"onEditsComplete",d,n)},_sendAttachment:function(a,b,c,d,k){var n=this;return s({url:this._url.path+"/"+b+"/"+("add"===a?"addAttachment":"updateAttachment"),form:c,content:q.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(c){var k="add"===a?"onAddAttachmentComplete":"onUpdateAttachmentComplete";c=new M(c["add"===a?"addAttachmentResult":
"updateAttachmentResult"]);c.attachmentId=c.objectId;c.objectId=b;n._resolve([c],k,d);return c}).addErrback(function(a){n._resolve([a],null,k,null,!0)})},_repaint:function(a,b,c){b=n.isDefined(b)?b:a.attributes[this.objectIdField];(!(b in this._selectedFeatures)||!this._selectionSymbol)&&a.setSymbol(a.symbol,c)},_getKind:function(a){var b=this._trackManager;return b?b.isLatestObservation(a)?1:0:0}});q.mixin(K,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,
MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});G._createWrappers(K);d("extend-esri")&&q.setObject("layers.FeatureLayer",K,a);return K})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(p,f,l,r,q,g){p=p(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(e){e.catalogItems&&
(this.catalogItems=new g(e.catalogItems));e.location&&(this.location=q.fromJson(e.location));this.catalogItemVisibilities=e.catalogItemVisibilities;this.name=e.name;this.objectId=e.objectId;this.value=e.value;this.properties=e.properties}});l("extend-esri")&&f.setObject("tasks.ImageServiceIdentifyResult",p,r);return p})},"esri/virtualearth/VETiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/_base/config dojo/has dojo/string dojo/_base/Deferred ../kernel ../urlUtils ../SpatialReference ../layers/TileInfo ../layers/TiledMapServiceLayer ../geometry/Extent ../request".split(" "),
function(p,f,l,r,q,g,e,c,b,d,u,w,m,h,k){p=p(m,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(a){try{a=f.mixin({bingMapsKey:null,culture:"en-US"},a||{});var b=window.location.protocol;"file:"===b&&(b="http:");this.url=b+"//dev.virtualearth.net/REST/v1";this._url=d.urlToObject(this.url);this.spatialReference=new u({wkid:102100});this.tileInfo=new w({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,
scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},
{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,
scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.initialExtent=this.fullExtent=new h(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new u({wkid:102100}));f.mixin(this,a);this.hasAttributionData=this.showAttribution;this._initLayer=f.hitch(this,this._initLayer);this._errorHandler=f.hitch(this,this._errorHandler);this._getTileInfo=f.hitch(this,this._getTileInfo);if(this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");
}catch(c){throw this.onError(c),c;}},_unsetMap:function(a,b){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var a=this._url.path+"/Imagery/Metadata/"+this.mapStyle;if(this.bingMapsKey){var b=this.resourceInfo;!this.loaded&&b?this._initLayer(b):k({url:a,content:f.mixin({},{key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler})}}},_initLayer:function(a,
b){if(200!==a.statusCode){var c=Error();c.code=a.statusCode;c.message=a.statusDescription;c.details=a.errorDetails;c.authenticationResultCode=a.authenticationResultCode;this.onError(c)}else try{this.resourceInfo=l.toJson(a);var c=a.resourceSets[0].resources[0],d=c.imageUrl.replace("{","${");this.tileServers=r.map(c.imageUrlSubdomains,function(a){var b=window.location.protocol;"file:"===b&&(b="http:");return e.substitute(d,{subdomain:a}).replace("http:",b)});this._tsLength=this.tileServers.length;
if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2012 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var k=this.loadCallback;k&&(delete this.loadCallback,k(this))}}catch(h){this.onError(h)}},getAttributionData:function(){var a=new c,b=l.fromJson(this.resourceInfo),d;this.hasAttributionData&&b&&(d=f.getObject("resourceSets.0.resources.0.imageryProviders",!1,b));d?a.callback({contributors:d}):(b=Error("Layer does not have attribution data"),
b.log=q.isDebug,a.errback(b));return a},getTileUrl:function(a,b,c){return e.substitute(this.tileServers[b%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(a,b,c),culture:this.culture,token:this.bingMapsKey})},_getQuadKey:function(a,b,c){var d="",k,e;for(e=a;0<e;e--)a="0",k=1<<e-1,0!=(c&k)&&a++,0!=(b&k)&&(a++,a++),d+=a;return d},setMapStyle:function(a){this.mapStyle=a;this._getTileInfo()},setCulture:function(a){this.culture=a;this._getTileInfo()},setBingMapsKey:function(a){this.bingMapsKey=
a},onMapStyleChange:function(){}});f.mixin(p,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"road"});g("extend-esri")&&f.setObject("virtualearth.VETiledLayer",p,b);return p})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(p,f,l,r,q,g,e,c,b,d){function u(b,c,d){return a&&d?function(a,b){return g(a,d,b)}:h?function(a,d){var k=g(a,c,d),n=g(a,b,function(a){(!B||
(new Date).getTime()>B+1E3)&&d.call(this,a)});return{remove:function(){k.remove();n.remove()}}}:function(a,c){return g(a,b,c)}}function w(a){do if(a.dojoClick)return a.dojoClick;while(a=a.parentNode)}function m(a,b,c){if(s=!a.target.disabled&&w(a.target))v=a.target,t=a.touches?a.touches[0].pageX:a.clientX,y=a.touches?a.touches[0].pageY:a.clientY,x=("object"==typeof s?s.x:"number"==typeof s?s:0)||4,A=("object"==typeof s?s.y:"number"==typeof s?s:0)||4,n||(n=!0,d.doc.addEventListener(b,function(a){s=
s&&a.target==v&&Math.abs((a.touches?a.touches[0].pageX:a.clientX)-t)<=x&&Math.abs((a.touches?a.touches[0].pageY:a.clientY)-y)<=A},!0),d.doc.addEventListener(c,function(a){if(s){z=(new Date).getTime();var b=a.target;"LABEL"===b.tagName&&(b=l.byId(b.getAttribute("for"))||b);setTimeout(function(){g.emit(b,"click",{bubbles:!0,cancelable:!0,_dojo_click:!0})})}},!0),a=function(a){d.doc.addEventListener(a,function(b){!b._dojo_click&&((new Date).getTime()<=z+1E3&&!("INPUT"==b.target.tagName&&r.contains(b.target,
"dijitOffScreen")))&&(b.stopPropagation(),b.stopImmediatePropagation&&b.stopImmediatePropagation(),"click"==a&&(("INPUT"!=b.target.tagName||"radio"==b.target.type||"checkbox"==b.target.type)&&"TEXTAREA"!=b.target.tagName&&"AUDIO"!=b.target.tagName&&"VIDEO"!=b.target.tagName)&&b.preventDefault())},!0)},a("click"),a("mousedown"),a("mouseup"))}var h=e("touch"),k=5>e("ios"),a=navigator.msPointerEnabled,n,s,v,t,y,x,A,z,B,C;h&&(a?b(function(){d.doc.addEventListener("MSPointerDown",function(a){m(a,"MSPointerMove",
"MSPointerUp")},!0)}):b(function(){function a(b){var c=q.delegate(b,{bubbles:!0});6<=e("ios")&&(c.touches=b.touches,c.altKey=b.altKey,c.changedTouches=b.changedTouches,c.ctrlKey=b.ctrlKey,c.metaKey=b.metaKey,c.shiftKey=b.shiftKey,c.targetTouches=b.targetTouches);return c}C=d.body();d.doc.addEventListener("touchstart",function(a){B=(new Date).getTime();var b=C;C=a.target;g.emit(b,"dojotouchout",{relatedTarget:C,bubbles:!0});g.emit(C,"dojotouchover",{relatedTarget:b,bubbles:!0});m(a,"touchmove","touchend")},
!0);g(d.doc,"touchmove",function(b){B=(new Date).getTime();var c=d.doc.elementFromPoint(b.pageX-(k?0:d.global.pageXOffset),b.pageY-(k?0:d.global.pageYOffset));c&&(C!==c&&(g.emit(C,"dojotouchout",{relatedTarget:c,bubbles:!0}),g.emit(c,"dojotouchover",{relatedTarget:C,bubbles:!0}),C=c),g.emit(c,"dojotouchmove",a(b)))});g(d.doc,"touchend",function(b){B=(new Date).getTime();var c=d.doc.elementFromPoint(b.pageX-(k?0:d.global.pageXOffset),b.pageY-(k?0:d.global.pageYOffset))||d.body();g.emit(c,"dojotouchend",
a(b))})}));f={press:u("mousedown","touchstart","MSPointerDown"),move:u("mousemove","dojotouchmove","MSPointerMove"),release:u("mouseup","dojotouchend","MSPointerUp"),cancel:u(c.leave,"touchcancel",h?"MSPointerCancel":null),over:u("mouseover","dojotouchover","MSPointerOver"),out:u("mouseout","dojotouchout","MSPointerOut"),enter:c._eventHandler(u("mouseover","dojotouchover","MSPointerOver")),leave:c._eventHandler(u("mouseout","dojotouchout","MSPointerOut"))};return p.touch=f})},"esri/layers/WMSLayerInfo":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/array","dojo/has","../kernel"],function(p,f,l,r,q){p=p(null,{declaredClass:"esri.layers.WMSLayerInfo",name:null,title:null,description:null,extent:null,legendURL:null,subLayers:[],allExtents:[],spatialReferences:[],constructor:function(f){f&&(this.name=f.name,this.title=f.title,this.description=f.description,this.extent=f.extent,this.legendURL=f.legendURL,this.subLayers=f.subLayers?f.subLayers:[],this.allExtents=f.allExtents?f.allExtents:[],this.spatialReferences=f.spatialReferences?
f.spatialReferences:[])},clone:function(){var f={name:this.name,title:this.title,description:this.description,legendURL:this.legendURL},e;this.extent&&(f.extent=this.extent.getExtent());f.subLayers=[];l.forEach(this.subLayers,function(c){f.subLayers.push(c.clone())});f.allExtents=[];for(e in this.allExtents)e=parseInt(e,10),isNaN(e)||(f.allExtents[e]=this.allExtents[e].getExtent());f.spatialReferences=[];l.forEach(this.spatialReferences,function(c){f.spatialReferences.push(c)});return f}});r("extend-esri")&&
f.setObject("layers.WMSLayerInfo",p,q);return p})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(p,f,l,r,q){return l("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,widgetsInTemplate:!0,contextRequire:null,_beforeFillContent:function(){if(this.widgetsInTemplate){var f=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);q.parse(f,{noStart:!this._earlyTemplatedStartup,
template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(r.hitch(this,function(e){this._startupWidgets=e;for(var c=0;c<e.length;c++)this._processTemplateNode(e[c],function(b,c){return b[c]},function(b,c,e){return c in b?b.connect(b,c,e):b.on(c,e,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");
}},_processTemplateNode:function(f,e,c){return e(f,"dojoType")||e(f,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){p.forEach(this._startupWidgets,function(f){f&&(!f._started&&f.startup)&&f.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(p,f,l,r,q){p=p(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(g){f.mixin(this,g);
q.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});l("extend-esri")&&f.setObject("layers.KMLFolder",p,r);return p})},"esri/layers/RenderMode":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/io/script ../kernel".split(" "),function(p,f,l,r,q,g,e){f=f(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(p._scopeName||"dojo")+"IoScript"},initialize:function(c){this.map=c;this._init=!0},startup:function(){},
propertyChangeHandler:function(c){},destroy:function(){this._init=!1},drawFeature:function(c){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(c){(c=this._featureMap[c])&&c._count++},_decRefCount:function(c){(c=this._featureMap[c])&&c._count--},_getFeature:function(c){return this._featureMap[c]},_addFeatureIIf:function(c,b){var d=this._featureMap,e=d[c],f=this.featureLayer;e||(d[c]=b,f._add(b),b._count=0);return e||b},_removeFeatureIIf:function(c){var b=this._featureMap[c],
d=this.featureLayer;if(b){if(b._count)return;delete this._featureMap[c];d._remove(b)}return b},_clearIIf:function(){var c;c=this.featureLayer;var b=c.graphics,d=c._selectedFeatures,e=c.objectIdField;for(c=b.length-1;0<=c;c--){var f=b[c],m=f.attributes[e];m in d?f._count=1:(f._count=0,this._removeFeatureIIf(m))}},_isPending:function(c){return g[this._prefix+c]?!0:!1},_cancelPendingRequest:function(c,b){if(c=c||g[this._prefix+b])try{c.cancel(),g._validCheck(c)}catch(d){}},_purgeRequests:function(){g._validCheck(null)},
_toggleVisibility:function(c){var b=this.featureLayer,d=b.graphics,e=c?"show":"hide",f,m=d.length;c=c&&b._ager;for(f=0;f<m;f++){var h=d[f];h[e]();c&&b._repaint(h)}},_applyTimeFilter:function(c){var b=this.featureLayer;if(b.timeInfo&&!b.suspended){c||b._fireUpdateStart();var d=b._trackManager;d&&d.clearTracks();var e=b.getTimeDefinition(),f=b._getOffsettedTE(b._mapTimeExtent);f?(f=b._getTimeOverlap(e,f))?(e=b._filterByTime(b.graphics,f.startTime,f.endTime),d&&d.addFeatures(e.match),r.forEach(e.match,
function(c){var d=c._shape;c.visible||(c.show(),(d=c._shape)&&d._moveToFront());b._ager&&d&&b._repaint(c)}),r.forEach(e.noMatch,function(b){b.visible&&b.hide()})):this._toggleVisibility(!1):(d&&d.addFeatures(b.graphics),this._toggleVisibility(!0));d&&(d.moveLatestToFront(),d.drawTracks());c||b._fireUpdateEnd()}}});q("extend-esri")&&l.setObject("layers._RenderMode",f,e);return f})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./RangeDomain ./CodedValueDomain ./InheritedDomain ./FeatureTemplate".split(" "),
function(p,f,l,r,q,g,e,c,b,d,u){p=p(null,{declaredClass:"esri.layers.FeatureType",constructor:function(g){if(g&&f.isObject(g)){this.id=g.id;this.name=g.name;var m=g.symbol;m&&(this.symbol=e.fromJson(m));var m=g.domains,h,k=this.domains={};for(h in m)if(m.hasOwnProperty(h)){var a=m[h];switch(a.type){case "range":k[h]=new c(a);break;case "codedValue":k[h]=new b(a);break;case "inherited":k[h]=new d(a)}}if(h=g.templates){m=this.templates=[];for(g=0;g<h.length;g++)m.push(new u(h[g]))}}},toJson:function(){var b=
{id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},c,d=this.domains,k=this.templates,a=g.fixJson;if(d){var e=b.domains={};for(c in d)d.hasOwnProperty(c)&&(e[c]=d[c]&&d[c].toJson());a(e)}k&&(b.templates=l.map(k,function(a){return a.toJson()}));return a(b)}});r("extend-esri")&&f.setObject("layers.FeatureType",p,q);return p})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),
function(p,f,l,r,q,g,e,c){p=p(null,{declaredClass:"esri.layers._TrackManager",constructor:function(b){this.layer=b;this.trackMap={};this.trackLineMap={}},initialize:function(b){this.map=b;var d=this.layer,e=d._getRenderer(),e=e&&e.trackRenderer;if("esriGeometryPoint"===d.geometryType){var f=this.container=new c._GraphicsLayer({id:d.id+"_tracks",_child:!0});f.loaded=!0;f.onLoad(f);f._setMap(b,d._div);f.setRenderer(e)}},addFeatures:function(b){var c=this.trackMap,e=this.layer,f=e._trackIdField,m=[];
l.forEach(b,function(a){var b=a.attributes[f];(c[b]=c[b]||[]).push(a);-1===l.indexOf(m,b)&&m.push(b)});var h=e._startTimeField,k=e.objectIdField,a=function(a,b){var c=a.attributes[h],d=b.attributes[h];return c===d?a.attributes[k]<b.attributes[k]?-1:1:c<d?-1:1};l.forEach(m,function(b){c[b].sort(a)})},trimTracks:function(b){function c(b){for(b=e[b]||[];b.length>f;)m.push(b.shift())}var e=this.trackMap,f=this.layer.maximumTrackPoints||0,m=[],h;if(!f)return m;if(b)l.forEach(b,function(b){c(b)});else for(h in e)e.hasOwnProperty(h)&&
c(h);return m},drawTracks:function(b){function c(a){var b=m[a],d,t,y;t=f.trackLineMap[a];q.remove(t);delete f.trackLineMap[a];if(!b||2>b.length)return!1;t=[];for(d=b.length-1;0<=d;d--)(y=b[d].geometry)&&t.push([y.x,y.y]);b={};b[k]=a;1<t.length&&(t=new g(new e({paths:[t],spatialReference:h}),null,b),q.add(t),f.trackLineMap[a]=t)}var f=this,q=this.container,m,h,k,a;if(q)if(m=this.trackMap,h=this.map.spatialReference,k=this.layer._trackIdField,b)l.forEach(b,function(a){c(a)});else for(a in m)m.hasOwnProperty(a)&&
c(a)},refreshTracks:function(b){function c(a){var b,d;e.drawTracks([a]);if(h&&h.latestObservationRenderer){a=f[a]||[];b=a.length;for(d=0;d<b;d++)m._repaint(a[d],null,!0)}}var e=this,f=this.trackMap,m=this.layer,h=m._getRenderer(),k;if(b)l.forEach(b,function(a){c(a)});else for(k in f)f.hasOwnProperty(k)&&c(k);this.moveLatestToFront()},moveLatestToFront:function(b){l.forEach(this.getLatestObservations(b),function(b){var c=b._shape;c&&c._moveToFront();this._repaint(b,null,!0)},this.layer)},getLatestObservations:function(b){function c(b){b=
m[b];return b[b.length-1]}var e=[],f=this.layer._getRenderer(),m=this.trackMap,h;if(!f.latestObservationRenderer)return e;if(b)l.forEach(b,function(b){e.push(c(b))});else for(h in m)m.hasOwnProperty(h)&&e.push(c(h));return e},clearTracks:function(b){var c=this.getLatestObservations(b),e=this.container,f;b?l.forEach(b,function(b){delete this.trackMap[b];e&&(f=this.trackLineMap[b],e.remove(f),delete this.trackLineMap[b])},this):(this.trackMap={},this.trackLineMap={},e&&e.clear());l.forEach(c,function(b){this._repaint(b,
null,!0)},this.layer)},isLatestObservation:function(b){var c=this.trackMap[b.attributes[this.layer._trackIdField]];return c?c[c.length-1]===b:!1},destroy:function(){var b=this.container;b&&(b.clear(),b._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});r("extend-esri")&&f.setObject("layers._TrackManager",p,q);return p})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/Polyline".split(" "),
function(p,f,l,r,q,g,e,c){p=p(null,{declaredClass:"esri.layers._GridLayout",constructor:function(b,c,e,f){this.origin=b;this.cellWidth=c.width;this.cellHeight=c.height;this.mapWidth=e.width;this.mapHeight=e.height;this.srInfo=f},setResolution:function(b){this._resolution=(b.xmax-b.xmin)/this.mapWidth;this.srInfo&&(b=Math.round(2*this.srInfo.valid[1]/this._resolution),b=Math.round(b/this.cellWidth),this._frameStats=[b,0,b-1])},getCellCoordinates:function(b){var c=this._resolution,e=this.origin;return{row:Math.floor((e.y-
b.y)/(this.cellHeight*c)),col:Math.floor((b.x-e.x)/(this.cellWidth*c))}},normalize:function(b){var c=this._frameStats;if(c){var e=c[0],f=c[1],c=c[2];b<f?(b%=e,b=b<f?b+e:b):b>c&&(b%=e)}return b},intersects:function(b,c){var e=this.srInfo;return e?l.some(c._getParts(e),function(c){return b.intersects(c.extent)}):b.intersects(c)},getCellExtent:function(b,c){var f=this._resolution,l=this.origin,m=this.cellWidth,h=this.cellHeight;return new e(c*m*f+l.x,l.y-(b+1)*h*f,(c+1)*m*f+l.x,l.y-b*h*f,new g(l.spatialReference.toJson()))},
getLatticeID:function(b){var c=this.getCellCoordinates({x:b.xmin,y:b.ymax}),e=this.getCellCoordinates({x:b.xmax,y:b.ymin});b=c.row;var f=e.row,c=this.normalize(c.col),e=this.normalize(e.col);return b+"_"+f+"_"+c+"_"+e},sorter:function(b,c){return b<c?-1:1},getCellsInExtent:function(b,d){var e=this.getCellCoordinates({x:b.xmin,y:b.ymax}),f=this.getCellCoordinates({x:b.xmax,y:b.ymin}),m=e.row,h=f.row,e=e.col,f=f.col,k=[],a,n,s,g=[],t=[],y,x,l,z=[];for(a=m;a<=h;a++)for(n=e;n<=f;n++)s=this.normalize(n),
b=this.getCellExtent(a,s),k.push({row:a,col:s,extent:b,resolution:this._resolution}),d&&(g.push(b.xmin,b.xmax),t.push(b.ymin,b.ymax));e=this.normalize(e);f=this.normalize(f);g.sort(this.sorter);t.sort(this.sorter);n=g.length;for(a=n-1;0<=a;a--)a<n-1&&g[a]===g[a+1]&&g.splice(a,1);n=t.length;for(a=n-1;0<=a;a--)a<n-1&&t[a]===t[a+1]&&t.splice(a,1);if(g.length&&t.length){s=g[0];y=g[g.length-1];x=t[0];l=t[t.length-1];n=g.length;for(a=0;a<n;a++)z.push([[g[a],l],[g[a],x]]);n=t.length;for(a=0;a<n;a++)z.push([[s,
t[a]],[y,t[a]]]);a=new c({paths:z,spatialReference:this.origin.spatialReference.toJson()});k.push({latticeID:m+"_"+h+"_"+e+"_"+f,lattice:a,resolution:this._resolution})}return{minRow:m,maxRow:h,minCol:e,maxCol:f,cells:k}}});r("extend-esri")&&f.setObject("layers._GridLayout",p,q);return p})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(p,f,l){var r={};p.setObject("dojo.data.util.simpleFetch",r);r.errorHandler=function(l,g){g.onError&&
g.onError.call(g.scope||f.global,l,g)};r.fetchHandler=function(q,g){var e=g.abort||null,c=!1,b=g.start?g.start:0,d=g.count&&Infinity!==g.count?b+g.count:q.length;g.abort=function(){c=!0;e&&e.call(g)};var r=g.scope||f.global;g.store||(g.store=this);g.onBegin&&g.onBegin.call(r,q.length,g);g.sort&&q.sort(l.createSortFunction(g.sort,this));if(g.onItem)for(var p=b;p<q.length&&p<d;++p){var m=q[p];c||g.onItem.call(r,m,g)}g.onComplete&&!c&&(p=null,g.onItem||(p=q.slice(b,d)),g.onComplete.call(r,p,g))};r.fetch=
function(f){f=f||{};f.store||(f.store=this);this._fetchItems(f,p.hitch(this,"fetchHandler"),p.hitch(this,"errorHandler"));return f};return r})},"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),function(p,f,l,r,q,g){f=f("dojox.data.CsvStore",null,{constructor:function(e){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=
!1;e.url&&(this.url=e.url);this._csvData=e.data;e.label?this.label=e.label:""===this.label&&(this.label=void 0);this._storeProp="_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=e.identifier;""===this.identifier?delete this.identifier:this._idMap={};"separator"in e&&(this.separator=e.separator);"urlPreventCache"in e&&(this.urlPreventCache=e.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",
separator:",",urlPreventCache:!1,_assertIsItem:function(e){if(!this.isItem(e))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");},_getIndex:function(e){e=this.getIdentity(e);this.identifier&&(e=this._idMap[e]);return e},getValue:function(e,c,b){this._assertIsItem(e);var d=b;if("string"===typeof c)c=this._attributeIndexes[c],null!=c&&(d=this._dataArray[this._getIndex(e)][c]||b);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");
return d},getValues:function(e,c){var b=this.getValue(e,c);return b?[b]:[]},getAttributes:function(e){this._assertIsItem(e);var c=[];e=this._dataArray[this._getIndex(e)];for(var b=0;b<e.length;b++)""!==e[b]&&c.push(this._attributes[b]);return c},hasAttribute:function(e,c){this._assertIsItem(e);if("string"===typeof c){var b=this._attributeIndexes[c],d=this._dataArray[this._getIndex(e)];return"undefined"!==typeof b&&b<d.length&&""!==d[b]}throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");
},containsValue:function(e,c,b){var d=void 0;"string"===typeof b&&(d=q.patternToRegExp(b,!1));return this._containsValue(e,c,b,d)},_containsValue:function(e,c,b,d){e=this.getValues(e,c);for(c=0;c<e.length;++c){var f=e[c];if("string"===typeof f&&d)return null!==f.match(d);if(b===f)return!0}return!1},isItem:function(e){if(e&&e[this._storeProp]===this)if(e=e[this._idProp],this.identifier){if(this._dataArray[this._idMap[e]])return!0}else if(0<=e&&e<this._dataArray.length)return!0;return!1},isItemLoaded:function(e){return this.isItem(e)},
loadItem:function(e){},getFeatures:function(){return this._features},getLabel:function(e){if(this.label&&this.isItem(e))return this.getValue(e,this.label)},getLabelAttributes:function(e){return this.label?[this.label]:null},_fetchItems:function(e,c,b){var d=this,f=function(a,b){var k=null;if(a.query){var e,f,k=[],h=a.queryOptions?a.queryOptions.ignoreCase:!1,m={};for(e in a.query)f=a.query[e],"string"===typeof f&&(m[e]=q.patternToRegExp(f,h));for(h=0;h<b.length;++h){var g=!0,l=b[h];for(e in a.query)f=
a.query[e],d._containsValue(l,e,f,m[e])||(g=!1);g&&k.push(l)}}else k=b.slice(0,b.length);c(k,a)};if(this._loadFinished)f(e,this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:e,filter:f});else{this._loadInProgress=!0;var g=l.get({url:d.url,handleAs:"text",preventCache:d.urlPreventCache});g.addCallback(function(a){try{d._processData(a),f(e,d._arrayOfAllItems),d._handleQueuedFetches()}catch(c){b(c,e)}});g.addErrback(function(a){d._loadInProgress=!1;if(b)b(a,
e);else throw a;});var m=null;e.abort&&(m=e.abort);e.abort=function(){g&&-1===g.fired&&g.cancel();m&&m.call(e)}}else if(this._csvData)try{this._processData(this._csvData),this._csvData=null,f(e,this._arrayOfAllItems)}catch(h){b(h,e)}else{var k=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(b)b(k,e);else throw k;}},close:function(e){},_getArrayOfArraysFromCsvFileContents:function(e){if(p.isString(e)){var c=RegExp("^\\s+","g"),b=RegExp("\\s+$","g"),
d=RegExp('""',"g"),f=[],g=this._splitLines(e);for(e=0;e<g.length;++e){var m=g[e];if(0<m.length){for(var m=m.split(this.separator),h=0;h<m.length;){var k=m[h].replace(c,""),a=k.replace(b,""),n=a.charAt(0),s=a.charAt(a.length-1),l=a.charAt(a.length-2),t=a.charAt(a.length-3);if(2===a.length&&'""'==a)m[h]="";else if('"'==n&&('"'!=s||'"'==s&&'"'==l&&'"'!=t)){if(h+1===m.length)return;m[h]=k+this.separator+m[h+1];m.splice(h+1,1)}else'"'==n&&'"'==s&&(a=a.slice(1,a.length-1),a=a.replace(d,'"')),m[h]=a,h+=
1}f.push(m)}}this._attributes=f.shift();for(e=0;e<this._attributes.length;e++)this._attributeIndexes[this._attributes[e]]=e;this._dataArray=f}},_splitLines:function(e){var c=[],b,d="",f=!1;for(b=0;b<e.length;b++){var g=e.charAt(b);switch(g){case '"':f=!f;d+=g;break;case "\r":f?d+=g:(c.push(d),d="",b<e.length-1&&"\n"==e.charAt(b+1)&&b++);break;case "\n":f?d+=g:(c.push(d),d="");break;default:d+=g}}""!==d&&c.push(d);return c},_processData:function(e){this._getArrayOfArraysFromCsvFileContents(e);this._arrayOfAllItems=
[];if(this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");for(e=0;e<this._dataArray.length;e++){var c=e;this.identifier&&(c=this._dataArray[e][this._attributeIndexes[this.identifier]],this._idMap[c]=e);this._arrayOfAllItems.push(this._createItemFromIdentity(c))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(e){var c={};c[this._storeProp]=this;c[this._idProp]=
e;return c},getIdentity:function(e){return this.isItem(e)?e[this._idProp]:null},fetchItemByIdentity:function(e){var c,b=e.scope?e.scope:r.global;if(this._loadFinished)c=this._createItemFromIdentity(e.identity),this.isItem(c)||(c=null),e.onItem&&e.onItem.call(b,c);else{var d=this;if(""!==this.url)this._loadInProgress?this._queuedFetches.push({args:e}):(this._loadInProgress=!0,c=l.get({url:d.url,handleAs:"text"}),c.addCallback(function(c){try{d._processData(c);var f=d._createItemFromIdentity(e.identity);
d.isItem(f)||(f=null);e.onItem&&e.onItem.call(b,f);d._handleQueuedFetches()}catch(h){e.onError&&e.onError.call(b,h)}}),c.addErrback(function(c){this._loadInProgress=!1;e.onError&&e.onError.call(b,c)}));else if(this._csvData)try{d._processData(d._csvData),d._csvData=null,c=d._createItemFromIdentity(e.identity),d.isItem(c)||(c=null),e.onItem&&e.onItem.call(b,c)}catch(f){e.onError&&e.onError.call(b,f)}}},getIdentityAttributes:function(e){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){if(0<
this._queuedFetches.length){for(var e=0;e<this._queuedFetches.length;e++){var c=this._queuedFetches[e],b=c.filter,d=c.args;b?b(d,this._arrayOfAllItems):this.fetchItemByIdentity(c.args)}this._queuedFetches=[]}}});p.extend(f,g);return f})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(p,f,l,r,q){var g=p(null,{declaredClass:"esri.layers.RasterFunction",functionName:null,arguments:null,functionArguments:null,variableName:null,
outputPixelType:null,constructor:function(e){if(f.isObject(e)){var c=0;this.functionName=e.rasterFunction;this.functionArguments=e.rasterFunctionArguments||e.arguments;delete e.rasterFunction;delete e.rasterFunctionArguments;delete e.arguments;f.mixin(this,e);if(e=this.functionArguments){e.Raster&&e.Raster.rasterFunction&&(e.Raster=new g(e.Raster));e.Raster2&&e.Raster2.rasterFunction&&(e.Raster2=new g(e.Raster2));if(e.Rasters&&e.Rasters.length)for(c=0;c<e.Rasters.length;c++)e.Rasters[c].rasterFunction&&
(e.Rasters[c]=new g(e.Rasters[c]));e.DEM&&e.DEM.rasterFunction&&(e.DEM=new g(e.DEM))}}},toJson:function(){var e=f.clone(this.functionArguments||this.arguments);if(e){e.Raster&&"esri.layers.RasterFunction"===e.Raster.declaredClass&&(e.Raster=e.Raster.toJson());e.Raster2&&"esri.layers.RasterFunction"===e.Raster2.declaredClass&&(e.Raster2=e.Raster2.toJson());if(e.Rasters&&e.Rasters.length){for(var c=0,b=[],c=0;c<e.Rasters.length;c++)"esri.layers.RasterFunction"===e.Rasters[c].declaredClass?b.push(e.Rasters[c].toJson()):
b.push(e.Rasters[c]);e.Rasters=b}e.DEM&&"esri.layers.RasterFunction"===e.DEM.declaredClass&&(e.DEM=e.DEM.toJson())}return q.filter({rasterFunction:this.functionName,rasterFunctionArguments:e,variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(b){if(null!==b&&void 0!==b)return!0})}});l("extend-esri")&&f.setObject("layers.RasterFunction",g,r);return g})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(p,f){var l={};
p.setObject("dojo.date.stamp",l);l.fromISOString=function(r,q){l._isoRegExp||(l._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var g=l._isoRegExp.exec(r),e=null;if(g){g.shift();g[1]&&g[1]--;g[6]&&(g[6]*=1E3);q&&(q=new Date(q),f.forEach(f.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(b){return q["get"+b]()}),function(b,c){g[c]=g[c]||b}));e=new Date(g[0]||1970,g[1]||0,g[2]||1,g[3]||0,g[4]||
0,g[5]||0,g[6]||0);100>g[0]&&e.setFullYear(g[0]||1970);var c=0,b=g[7]&&g[7].charAt(0);"Z"!=b&&(c=60*(g[8]||0)+(Number(g[9])||0),"-"!=b&&(c*=-1));b&&(c-=e.getTimezoneOffset());c&&e.setTime(e.getTime()+6E4*c)}return e};l.toISOString=function(f,l){var g=function(b){return 10>b?"0"+b:b};l=l||{};var e=[],c=l.zulu?"getUTC":"get",b="";"time"!=l.selector&&(b=f[c+"FullYear"](),b=["0000".substr((b+"").length)+b,g(f[c+"Month"]()+1),g(f[c+"Date"]())].join("-"));e.push(b);if("date"!=l.selector){b=[g(f[c+"Hours"]()),
g(f[c+"Minutes"]()),g(f[c+"Seconds"]())].join(":");c=f[c+"Milliseconds"]();l.milliseconds&&(b+="."+(100>c?"0":"")+g(c));if(l.zulu)b+="Z";else if("time"!=l.selector)var c=f.getTimezoneOffset(),d=Math.abs(c),b=b+((0<c?"-":"+")+g(Math.floor(d/60))+":"+g(d%60));e.push(b)}return e.join("T")};return l})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(p,f,l,r,q,g,e){g.extend(p,
{waiRole:"",waiState:""});return q("dijit._Templated",[f,l],{widgetsInTemplate:!1,constructor:function(){e.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin","","2.0")},_processNode:function(c,b){var d=this.inherited(arguments),e=b(c,"waiRole");e&&c.setAttribute("role",e);(e=b(c,"waiState"))&&r.forEach(e.split(/\s*,\s*/),function(b){-1!=b.indexOf("-")&&(b=b.split("-"),c.setAttribute("aria-"+b[0],b[1]))});return d}})})},
"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated ../kernel ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),function(p,f,l,r,q,g,e,c,b,d,u,w,m,h,k,a,n,s){var v=0;f=f([n,h,k],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=r.mixin({},s.widgets.popup)},
templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(r.hitch(this,this._handleComponentsSuccess),r.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+
1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,b=a.length,c=this.domNode,k=this._prevMedia,e=this._nextMedia;if(1<b){var f=0,n=0;q.forEach(a,function(a){"image"===a.type?f++:-1!==a.type.indexOf("chart")&&n++});f&&(d.set(this._imageCount,"innerHTML",f),g.query(".summary .image",c).removeClass("hidden"));n&&(d.set(this._chartCount,"innerHTML",n),g.query(".summary .chart",c).removeClass("hidden"))}else g.query(".summary",
c).addClass("hidden"),u.add(k,"hidden"),u.add(e,"hidden");a=this._mediaPtr;0===a?u.add(k,"hidden"):u.remove(k,"hidden");a===b-1?u.add(e,"hidden"):u.remove(e,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],b=a.title,c=a.caption,k=g.query(".mediaSection .hzLine",this.domNode)[0];d.set(this._mediaTitle,"innerHTML",b);u[b?"remove":"add"](this._mediaTitle,"hidden");d.set(this._mediaCaption,"innerHTML",c);u[c?"remove":"add"](this._mediaCaption,"hidden");u[b&&
c?"remove":"add"](k,"hidden");this._rid=null;if("image"===a.type)this._showImage(a.value);else{var e=this,b=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],c=a.value.theme||this.chartTheme;r.isString(c)&&(c=c.replace(/\./gi,"/"),-1===c.indexOf("/")&&(c="dojox/charting/themes/"+c));c||(c="./Rainbow");b.push(c);try{var f=this._rid=v++;p(b,function(b,c,d){f===e._rid&&(e._rid=null,e._showChart(a.type,a.value,b,c,d))})}catch(n){console.log("PopupRenderer: error loading modules")}}},_showImage:function(a){u.add(this._mediaFrame,
"image");var b=m.get(this._gallery,"height"),c="\x3cimg class\x3d'esriPopupMediaImage' src\x3d'"+a.sourceURL+"' /\x3e";a.linkURL&&(c="\x3ca target\x3d'_blank' href\x3d'"+a.linkURL+"'\x3e"+c+"\x3c/a\x3e");d.set(this._mediaFrame,"innerHTML",c);var k=g.query(".esriPopupMediaImage",this._mediaFrame)[0],e=this,f;f=l.connect(k,"onload",function(){l.disconnect(f);f=null;e._imageLoaded(k,b)})},_showChart:function(a,b,c,d,k){u.remove(this._mediaFrame,"image");c=this._chart=new c(w.create("div",{"class":"chart"},
this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});k&&c.setTheme(k);switch(a){case "piechart":c.addPlot("default",{type:"Pie",labels:!1});c.addSeries("Series A",b.fields);break;case "linechart":c.addPlot("default",{type:"Markers"});c.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});q.forEach(b.fields,function(a,b){a.x=b+1});c.addSeries("Series A",b.fields);break;case "columnchart":c.addPlot("default",{type:"Columns",
gap:3});c.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});c.addSeries("Series A",b.fields);break;case "barchart":c.addPlot("default",{type:"Bars",gap:3}),c.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),c.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),c.addSeries("Series A",b.fields)}this._action=new d(c);c.render()},_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),
this._action=null);d.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,b){var c=a.height;c<b&&(c=Math.round((b-c)/2),m.set(a,"marginTop",c+"px"))},_attListHandler:function(a,b){if(a===this._dfd){this._dfd=null;var c="";!(b instanceof Error)&&(b&&b.length)&&q.forEach(b,function(a){c+="\x3cli\x3e";c+="\x3ca href\x3d'"+a.url+"' target\x3d'_blank'\x3e"+(a.name||"[No name]")+"\x3c/a\x3e";c+="\x3c/li\x3e"});d.set(this._attachmentsList,"innerHTML",c||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},
_handleComponentsSuccess:function(a){if(a){var c=this.showTitle?a.title:"",k=a.description,e=a.fields,f=a.mediaInfos,n=this.domNode,h=this._nls,s=this.template,m=this.graphic;this._prevMedia.title=h.NLS_prevMedia;this._nextMedia.title=h.NLS_nextMedia;d.set(this._title,"innerHTML",c);c||u.add(this._title,"hidden");!k&&e&&(k="",q.forEach(e,function(a){k+="\x3ctr valign\x3d'top'\x3e";k+="\x3ctd class\x3d'attrName'\x3e"+a[0]+"\x3c/td\x3e";k+="\x3ctd class\x3d'attrValue'\x3e"+a[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,
"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+h.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";k+="\x3c/tr\x3e"}),k&&(k="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+k+"\x3c/table\x3e"));d.set(this._description,"innerHTML",k);k||u.add(this._description,"hidden");g.query("a",this._description).forEach(function(a){d.set(a,"target","_blank")});c&&k?g.query(".mainSection .hzLine",n).removeClass("hidden"):c||k?g.query(".mainSection .hzLine",n).addClass("hidden"):
g.query(".mainSection",n).addClass("hidden");if(c=this._dfd=s.getAttachments(m))c.addBoth(r.hitch(this,this._attListHandler,c)),d.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+h.NLS_searching+"...\x3c/li\x3e"),g.query(".attachmentsSection",n).removeClass("hidden");f&&f.length&&(g.query(".mediaSection",n).removeClass("hidden"),b.setSelectable(this._mediaFrame,!1),this._mediaInfos=f,this._mediaPtr=0,this._updateUI(),this._displayMedia());a.editSummary&&(d.set(this._editSummary,"innerHTML",a.editSummary),
f&&f.length&&u.remove(this._mediaBreak,"hidden"),u.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(a){console.log("PopupRenderer: error loading template",a)}});e("extend-esri")&&r.setObject("dijit._PopupRenderer",f,a);return f})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(p){var f={};p.setObject("dojo.data.util.sorter",f);f.basicComparator=function(f,r){var q=-1;null===f&&(f=void 0);null===r&&(r=void 0);if(f==r)q=0;else if(f>r||null==f)q=1;
return q};f.createSortFunction=function(l,r){function q(b,c,d,a){return function(e,f){var g=a.getValue(e,b),l=a.getValue(f,b);return c*d(g,l)}}for(var g=[],e,c=r.comparatorMap,b=f.basicComparator,d=0;d<l.length;d++){e=l[d];var p=e.attribute;if(p){e=e.descending?-1:1;var w=b;c&&("string"!==typeof p&&"toString"in p&&(p=p.toString()),w=c[p]||b);g.push(q(p,e,w,r))}}return function(b,c){for(var d=0;d<g.length;){var a=g[d++](b,c);if(0!==a)return a}return 0}};return f})},"esri/layers/MapImageLayer":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style ../kernel ../config ../sniff ../domUtils ../geometry/Point ../geometry/webMercatorUtils ./layer".split(" "),
function(p,f,l,r,q,g,e,c,b,d,u,w,m){var h=p([m],{declaredClass:"esri.layers.MapImageLayer","-chains-":{constructor:"manual"},constructor:function(b){this.inherited(arguments,[null,b]);this._mapImages=[];var a=l.hitch;this._panStart=a(this,this._panStart);this._pan=a(this,this._pan);this._extentChange=a(this,this._extentChange);this._zoom=a(this,this._zoom);this._zoomStart=a(this,this._zoomStart);this._scale=a(this,this._scale);this._resize=a(this,this._resize);f.connect(this,"onSuspend",this,this._onSuspend);
f.connect(this,"onResume",this,this._onResume);this.loaded=!0;this.onLoad(this)},opacity:1,_transform:e._getDOMAccessor("transform"),addImage:function(b){var a=this._mapImages.push(b),a=a-1;b._idx=a;b._layer=this;this._div&&this._createImage(b,a)},removeImage:function(b){if(b){var a=b._idx,c=this._mapImages;if(c[a]===b){delete c[a];if(a=b._node)this._clearEvents(a),a.e_idx=a.e_bl=a.e_tr=a.e_l=a.e_t=a.e_w=a.e_h=null,a.parentNode&&(a.parentNode.removeChild(a),q.destroy(a));b._node=b._idx=b._layer=null}}},
removeAllImages:function(){var b=this._mapImages,a,c=b.length;for(a=0;a<c;a++){var d=b[a];d&&this.removeImage(d)}this._mapImages=[]},getImages:function(){var b=this._mapImages,a=[],c,d=b.length;for(c=0;c<d;c++)b[c]&&a.push(b[c]);return a},setOpacity:function(b){this.opacity!=b&&(this._opacityChanged(this.opacity=b),this.onOpacityChange())},onOpacityChange:function(){},_opacityChanged:function(c){var a=this._div,d,e;if(a)if(!b("ie")||8<b("ie"))g.set(a,"opacity",c);else{e=a.childNodes;d=e.length;for(a=
0;a<d;a++)g.set(e[a],"opacity",c)}},_createImage:function(c,a){var d=q.create("img");g.set(d,{position:"absolute"});8>=b("ie")&&g.set(d,"opacity",this.opacity);if(c.rotation){var e="rotate("+(360-c.rotation)+"deg)";9>b("ie")||(g.set(d,this._transform,e),g.set(d,"transform",e))}c._node=d;d.e_idx=a;d.e_layer=this;d.e_load=f.connect(d,"onload",h.prototype._imageLoaded);d.e_error=f.connect(d,"onerror",h.prototype._imageError);d.e_abort=f.connect(d,"onabort",h.prototype._imageError);d.src=c.href},_imageLoaded:function(b,
a){var c=a||b.target||b.currentTarget,d=c.e_layer,e=d._mapImages[c.e_idx],f=d._map;f&&(f.__zooming||f.__panning||!d._sr)?d._standby.push(c):(d._clearEvents(c),e&&e._node===c&&f&&d._attach(e))},_imageError:function(b){b=b.target||b.currentTarget;var a=b.e_layer,c=a._mapImages[b.e_idx];a._clearEvents(b);c&&(c._node=null)},_clearEvents:function(b){var a=f.disconnect;a(b.e_load);a(b.e_error);a(b.e_abort);b.e_load=b.e_error=b.e_abort=b.e_layer=null},_attach:function(b){var a=b.extent,c=a.spatialReference,
d=this._sr,e=this._div,f=b._node,h=new u({x:a.xmin,y:a.ymin,spatialReference:c}),a=new u({x:a.xmax,y:a.ymax,spatialReference:c});d.equals(c)||(d.isWebMercator()&&4326===c.wkid?(h=w.geographicToWebMercator(h),a=w.geographicToWebMercator(a)):c.isWebMercator()&&4326===d.wkid&&(h=w.webMercatorToGeographic(h),a=w.webMercatorToGeographic(a)));f.e_bl=h;f.e_tr=a;b.visible&&(this._setPos(f,e._left,e._top),(this._active||e).appendChild(f))},_setPos:function(b,a,c){var d=b.e_bl,f=b.e_tr,h=this._map,d=h.toScreen(d),
f=h.toScreen(f);a=d.x-a;c=f.y-c;var m=Math.abs(f.x-d.x),d=Math.abs(d.y-f.y),f={width:m+"px",height:d+"px"},l=this._mapImages[b.e_idx];"css-transforms"===h.navigationMode?f[e._css.names.transform]=e._css.translate(a,c)+(l.rotation?" "+e._css.rotate(360-l.rotation):""):(f.left=a+"px",f.top=c+"px");g.set(b,f);b.e_l=a;b.e_t=c;b.e_w=m;b.e_h=d},managedSuspension:!0,_setMap:function(c,a){this.inherited(arguments);var f=this._div=q.create("div",null,a),h=e._css.names,m={position:"absolute"},l=c.__visibleDelta;
if(!b("ie")||8<b("ie"))m.opacity=this.opacity;"css-transforms"===c.navigationMode?(m[h.transform]=e._css.translate(l.x,l.y),g.set(f,m),f._left=l.x,f._top=l.y,m={position:"absolute",width:c.width+"px",height:c.height+"px",overflow:"visible"},this._active=q.create("div",null,f),g.set(this._active,m),this._passive=q.create("div",null,f),g.set(this._passive,m)):(f._left=0,f._top=0,g.set(f,m));this._standby=[];h=this._mapImages;l=h.length;for(m=0;m<l;m++){var y=h[m];y._node||this._createImage(y,y._idx)}d.hide(f);
return f},_unsetMap:function(b,a){this._disconnect();var c=this._div;if(c){var d=this._mapImages,e,f=d.length;for(e=0;e<f;e++){var h=d[e];if(h){var m=h._node;m&&(this._clearEvents(m),m.e_idx=m.e_bl=m.e_tr=m.e_l=m.e_t=m.e_w=m.e_h=null);h._node=null}}a.removeChild(c);q.destroy(c)}this._map=this._div=this._sr=this._active=this._passive=this._standby=null;this.inherited(arguments)},_onSuspend:function(){this._disconnect();d.hide(this._div)},_onResume:function(b){b.firstOccurrence&&(this._sr=this._map.spatialReference,
this._processStandbyList());b=this._map;var a=this._div,c=b.__visibleDelta;"css-transforms"===b.navigationMode&&(a._left=c.x,a._top=c.y,g.set(a,e._css.names.transform,e._css.translate(a._left,a._top)));this._redraw("css-transforms"===b.navigationMode);this._connect(b);d.show(a)},_connect:function(b){if(!this._connections){var a=f.connect,c="css-transforms"===b.navigationMode;this._connections=[a(b,"onPanStart",this._panStart),a(b,"onPan",this._pan),a(b,"onExtentChange",this._extentChange),c&&a(b,
"onZoomStart",this._zoomStart),c?a(b,"onScale",this._scale):a(b,"onZoom",this._zoom),c&&a(b,"onResize",this._resize)]}},_disconnect:function(){this._connections&&(r.forEach(this._connections,f.disconnect),this._connections=null)},_panStart:function(){this._panL=this._div._left;this._panT=this._div._top},_pan:function(b,a){var c=this._div;c._left=this._panL+a.x;c._top=this._panT+a.y;"css-transforms"===this._map.navigationMode?g.set(c,e._css.names.transform,e._css.translate(c._left,c._top)):g.set(c,
{left:c._left+"px",top:c._top+"px"})},_extentChange:function(b,a,c){c?this._redraw("css-transforms"===this._map.navigationMode):a&&this._pan(b,a);this._processStandbyList()},_processStandbyList:function(){var b,a=this._standby;if(a&&a.length)for(b=a.length-1;0<=b;b--)this._imageLoaded(null,a[b]),a.splice(b,1)},_redraw:function(b){if(b){b=this._passive;var a=e._css.names;g.set(b,a.transition,"none");this._moveImages(b,this._active);g.set(b,a.transform,"none")}b=this._active||this._div;var a=this._div._left,
c=this._div._top,d,f=b.childNodes.length,h;for(d=0;d<f;d++)h=b.childNodes[d],this._setPos(h,a,c)},_zoom:function(b,a,c){b=this._div;var d=b._left,e=b._top,f,h=b.childNodes.length,m;for(f=0;f<h;f++){m=b.childNodes[f];var l=m.e_w*a,q=m.e_h*a,p=(c.x-d-m.e_l)*(l-m.e_w)/m.e_w,C=(c.y-e-m.e_t)*(q-m.e_h)/m.e_h,p=isNaN(p)?0:p,C=isNaN(C)?0:C;g.set(m,{left:m.e_l-p+"px",top:m.e_t-C+"px",width:l+"px",height:q+"px"})}},_zoomStart:function(){this._moveImages(this._active,this._passive)},_moveImages:function(b,a){var c=
b.childNodes,d;d=c.length;if(0<d)for(d-=1;0<=d;d--)a.appendChild(c[d])},_scale:function(b,a){var d=e._css.names,f=this._passive;g.set(f,d.transition,a?"none":d.transformName+" "+c.defaults.map.zoomDuration+"ms ease");e._css.matrix(b);g.set(f,d.transform,e._css.matrix(b))},_resize:function(b,a,c){g.set(this._active,{width:a+"px",height:c+"px"});g.set(this._passive,{width:a+"px",height:c+"px"})}});b("extend-esri")&&l.setObject("layers.MapImageLayer",h,e);return h})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./MapImage".split(" "),
function(p,f,l,r,q,g){p=p([g],{declaredClass:"esri.layers.KMLGroundOverlay",constructor:function(e){q.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});l("extend-esri")&&f.setObject("layers.KMLGroundOverlay",p,r);return p})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(p,f,l,r,q,g,e,c,b){var d=q.delegate(c,{mouseenter:g.enter,mouseleave:g.leave,keypress:l._keypress}),
u;l=r("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(b){for(var c=b;;)if(1==c.nodeType&&(this._processTemplateNode(c,function(b,c){return b.getAttribute(c)},this._attach)||this.searchContainerNode)&&c.firstChild)c=c.firstChild;else{if(c==b)break;for(;!c.nextSibling;)if(c=
c.parentNode,c==b)return;c=c.nextSibling}},_processTemplateNode:function(b,c,d){var e=!0,a=this.attachScope||this,f=c(b,"dojoAttachPoint")||c(b,"data-dojo-attach-point");if(f)for(var g=f.split(/\s*,\s*/);f=g.shift();)q.isArray(a[f])?a[f].push(b):a[f]=b,e="containerNode"!=f,this._attachPoints.push(f);if(c=c(b,"dojoAttachEvent")||c(b,"data-dojo-attach-event")){f=c.split(/\s*,\s*/);for(g=q.trim;c=f.shift();)if(c){var l=null;-1!=c.indexOf(":")?(l=c.split(":"),c=g(l[0]),l=g(l[1])):c=g(c);l||(l=c);this._attachEvents.push(d(b,
c,q.hitch(a,l)))}}return e},_attach:function(b,c,f){c=c.replace(/^on/,"").toLowerCase();c="dijitclick"==c?u||(u=p("./a11yclick")):d[c]||c;return e(b,c,f)},_detachTemplateNodes:function(){var b=this.attachScope||this;f.forEach(this._attachPoints,function(c){delete b[c]});this._attachPoints=[];f.forEach(this._attachEvents,function(b){b.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});q.extend(b,{dojoAttachEvent:"",dojoAttachPoint:""});
return l})},"esri/layers/WebTiledLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/url dojo/has dojo/string ../kernel ../urlUtils ../SpatialReference ../geometry/Extent ./TiledMapServiceLayer ./TileInfo".split(" "),function(p,f,l,r,q,g,e,c,b,d,u,w){p=p(u,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(c,e){e||(e={});this.urlTemplate=c;var f=new d(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new b({wkid:102100})),a=new d(-2.0037508342787E7,
-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new b({wkid:102100}));this.initialExtent=e.initialExtent||f;this.fullExtent=e.fullExtent||a;this.tileInfo=e.tileInfo?e.tileInfo:new w({rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,
scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},
{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.spatialReference=new b(this.tileInfo.spatialReference.toJson());
this.copyright=e.copyright||"";var n=new r(c),f=n.scheme+"://"+n.authority+"/";this.urlPath=c.substring(f.length);this.tileServers=e.tileServers||[];-1===n.authority.indexOf("{subDomain}")&&this.tileServers.push(f);if(e.subDomains&&0<e.subDomains.length&&1<n.authority.split(".").length){this.subDomains=e.subDomains;var s;l.forEach(e.subDomains,function(a,b){-1<n.authority.indexOf("${subDomain}")?s=n.scheme+"://"+g.substitute(n.authority,{subDomain:a})+"/":-1<n.authority.indexOf("{subDomain}")&&(s=
n.scheme+"://"+n.authority.replace(/\{subDomain\}/gi,a)+"/");this.tileServers.push(s)},this)}this.tileServers=l.map(this.tileServers,function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a});this._levelToLevelValue=[];l.forEach(this.tileInfo.lods,function(a){this._levelToLevelValue[a.level]=a.levelValue||a.level},this);this.loaded=!0;this.onLoad(this)},getTileUrl:function(b,d,e){b=this._levelToLevelValue[b];var a=this.tileServers[d%this.tileServers.length]+g.substitute(this.urlPath,{level:b,col:e,
row:d}),a=a.replace(/\{level\}/gi,b).replace(/\{row\}/gi,d).replace(/\{col\}/gi,e),a=this.addTimestampToURL(a);return c.addProxy(a)}});q("extend-esri")&&f.setObject("layers.WebTiledLayer",p,e);return p})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../tasks/query ./RenderMode".split(" "),function(p,f,l,r,q,g,e){p=p([e],{declaredClass:"esri.layers._SnapshotMode",constructor:function(c){this.featureLayer=c;this.pagination=c.queryPagination;
this._featureMap={};this._drawFeatures=f.hitch(this,this._drawFeatures);this._queryErrorHandler=f.hitch(this,this._queryErrorHandler)},startup:function(){this.pagination=this.pagination&&null!=this.featureLayer.maxRecordCount;this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},propertyChangeHandler:function(c){this._init&&(c?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+
this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},drawFeature:function(c){var b=c.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(b,c);this._incRefCount(b)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var c=this.featureLayer;c._collection?(c._fireUpdateStart(),c._refresh(!0),c._fireUpdateEnd()):this._fetchAll()},_getRequestId:function(c){return("_"+c.name+c.layerId+c._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchAll:function(){var c=this.featureLayer;
!c._collection&&!c.suspended&&(c._fireUpdateStart(),this._clearIIf(),this._sendRequest())},_sendRequest:function(c){var b=this.map,d=this.featureLayer,e=d.getDefinitionExpression(),f=new g;f.outFields=d.getOutFields();f.where=e||"1\x3d1";f.returnGeometry=!0;f.outSpatialReference=new q(b.spatialReference.toJson());f.timeExtent=d.getTimeDefinition();f.maxAllowableOffset=d._maxOffset;d._ts&&(f._ts=(new Date).getTime());f.orderByFields=d.supportsAdvancedQueries?d.getOrderByFields():null;f.multipatchOption=
d.multipatchOption;this.pagination&&(this._start=f.start=null==c?0:c,f.num=d.maxRecordCount);var m;d._usePatch&&(m=this._getRequestId(d),this._cancelPendingRequest(null,m));d._task.execute(f,this._drawFeatures,this._queryErrorHandler,m)},_drawFeatures:function(c){this._purgeRequests();var b=c.features,d=this.featureLayer,e=d.objectIdField,f,g=b.length,h=c.exceededTransferLimit&&!d._collection,k,a;for(f=0;f<g;f++)k=b[f],a=k.attributes[e],this._addFeatureIIf(a,k),this._incRefCount(a);this._applyTimeFilter(!0);
if(!this.pagination||!h)d._fireUpdateEnd(null,c.exceededTransferLimit?{queryLimitExceeded:!0}:null);h&&(this.pagination&&this._sendRequest(this._start+d.maxRecordCount),d.onQueryLimitExceeded())},_queryErrorHandler:function(c){this._purgeRequests();var b=this.featureLayer;b._errorHandler(c);b._fireUpdateEnd(c)}});l("extend-esri")&&f.setObject("layers._SnapshotMode",p,r);return p})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./RenderMode"],
function(p,f,l,r,q){p=p([q],{declaredClass:"esri.layers._SelectionMode",constructor:function(f){this.featureLayer=f;this._featureMap={}},propertyChangeHandler:function(f){this._init&&0===f&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)}});l("extend-esri")&&f.setObject("layers._SelectionMode",p,r);return p})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(p,
f,l,r,q,g,e,c){p=p(c,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(b,c){b&&f.isString(b)&&(this._url=e.urlToObject(this.url=b));c&&c.requestOptions&&(this.requestOptions=c.requestOptions);this.normalization=!0;this._errorHandler=f.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var b=this._url,c=/^http:/i;this.url&&(this.url=this.url.replace(c,"https:"));b&&b.path&&(b.path=b.path.replace(c,"https:"))},_encode:function(b,
c,e){var g,m,h={},k,a;for(k in b)if("declaredClass"!==k&&(g=b[k],m=typeof g,null!==g&&void 0!==g&&"function"!==m))if(f.isArray(g)){h[k]=[];a=g.length;for(m=0;m<a;m++)h[k][m]=this._encode(g[m])}else"object"===m?g.toJson&&(m=g.toJson(e&&e[k]),"esri.tasks.FeatureSet"===g.declaredClass&&m.spatialReference&&(m.sr=m.spatialReference,delete m.spatialReference),h[k]=c?m:l.toJson(m)):h[k]=g;return h},_successHandler:function(b,c,e,f){c&&this[c].apply(this,b);e&&e.apply(null,b);f&&g._resDfd(f,b)},_errorHandler:function(b,
c,e){this.onError(b);c&&c(b);e&&e.errback(b)},setNormalization:function(b){this.normalization=b},onError:function(){}});r("extend-esri")&&(q.Task=p);return p})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(p,f,l){p.DeferredList=function(p,q,g,e,c){var b=[];f.call(this);var d=this;0===p.length&&!q&&this.resolve([0,[]]);var u=0;l.forEach(p,function(c,f){function h(c,a){b[f]=[c,a];u++;u===p.length&&d.resolve(b)}c.then(function(b){q?d.resolve([f,
b]):h(!0,b)},function(b){g?d.reject(b):h(!1,b);if(e)return null;throw b;})})};p.DeferredList.prototype=new f;p.DeferredList.prototype.gatherResults=function(f){f=new p.DeferredList(f,!1,!0,!1);f.addCallback(function(f){var g=[];l.forEach(f,function(e){g.push(e[1])});return g});return f};return p.DeferredList})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(p,f,l,r,q,g){p=r("dijit._OnDijitClickMixin",null,
{connect:function(e,c,b){return this.inherited(arguments,[e,"ondijitclick"==c?g:c,b])}});p.a11yclick=g;return p})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(p,f,l,r){function q(c){if((c.keyCode===p.ENTER||c.keyCode===p.SPACE)&&!/input|button|textarea/i.test(c.target.nodeName))for(c=c.target;c;c=c.parentNode)if(c.dojoClick)return!0}var g;l(document,"keydown",function(c){q(c)?(g=c.target,c.preventDefault()):g=null});l(document,"keyup",function(c){q(c)&&
c.target==g&&(g=null,l.emit(c.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:c.ctrlKey,shiftKey:c.shiftKey,metaKey:c.metaKey,altKey:c.altKey,_origType:c.type}))});var e=function(c,b){c.dojoClick=!0;return l(c,"click",b)};e.click=e;e.press=function(c,b){var d=l(c,r.press,function(c){("mousedown"!=c.type||f.isLeft(c))&&b(c)}),e=l(c,"keydown",function(c){(c.keyCode===p.ENTER||c.keyCode===p.SPACE)&&b(c)});return{remove:function(){d.remove();e.remove()}}};e.release=function(c,b){var d=l(c,r.release,
function(c){("mouseup"!=c.type||f.isLeft(c))&&b(c)}),e=l(c,"keyup",function(c){(c.keyCode===p.ENTER||c.keyCode===p.SPACE)&&b(c)});return{remove:function(){d.remove();e.remove()}}};e.move=r.move;return e})},"esri/layers/WMSLayer":function(){define("require dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../request ../urlUtils ../SpatialReference ../geometry/Extent ./DynamicMapServiceLayer ./WMSLayerInfo dojo/query".split(" "),function(p,f,l,r,q,g,e,c,b,d,u,
w,m){l=l([w],{declaredClass:"esri.layers.WMSLayer",_CRS_TO_EPSG:{84:4326,83:4269,27:4267},_REVERSED_LAT_LONG_RANGES:[[4001,4999],[2044,2045],[2081,2083],[2085,2086],[2093,2093],[2096,2098],[2105,2132],[2169,2170],[2176,2180],[2193,2193],[2200,2200],[2206,2212],[2319,2319],[2320,2462],[2523,2549],[2551,2735],[2738,2758],[2935,2941],[2953,2953],[3006,3030],[3034,3035],[3058,3059],[3068,3068],[3114,3118],[3126,3138],[3300,3301],[3328,3335],[3346,3346],[3350,3352],[3366,3366],[3416,3416],[20004,20032],
[20064,20092],[21413,21423],[21473,21483],[21896,21899],[22171,22177],[22181,22187],[22191,22197],[25884,25884],[27205,27232],[27391,27398],[27492,27492],[28402,28432],[28462,28492],[30161,30179],[30800,30800],[31251,31259],[31275,31279],[31281,31290],[31466,31700]],_WEB_MERCATOR:[102100,3857,102113,900913],_WORLD_MERCATOR:[3395,54004],allExtents:[],version:null,constructor:function(c,d){var a=b.urlToObject(c);if(a.query&&(a.query.version||a.query.Version||a.query.VERSION))this.version=a.query.version||
a.query.Version||a.query.VERSION;this.url=c=this._stripParameters(c,"version service request bbox format height width layers srs crs styles transparent bgcolor exceptions time elevation sld wfs".split(" "));this._url=b.urlToObject(c);this._getCapabilitiesURL=c;this._initLayer=r.hitch(this,this._initLayer);this._parseCapabilities=r.hitch(this,this._parseCapabilities);this._getCapabilitiesError=r.hitch(this,this._getCapabilitiesError);d?(this.imageFormat=this._getImageFormat(d.format),this.imageTransparency=
!1===d.transparent?!1:!0,this.visibleLayers=d.visibleLayers?d.visibleLayers:[],this.version=d.version||this.version,d.resourceInfo?this._readResourceInfo(d.resourceInfo):this._getCapabilities()):(this.imageFormat="image/png",this.imageTransparency=!0,this.visibleLayers=[],this._getCapabilities());this._blankImageURL=p.toUrl("../images/pixel.png")},setVisibleLayers:function(b){this.visibleLayers=(b=this._checkVisibleLayersList(b))?b:[];this.refresh(!0)},setImageFormat:function(b){this.imageFormat=
this._getImageFormat(b);this.refresh(!0)},setImageTransparency:function(b){this.imageTransparency=b;this.refresh(!0)},getImageUrl:function(c,d,a,e){if(!this.visibleLayers||0===this.visibleLayers.length)e(this._blankImageURL);else{var f=c.spatialReference.wkid;-1===q.indexOf(this.spatialReferences,f)&&c.spatialReference.latestWkid&&(f=c.spatialReference.latestWkid);if(q.some(this._WEB_MERCATOR,function(a){return a==f})){var g=q.filter(this.spatialReferences,function(a){return q.some(this._WEB_MERCATOR,
function(b){return b==a})},this);0==g.length&&(g=q.filter(this.spatialReferences,function(a){return q.some(this._WORLD_MERCATOR,function(b){return b==a})},this));f=0<g.length?g[0]:this._WEB_MERCATOR[0]}this.spatialReferences=q.filter(this.spatialReferences,function(a){return a!==f});this.spatialReferences.unshift(f);var g=c.xmin,m=c.xmax,l=c.ymin,x=c.ymax;c={SERVICE:"WMS",REQUEST:"GetMap"};c.FORMAT=this.imageFormat;c.TRANSPARENT=this.imageTransparency?"TRUE":"FALSE";c.STYLES="";c.VERSION=this.version;
c.LAYERS=this.visibleLayers?this.visibleLayers.toString():null;c.WIDTH=d;c.HEIGHT=a;this.maxWidth<d&&(c.WIDTH=this.maxWidth);this.maxHeight<a&&(c.HEIGHT=this.maxHeight);d=f?f:NaN;isNaN(d)||("1.3.0"==this.version?c.CRS="EPSG:"+d:c.SRS="EPSG:"+d);"1.3.0"==this.version&&this._useLatLong(d)?c.BBOX=l+","+g+","+x+","+m:c.BBOX=g+","+l+","+m+","+x;d=this.getMapURL;var A;d+=-1==d.indexOf("?")?"?":"";for(A in c)d+="?"==d.substring(d.length-1,d.length)?"":"\x26",d+=A+"\x3d"+c[A];e(b.addProxy(d))}},_initLayer:function(b,
c){this.spatialReference=new d(this.extent.spatialReference);this.initialExtent=new u(this.extent);this.fullExtent=new u(this.extent);this.visibleLayers=this._checkVisibleLayersList(this.visibleLayers);this.loaded=!0;this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))},_readResourceInfo:function(b){b.extent?b.layerInfos?(this.extent=b.extent,this.allExtents[0]=b.extent,this.layerInfos=b.layerInfos,this.description=b.description?b.description:"",this.copyright=b.copyright?
b.copyright:"",this.title=b.title?b.title:"",this.getMapURL=b.getMapURL?b.getMapURL:this._getCapabilitiesURL,this.version=b.version?b.version:"1.3.0",this.maxWidth=b.maxWidth?b.maxWidth:5E3,this.maxHeight=b.maxHeight?b.maxHeight:5E3,this.spatialReferences=b.spatialReferences?b.spatialReferences:[],this.imageFormat=this._getImageFormat(b.format),this.setScaleRange(b.minScale,b.maxScale),this._initLayer()):console.error("esri.layers.WMSLayer: unable to find the 'layerInfos' property in resourceInfo"):
console.error("esri.layers.WMSLayer: unable to find the 'extent' property in resourceInfo")},_getCapabilities:function(){var b=this._url.query?this._url.query:{};b.SERVICE="WMS";b.REQUEST="GetCapabilities";this.version&&(b.VERSION=this.version);var d=this._url.path+"?",a;for(a in b)d+="?"==d.substring(d.length-1,d.length)?"":"\x26",d+=a+"\x3d"+b[a];c({url:d,handleAs:"xml",headers:{"Content-Type":null},load:this._parseCapabilities,error:this._getCapabilitiesError},{usePost:!1})},_parseCapabilities:function(b){if(b){this.version=
this._getAttributeValue("WMS_Capabilities","version",b,null);this.version||(this.version=this._getAttributeValue("WMT_MS_Capabilities","version",b,"1.3.0"));var c=this._getTag("Service",b);this.title=this._getTagValue("Title",c,"");if(!this.title||0==this.title.length)this.title=this._getTagValue("Name",c,"");this.copyright=this._getTagValue("AccessConstraints",c,"");this.description=this._getTagValue("Abstract",c,"");this.maxWidth=parseInt(this._getTagValue("MaxWidth",c,5E3),10);this.maxHeight=parseInt(this._getTagValue("MaxHeight",
c,5E3),10);if(c=this._getTag("Layer",b)){var a=this._getLayerInfo(c),d=0,e=null,c=this._getTag("Capability",b);q.forEach(c.childNodes,function(b){"Layer"==b.nodeName&&(0===d?e=b:(1===d&&a.name&&(a.name="",a.subLayers=[],a.subLayers.push(this._getLayerInfo(e))),a.subLayers.push(this._getLayerInfo(b))),d++)},this);if(a){this.layerInfos=a.subLayers;if(!this.layerInfos||0==this.layerInfos.length)this.layerInfos=[a];this.extent=a.extent;this.extent||(a.extent=new u(this.layerInfos[0].extent.toJson()),
this.extent=a.extent);this.allExtents=a.allExtents;if(!this.allExtents||!this.allExtents.length)a.allExtents=[],dojo.forEach(this.layerInfos[0].allExtents,function(b,c){b&&(a.allExtents[c]=new u(b.toJson()))}),this.allExtents=a.allExtents;this.spatialReferences=a.spatialReferences;0==this.spatialReferences.length&&0<this.layerInfos.length&&(this.spatialReferences=this.layerInfos[0].spatialReferences)}this.getMapURL=this._getCapabilitiesURL;if((c=f.query("DCPType",this._getTag("GetMap",b)))&&0<c.length)if((c=
f.query("HTTP",c[0]))&&0<c.length)if((c=f.query("Get",c[0]))&&0<c.length)if(c=this._getAttributeValue("OnlineResource","xlink:href",c[0],null))c.indexOf("\x26")==c.length-1&&(c=c.substring(0,c.length-1)),this.getMapURL=c;this.getMapFormats=[];0==f.query("Operation",b).length?q.forEach(f.query("Format",this._getTag("GetMap",b)),function(a){this.getMapFormats.push(a.text?a.text:a.textContent)},this):q.forEach(f.query("Operation",b),function(a){"GetMap"==a.getAttribute("name")&&q.forEach(f.query("Format",
a),function(a){this.getMapFormats.push(a.text?a.text:a.textContent)},this)},this);q.some(this.getMapFormats,function(a){return-1<a.indexOf(this.imageFormat)},this)||(this.imageFormat=this.getMapFormats[0]);this._initLayer()}else this._getCapabilitiesError({error:{message:"Response does not contain any layers."}})}else this.onError("GetCapabilities request for "+this._getCapabilitiesURL+" failed. (Response is null.)")},_getCapabilitiesError:function(b,c){this.onError("GetCapabilities request for "+
this._getCapabilitiesURL+" failed.",b)},_getLayerInfo:function(b){if(!b)return null;var c=new m;c.name="";c.title="";c.description="";c.allExtents=[];c.spatialReferences=[];c.subLayers=[];var a=this._getTag("LatLonBoundingBox",b);a&&(c.allExtents[0]=this._getExtent(a,4326));var e=this._getTag("EX_GeographicBoundingBox",b);if(e){var f=new u(0,0,0,0,new d({wkid:4326}));f.xmin=parseFloat(this._getTagValue("westBoundLongitude",e,0));f.ymin=parseFloat(this._getTagValue("southBoundLatitude",e,0));f.xmax=
parseFloat(this._getTagValue("eastBoundLongitude",e,0));f.ymax=parseFloat(this._getTagValue("northBoundLatitude",e,0));c.allExtents[0]=f}!a&&!e&&(f=new u(-180,-90,180,90,new d({wkid:4326})),c.allExtents[0]=f);c.extent=c.allExtents[0];var g=-1<q.indexOf(["1.0.0","1.1.0","1.1.1"],this.version)?"SRS":"CRS";q.forEach(b.childNodes,function(a){if("Name"==a.nodeName)c.name=(a.text?a.text:a.textContent)||"";else if("Title"==a.nodeName)c.title=(a.text?a.text:a.textContent)||"";else if("Abstract"==a.nodeName)c.description=
(a.text?a.text:a.textContent)||"";else if("BoundingBox"==a.nodeName){var b=a.getAttribute(g);b&&0===b.indexOf("EPSG:")?(b=parseInt(b.substring(5),10),0!==b&&!isNaN(b)&&(a="1.3.0"==this.version?this._getExtent(a,b,this._useLatLong(b)):this._getExtent(a,b),c.allExtents[b]=a,c.extent||(c.extent=a))):b&&0===b.indexOf("CRS:")?(b=parseInt(b.substring(4),10),0!==b&&!isNaN(b)&&(this._CRS_TO_EPSG[b]&&(b=this._CRS_TO_EPSG[b]),c.allExtents[b]=this._getExtent(a,b))):(b=parseInt(b,10),0!==b&&!isNaN(b)&&(c.allExtents[b]=
this._getExtent(a,b)))}else if(a.nodeName==g)a=(a.text?a.text:a.textContent).split(" "),q.forEach(a,function(a){a=-1<a.indexOf(":")?parseInt(a.split(":")[1],10):parseInt(a,10);0!==a&&!isNaN(a)&&(this._CRS_TO_EPSG[a]&&(a=this._CRS_TO_EPSG[a]),-1==q.indexOf(c.spatialReferences,a)&&c.spatialReferences.push(a))},this);else if("Style"==a.nodeName){if(a=this._getTag("LegendURL",a))if(a=this._getTag("OnlineResource",a))c.legendURL=a.getAttribute("xlink:href")}else"Layer"===a.nodeName&&c.subLayers.push(this._getLayerInfo(a))},
this);c.title=c.title||c.name;return c},_getImageFormat:function(b){switch(b?b.toLowerCase():""){case "jpg":return"image/jpeg";case "bmp":return"image/bmp";case "gif":return"image/gif";case "svg":return"image/svg+xml";default:return"image/png"}},getImageFormat:function(){switch(this.imageFormat?this.imageFormat.toLowerCase():""){case "image/jpeg":return"jpg";case "image/bmp":return"bmp";case "image/gif":return"gif";case "image/svg+xml":return"svg";default:return"png"}},_getExtent:function(b,c,a){var e;
if(b){e=new u;var f=parseFloat(b.getAttribute("minx")),g=parseFloat(b.getAttribute("miny")),m=parseFloat(b.getAttribute("maxx"));b=parseFloat(b.getAttribute("maxy"));a?(e.xmin=isNaN(g)?-1*Number.MAX_VALUE:g,e.ymin=isNaN(f)?-1*Number.MAX_VALUE:f,e.xmax=isNaN(b)?Number.MAX_VALUE:b,e.ymax=isNaN(m)?Number.MAX_VALUE:m):(e.xmin=isNaN(f)?-1*Number.MAX_VALUE:f,e.ymin=isNaN(g)?-1*Number.MAX_VALUE:g,e.xmax=isNaN(m)?Number.MAX_VALUE:m,e.ymax=isNaN(b)?Number.MAX_VALUE:b);e.spatialReference=new d({wkid:c})}return e},
_useLatLong:function(b){var c,a;for(a=0;a<this._REVERSED_LAT_LONG_RANGES.length;a++){var d=this._REVERSED_LAT_LONG_RANGES[a];if(b>=d[0]&&b<=d[1]){c=!0;break}}return c},_getTag:function(b,c){var a=f.query(b,c);return a&&0<a.length?a[0]:null},_getTagValue:function(b,c,a){return(b=f.query(b,c))&&0<b.length?b[0].text?b[0].text:b[0].textContent:a},_getAttributeValue:function(b,c,a,d){return(b=f.query(b,a))&&0<b.length?b[0].getAttribute(c):d},_checkVisibleLayersList:function(b){if(b&&(0<b.length&&this.layerInfos&&
0<this.layerInfos.length)&&"number"==typeof b[0]){var c=[];q.forEach(b,function(a){a<this.layerInfos.length&&c.push(this.layerInfos[a].name)},this);b=c}return b},_stripParameters:function(c,d){var a=b.urlToObject(c),e,f=[];for(e in a.query)-1===q.indexOf(d,e.toLowerCase())&&f.push(e+"\x3d"+a.query[e]);return a.path+(f.length?"?"+f.join("\x26"):"")}});g("extend-esri")&&r.setObject("layers.WMSLayer",l,e);return l})},"esri/layers/CSVLayer":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../arcgis/csv ./FeatureLayer ../geometry/Extent ../tasks/FeatureSet".split(" "),
function(p,f,l,r,q,g,e,c,b){f=f(e,{declaredClass:"esri.layers.CSVLayer",_preventInit:!0,_fieldTypeMap:{Date:"esriFieldTypeDate",Number:"esriFieldTypeDouble",String:"esriFieldTypeString"},constructor:function(b,c){this.url=b;c=l.mixin(c,{outFields:["*"]});this.columnDelimiter=c.columnDelimiter;this.latitudeFieldName=c.latitudeFieldName;this.longitudeFieldName=c.longitudeFieldName;var e=c.layerDefinition;e||(e={fields:c.fields||[],geometryType:"esriGeometryPoint",copyrightText:c.copyright},c.fields&&
p.forEach(c.fields,l.hitch(this,function(b){b.type=this._fieldTypeMap[b.type||"String"];b.alias||(b.alias=b.name)})));this._buildCsvFcParam={url:this.url,columnDelimiter:this.columnDelimiter,layerDefinition:e};this.latitudeFieldName&&this.longitudeFieldName&&(this._buildCsvFcParam.locationInfo={locationType:"coordinates",latitudeFieldName:this.latitudeFieldName,longitudeFieldName:this.longitudeFieldName});this._projectFeatures=l.hitch(this,this._projectFeatures);this._addFeatures=l.hitch(this,this._addFeatures);
this._initCSVLayer(c)},refresh:function(){this._fireUpdateStart();this.applyEdits(null,null,this.graphics);this._loadFeatures()},_setMap:function(b){var c=this.inherited(arguments);this._fireUpdateStart();this._projectFeatures(this._csvFC).then(this._addFeatures).otherwise(this._errorHandler);this._csvFC=null;return c},_initCSVLayer:function(b){var c=this;g.buildCSVFeatureCollection(this._buildCsvFcParam).then(function(e){c._csvFC=e;var f=e.layerDefinition;f.extent=c._getFCExtent(e);c._initFeatureLayer({layerDefinition:f},
b)}).otherwise(this._errorHandler)},_loadFeatures:function(){g.buildCSVFeatureCollection(this._buildCsvFcParam).then(this._projectFeatures).then(this._addFeatures).otherwise(this._errorHandler)},_projectFeatures:function(b){return g.projectFeatureCollection(b,this._map.spatialReference)},_addFeatures:function(c){c=new b(c.featureSet);this.applyEdits(c.features,null,null);this._fireUpdateEnd()},_getFCExtent:function(b){var e;if(b&&b.featureSet&&b.featureSet.features){b=b.featureSet.features;var f=
b.length;if(1<f){var g=b[0].geometry;e=new c(g.x,g.y,g.x,g.y);for(f-=1;0<f;f--)g=b[f].geometry,e.xmin=Math.min(e.xmin,g.x),e.ymin=Math.min(e.ymin,g.y),e.xmax=Math.max(e.xmax,g.x),e.ymax=Math.max(e.ymax,g.y);0>=e.getWidth()&&0>=e.getHeight()&&(e=null)}}return e}});r("extend-esri")&&l.setObject("layers.CSVLayer",f,q);return f})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(p,f,l,r){l(function(){f("highcontrast")&&p.add(r.body(),"dijit_a11y")});
return f})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(p,f,l,r,q,g,e,c){var b=f("dijit._TemplatedMixin",c,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(b){var c=this.declaredClass,f=this;return e.substitute(b,this,function(b,d){"!"==d.charAt(0)&&(b=r.getObject(d.substr(1),!1,f));if("undefined"==typeof b)throw Error(c+
" template:"+d);return null==b?"":"!"==d.charAt(0)?b:b.toString().replace(/"/g,"\x26quot;")},this)},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=p(this.templatePath,{sanitize:!0}));var c=b.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),e;if(r.isString(c)){if(e=l.toDom(this._stringRepl(c),this.ownerDocument),1!=e.nodeType)throw Error("Invalid template: "+c);}else e=c.cloneNode(!0);this.domNode=e}this.inherited(arguments);this._rendered||
this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(b){var c=this.containerNode;if(b&&c)for(;b.hasChildNodes();)c.appendChild(b.firstChild)}});b._templateCache={};b.getCachedTemplate=function(c,f,g){var m=b._templateCache,h=c,k=m[h];if(k){try{if(!k.ownerDocument||k.ownerDocument==(g||document))return k}catch(a){}l.destroy(k)}c=e.trim(c);if(f||c.match(/\$\{([^\}]+)\}/g))return m[h]=c;f=l.toDom(c,g);if(1!=f.nodeType)throw Error("Invalid template: "+c);return m[h]=f};g("ie")&&
q(window,"unload",function(){var c=b._templateCache,e;for(e in c){var f=c[e];"object"==typeof f&&l.destroy(f);delete c[e]}});return b})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ./Task ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/jsonUtils".split(" "),function(p,f,l,r,q,g,e,c,b,d,u,w,m,h,k){p=p(d,{declaredClass:"esri.tasks.GeometryService",
_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],
"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(a){a=f.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=a(this,this._lengthsHandler);this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);
this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);this._trimExtendHandler=a(this,this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,
this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=a(this,this._distanceHandler);this._toGeoCoordinateHandler=a(this,this._toGeoCoordinateHandler);this._fromGeoCoordinateHandler=a(this,this._fromGeoCoordinateHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var b=[],c,d=a.length;for(c=0;c<d;c++)b.push(a[c].toJson());return{geometryType:k.getJsonType(a[0]),geometries:b}},_decodeGeometries:function(a,b,c){var d=k.getGeometryType(b);a=a.geometries;
var e=[],h={spatialReference:c.toJson()},g=f.mixin;l.forEach(a,function(a,b){e[b]=new d(g(a,h))});return e},_toProjectGeometry:function(a){var b=a.spatialReference.toJson();return a instanceof u?new m({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:b}):new w({paths:[[].concat(a.points)],spatialReference:b})},_fromProjectedGeometry:function(a,b,c){return"esriGeometryEnvelope"===b?(a=a.rings[0],new u(a[0][0],a[0][1],a[2][0],a[2][1],c)):new h({points:a.paths[0],
spatialReference:c.toJson()})},project:function(a,d,e,h){var g=f.mixin({},this._url.query,{f:"json"}),l;a.geometries?(h=e,e=d,d=a.outSR,l=a.geometries[0],g=f.mixin(g,a.toJson())):(l=a[0],g=f.mixin(g,{outSR:d.wkid||r.toJson(d.toJson()),inSR:l.spatialReference.wkid||r.toJson(l.spatialReference.toJson()),geometries:r.toJson(this._encodeGeometries(a))}));var m=k.getJsonType(l),A=this._projectHandler,z=this._errorHandler,p=new q(b._dfdCanceller);p._pendingDfd=c({url:this._url.path+"/project",content:g,
callbackParamName:"callback",load:function(a,b){A(a,b,m,d,e,h,p)},error:function(a){z(a,h,p)}});return p},_projectHandler:function(a,b,c,d,e,f,k){try{var g=this._decodeGeometries(a,c,d);this._successHandler([g],"onProjectComplete",e,k)}catch(h){this._errorHandler(h,f,k)}},onProjectComplete:function(){},simplify:function(a,d,e){var g=a[0].spatialReference,h=f.mixin({},this._url.query,{f:"json",sr:g.wkid?g.wkid:r.toJson(g.toJson()),geometries:r.toJson(this._encodeGeometries(a))}),l=k.getJsonType(a[0]),
m=this._simplifyHandler,A=this._errorHandler,z=new q(b._dfdCanceller);z._pendingDfd=c({url:this._url.path+"/simplify",content:h,callbackParamName:"callback",load:function(a,b){m(a,b,l,g,d,e,z)},error:function(a){A(a,e,z)}});return z},_simplifyHandler:function(a,b,c,d,e,f,k){try{var g=this._decodeGeometries(a,c,d);this._successHandler([g],"onSimplifyComplete",e,k)}catch(h){this._errorHandler(h,f,k)}},onSimplifyComplete:function(){},convexHull:function(a,d,e){var k=a[0].spatialReference;a=f.mixin({},
this._url.query,{f:"json",sr:r.toJson(k.toJson()),geometries:r.toJson(this._encodeGeometries(a))});var g=this._convexHullHandler,h=this._errorHandler,l=new q(b._dfdCanceller);l._pendingDfd=c({url:this._url.path+"/convexHull",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,k,d,e,l)},error:function(a){h(a,e,l)}});return l},_convexHullHandler:function(a,b,c,d,e,f){try{var g=k.fromJson(a.geometry).setSpatialReference(c);this._successHandler([g],"onConvexHullComplete",d,f)}catch(h){this._errorHandler(h,
e,f)}},onConvexHullComplete:function(){},union:function(a,d,e){var k=a[0].spatialReference;a=f.mixin({},this._url.query,{f:"json",sr:r.toJson(k.toJson()),geometries:r.toJson(this._encodeGeometries(a))});var g=this._unionHandler,h=this._errorHandler,l=new q(b._dfdCanceller);l._pendingDfd=c({url:this._url.path+"/union",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,k,d,e,l)},error:function(a){h(a,e,l)}});return l},_unionHandler:function(a,b,c,d,e,f){try{var g=k.fromJson(a.geometry).setSpatialReference(c);
this._successHandler([g],"onUnionComplete",d,f)}catch(h){this._errorHandler(h,e,f)}},onUnionComplete:function(){},autoComplete:function(a,d,e,k){var g=a[0].spatialReference;a=f.mixin({},this._url.query,{f:"json",sr:r.toJson(g.toJson()),polygons:r.toJson(this._encodeGeometries(a).geometries),polylines:r.toJson(this._encodeGeometries(d).geometries)});var h=this._autoCompleteHandler,l=this._errorHandler,m=new q(b._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/autoComplete",content:a,callbackParamName:"callback",
load:function(a,b){h(a,b,g,e,k,m)},error:function(a){l(a,k,m)}});return m},_autoCompleteHandler:function(a,b,c,d,e,f){try{var k=a.geometries;a=[];var g,h=k.length;for(g=0;g<h;g++)a[g]=new m({spatialReference:c,rings:k[g].rings});this._successHandler([a],"onAutoCompleteComplete",d,f)}catch(l){this._errorHandler(l,e,f)}},onAutoCompleteComplete:function(){},reshape:function(a,d,e,g){var h=a.spatialReference;a=f.mixin({},this._url.query,{f:"json",sr:r.toJson(h.toJson()),target:r.toJson({geometryType:k.getJsonType(a),
geometry:a.toJson()}),reshaper:r.toJson(d.toJson())});var l=this._reshapeHandler,m=this._errorHandler,p=new q(b._dfdCanceller);p._pendingDfd=c({url:this._url.path+"/reshape",content:a,callbackParamName:"callback",load:function(a,b){l(a,b,h,e,g,p)},error:function(a){m(a,g,p)}});return p},_reshapeHandler:function(a,b,c,d,e,f){try{var g=k.fromJson(a.geometry).setSpatialReference(c);this._successHandler([g],"onReshapeComplete",d,f)}catch(h){this._errorHandler(h,e,f)}},onReshapeComplete:function(){},cut:function(a,
d,e,g){var h=a[0].spatialReference,m=l.map(a,function(a){return a.toJson()});a=f.mixin({},this._url.query,{f:"json",sr:r.toJson(h.toJson()),target:r.toJson({geometryType:k.getJsonType(a[0]),geometries:m}),cutter:r.toJson(d.toJson())});var p=this._cutHandler,A=this._errorHandler,z=new q(b._dfdCanceller);z._pendingDfd=c({url:this._url.path+"/cut",content:a,callbackParamName:"callback",load:function(a,b){p(a,b,h,e,g,z)},error:function(a){A(a,g,z)}});return z},_cutHandler:function(a,b,c,d,e,f){try{var g=
a.geometries,h={};h.cutIndexes=a.cutIndexes;h.geometries=[];l.forEach(g,function(a){h.geometries.push(k.fromJson(a).setSpatialReference(c))});this._successHandler([h],"onCutComplete",d,f)}catch(m){this._errorHandler(m,e,f)}},onCutComplete:function(){},intersect:function(a,d,e,g){var h=a[0].spatialReference;a=f.mixin({},this._url.query,{f:"json",sr:r.toJson(h.toJson()),geometries:r.toJson(this._encodeGeometries(a)),geometry:r.toJson({geometryType:k.getJsonType(d),geometry:d.toJson()})});var l=this._intersectHandler,
m=this._errorHandler,p=new q(b._dfdCanceller);p._pendingDfd=c({url:this._url.path+"/intersect",content:a,callbackParamName:"callback",load:function(a,b){l(a,b,h,e,g,p)},error:function(a){m(a,g,p)}});return p},_intersectHandler:function(a,b,c,d,e,f){try{var g=[];l.forEach(a.geometries,function(a){g.push(k.fromJson(a).setSpatialReference(c))});this._successHandler([g],"onIntersectComplete",d,f)}catch(h){this._errorHandler(h,e,f)}},onIntersectComplete:function(){},difference:function(a,d,e,g){var h=
a[0].spatialReference;a=f.mixin({},this._url.query,{f:"json",sr:r.toJson(h.toJson()),geometries:r.toJson(this._encodeGeometries(a)),geometry:r.toJson({geometryType:k.getJsonType(d),geometry:d.toJson()})});var l=this._differenceHandler,m=this._errorHandler,p=new q(b._dfdCanceller);p._pendingDfd=c({url:this._url.path+"/difference",content:a,callbackParamName:"callback",load:function(a,b){l(a,b,h,e,g,p)},error:function(a){m(a,g,p)}});return p},_differenceHandler:function(a,b,c,d,e,f){try{var g=[];l.forEach(a.geometries,
function(a){g.push(k.fromJson(a).setSpatialReference(c))});this._successHandler([g],"onDifferenceComplete",d,f)}catch(h){this._errorHandler(h,e,f)}},onDifferenceComplete:function(){},buffer:function(a,d,e){var g=f.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.outSpatialReference||a.geometries[0].spatialReference,k=this._bufferHandler,l=this._errorHandler,m=new q(b._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/buffer",content:g,callbackParamName:"callback",load:function(a,b){k(a,b,h,d,
e,m)},error:function(a){l(a,e,m)}});return m},_bufferHandler:function(a,b,c,d,e,f){try{var g=a.geometries;a=[];var h,k=g.length;for(h=0;h<k;h++)a[h]=new m({spatialReference:c,rings:g[h].rings});this._successHandler([a],"onBufferComplete",d,f)}catch(l){this._errorHandler(l,e,f)}},onBufferComplete:function(){},areasAndLengths:function(a,d,e){a=f.mixin({},this._url.query,{f:"json"},a.toJson());var g=this._areasAndLengthsHandler,h=this._errorHandler,k=new q(b._dfdCanceller);k._pendingDfd=c({url:this._url.path+
"/areasAndLengths",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,d,e,k)},error:function(a){h(a,e,k)}});return k},_areasAndLengthsHandler:function(a,b,c,d,e){try{this._successHandler([a],"onAreasAndLengthsComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onAreasAndLengthsComplete:function(){},lengths:function(a,d,e){a=f.mixin({},this._url.query,{f:"json"},a.toJson());var g=this._lengthsHandler,h=this._errorHandler,k=new q(b._dfdCanceller);k._pendingDfd=c({url:this._url.path+"/lengths",
content:a,callbackParamName:"callback",load:function(a,b){g(a,b,d,e,k)},error:function(a){h(a,e,k)}});return k},_lengthsHandler:function(a,b,c,d,e){try{this._successHandler([a],"onLengthsComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onLengthsComplete:function(){},labelPoints:function(a,d,e){var g=l.map(a,function(a){return a.toJson()}),h=a[0].spatialReference,g=f.mixin({},this._url.query,{f:"json",sr:h.wkid?h.wkid:r.toJson(h.toJson()),polygons:r.toJson(g)}),k=this._labelPointsHandler,m=this._errorHandler,
p=new q(b._dfdCanceller);p._pendingDfd=c({url:this._url.path+"/labelPoints",content:g,callbackParamName:"callback",load:function(b,c){k(b,c,a,h,d,e,p)},error:function(a){m(a,e,p)}});return p},_labelPointsHandler:function(a,b,c,d,e,f,g){try{var h=[];l.forEach(a.labelPoints,function(a){h.push(k.fromJson(a).setSpatialReference(d))});this._successHandler([h],"onLabelPointsComplete",e,g)}catch(m){this._errorHandler(m,f,g)}},onLabelPointsComplete:function(){},relation:function(a,d,e){a=f.mixin({},this._url.query,
{f:"json"},a.toJson());var g=this._relationHandler,h=this._errorHandler,k=new q(b._dfdCanceller);k._pendingDfd=c({url:this._url.path+"/relation",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,d,e,k)},error:function(a){h(a,e,k)}});return k},_relationHandler:function(a,b,c,d,e){try{this._successHandler([a.relations],"onRelationComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onRelationComplete:function(){},trimExtend:function(a,d,e){var g=f.mixin({},this._url.query,{f:"json"},a.toJson()),
h=a.sr,k=this._trimExtendHandler,l=this._errorHandler,m=new q(b._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/trimExtend",content:g,callbackParamName:"callback",load:function(a,b){k(a,b,h,d,e,m)},error:function(a){l(a,e,m)}});return m},_trimExtendHandler:function(a,b,c,d,e,f){try{var g=a.geometries;a=[];var h,k=g.length;for(h=0;h<k;h++)a[h]=new w({spatialReference:c,paths:g[h].paths});this._successHandler([a],"onTrimExtendComplete",d,f)}catch(l){this._errorHandler(l,e,f)}},onTrimExtendComplete:function(){},
densify:function(a,d,e){var g=f.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.geometries[0].spatialReference,k=this._densifyHandler,l=this._errorHandler,m=new q(b._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/densify",content:g,callbackParamName:"callback",load:function(a,b){k(a,b,h,d,e,m)},error:function(a){l(a,e,m)}});return m},_densifyHandler:function(a,b,c,d,e,f){try{var g=[];l.forEach(a.geometries,function(a){g.push(k.fromJson(a).setSpatialReference(c))});this._successHandler([g],
"onDensifyComplete",d,f)}catch(h){this._errorHandler(h,e,f)}},onDensifyComplete:function(){},generalize:function(a,d,e){var g=f.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.geometries[0].spatialReference,k=this._generalizeHandler,l=this._errorHandler,m=new q(b._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/generalize",content:g,callbackParamName:"callback",load:function(a,b){k(a,b,h,d,e,m)},error:function(a){l(a,e,m)}});return m},_generalizeHandler:function(a,b,c,d,e,f){try{var g=[];
l.forEach(a.geometries,function(a){g.push(k.fromJson(a).setSpatialReference(c))});this._successHandler([g],"onGeneralizeComplete",d,f)}catch(h){this._errorHandler(h,e,f)}},onGeneralizeComplete:function(){},offset:function(a,d,e){var g=f.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.geometries[0].spatialReference,k=this._offsetHandler,l=this._errorHandler,m=new q(b._dfdCanceller);m._pendingDfd=c({url:this._url.path+"/offset",content:g,callbackParamName:"callback",load:function(a,b){k(a,b,h,d,
e,m)},error:function(a){l(a,e,m)}});return m},_offsetHandler:function(a,b,c,d,e,f){try{var g=[];l.forEach(a.geometries,function(a){g.push(k.fromJson(a).setSpatialReference(c))});this._successHandler([g],"onOffsetComplete",d,f)}catch(h){this._errorHandler(h,e,f)}},onOffsetComplete:function(){},distance:function(a,d,e){var g=f.mixin({},this._url.query,{f:"json"},a.toJson()),h=a.geometry1.spatialReference,k=this._distanceHandler,l=this._errorHandler,m=new q(b._dfdCanceller);m._pendingDfd=c({url:this._url.path+
"/distance",content:g,callbackParamName:"callback",load:function(a,b){k(a,b,h,d,e,m)},error:function(a){l(a,e,m)}});return m},_distanceHandler:function(a,b,c,d,e,f){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",d,f)}catch(g){this._errorHandler(g,e,f)}},onDistanceComplete:function(){},toGeoCoordinateString:function(a,d,e){var g={};f.isObject(a.sr)?g.sr=a.sr.wkid||r.toJson(a.sr.toJson()):g.sr=a.sr;g.coordinates=r.toJson(a.coordinates);g.conversionType=a.conversionType||"MGRS";g.conversionMode=
a.conversionMode;g.numOfDigits=a.numOfDigits;g.rounding=a.rounding;g.addSpaces=a.addSpaces;a=f.mixin({},this._url.query,{f:"json"},g);var h=this._toGeoCoordinateHandler,k=this._errorHandler,l=new q(b._dfdCanceller);l._pendingDfd=c({url:this._url.path+"/toGeoCoordinateString",content:a,callbackParamName:"callback",load:function(a,b){h(a,b,d,e,l)},error:function(a){k(a,e,l)}});return l},_toGeoCoordinateHandler:function(a,b,c,d,e){try{this._successHandler([a.strings],"onToGeoCoordinateStringComplete",
c,e)}catch(f){this._errorHandler(f,d,e)}},onToGeoCoordinateStringComplete:function(){},fromGeoCoordinateString:function(a,d,e){var g={};f.isObject(a.sr)?g.sr=a.sr.wkid||r.toJson(a.sr.toJson()):g.sr=a.sr;g.strings=r.toJson(a.strings);g.conversionType=a.conversionType||"MGRS";g.conversionMode=a.conversionMode;a=f.mixin({},this._url.query,{f:"json"},g);var h=this._fromGeoCoordinateHandler,k=this._errorHandler,l=new q(b._dfdCanceller);l._pendingDfd=c({url:this._url.path+"/fromGeoCoordinateString",content:a,
callbackParamName:"callback",load:function(a,b){h(a,b,d,e,l)},error:function(a){k(a,e,l)}});return l},_fromGeoCoordinateHandler:function(a,b,c,d,e){try{this._successHandler([a.coordinates],"onToGeoCoordinateStringComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onFromGeoCoordinateStringComplete:function(){}});f.mixin(p,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});g("extend-esri")&&f.setObject("tasks.GeometryService",p,e);return p})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),
function(p,f,l,r,q,g,e,c,b,d,u,w,m,h,k,a){function n(a){return eval("("+a+")")}function s(a){var b=a._nameCaseMap,c=a.prototype;if(!b||b._extendCnt<t){var b=a._nameCaseMap={},d;for(d in c)"_"!==d.charAt(0)&&(b[d.toLowerCase()]=d);b._extendCnt=t}return b}function v(a,b){var c=a.join();if(!y[c]){for(var d=[],e=0,f=a.length;e<f;e++){var g=a[e];d[d.length]=y[g]=y[g]||l.getObject(g)||~g.indexOf("/")&&(b?b(g):p(g))}e=d.shift();y[c]=d.length?e.createSubclass?e.createSubclass(d):e.extend.apply(e,d):e}return y[c]}
new Date("X");var t=0;b.after(l,"extend",function(){t++},!0);var y={},x={_clearCache:function(){t++;y={}},_functionFromScript:function(a,b){var c="",d="",e=a.getAttribute(b+"args")||a.getAttribute("args"),f=a.getAttribute("with"),e=(e||"").split(/\s*,\s*/);f&&f.length&&r.forEach(f.split(/\s*,\s*/),function(a){c+="with("+a+"){";d+="}"});return new Function(e,c+a.innerHTML+d)},instantiate:function(a,b,c){b=b||{};c=c||{};var d=(c.scope||f._scopeName)+"Type",e="data-"+(c.scope||f._scopeName)+"-",g=e+
"type",h=e+"mixins",k=[];r.forEach(a,function(a){var c=d in b?b[d]:a.getAttribute(g)||a.getAttribute(d);if(c){var e=a.getAttribute(h),c=e?[c].concat(e.split(/\s*,\s*/)):[c];k.push({node:a,types:c})}});return this._instantiate(k,b,c)},_instantiate:function(a,b,c,e){function f(a){!b._started&&!c.noStart&&r.forEach(a,function(a){"function"===typeof a.startup&&!a._started&&a.startup()});return a}a=r.map(a,function(a){var d=a.ctor||v(a.types,c.contextRequire);if(!d)throw Error("Unable to resolve constructor for: '"+
a.types.join()+"'");return this.construct(d,a.node,b,c,a.scripts,a.inherited)},this);return e?d(a).then(f):f(a)},construct:function(a,d,e,g,p,q){function x(a){Q&&l.setObject(Q,a);for(G=0;G<M.length;G++)b[M[G].advice||"after"](a,M[G].method,l.hitch(a,M[G].func),!0);for(G=0;G<J.length;G++)J[G].call(a);for(G=0;G<P.length;G++)a.watch(P[G].prop,P[G].func);for(G=0;G<T.length;G++)k(a,T[G].event,T[G].func);return a}var y=a&&a.prototype;g=g||{};var v={};g.defaults&&l.mixin(v,g.defaults);q&&l.mixin(v,q);var t;
m("dom-attributes-explicit")?t=d.attributes:m("dom-attributes-specified-flag")?t=r.filter(d.attributes,function(a){return a.specified}):(q=(/^input$|^img$/i.test(d.nodeName)?d:d.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),t=r.map(q.split(/\s+/),function(a){var b=a.toLowerCase();return{name:a,value:"LI"==d.nodeName&&"value"==a||"enctype"==b?d.getAttribute(b):d.getAttributeNode(b).value}}));var w=g.scope||f._scopeName;
q="data-"+w+"-";var D={};"dojo"!==w&&(D[q+"props"]="data-dojo-props",D[q+"type"]="data-dojo-type",D[q+"mixins"]="data-dojo-mixins",D[w+"type"]="dojoType",D[q+"id"]="data-dojo-id");for(var G=0,E,w=[],Q,N;E=t[G++];){var F=E.name,L=F.toLowerCase();E=E.value;switch(D[L]||L){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":N=E;break;case "data-dojo-id":case "jsid":Q=E;break;case "data-dojo-attach-point":case "dojoattachpoint":v.dojoAttachPoint=E;break;case "data-dojo-attach-event":case "dojoattachevent":v.dojoAttachEvent=
E;break;case "class":v["class"]=d.className;break;case "style":v.style=d.style&&d.style.cssText;break;default:if(F in y||(F=s(a)[L]||F),F in y)switch(typeof y[F]){case "string":v[F]=E;break;case "number":v[F]=E.length?Number(E):NaN;break;case "boolean":v[F]="false"!=E.toLowerCase();break;case "function":""===E||-1!=E.search(/[^\w\.]+/i)?v[F]=new Function(E):v[F]=l.getObject(E,!1)||new Function(E);w.push(F);break;default:L=y[F],v[F]=L&&"length"in L?E?E.split(/\s*,\s*/):[]:L instanceof Date?""==E?new Date(""):
"now"==E?new Date:u.fromISOString(E):L instanceof c?f.baseUrl+E:n(E)}else v[F]=E}}for(t=0;t<w.length;t++)D=w[t].toLowerCase(),d.removeAttribute(D),d[D]=null;if(N)try{N=n.call(g.propsThis,"{"+N+"}"),l.mixin(v,N)}catch(X){throw Error(X.toString()+" in data-dojo-props\x3d'"+N+"'");}l.mixin(v,e);p||(p=a&&(a._noScript||y._noScript)?[]:h("\x3e script[type^\x3d'dojo/']",d));var M=[],J=[],P=[],T=[];if(p)for(G=0;G<p.length;G++)D=p[G],d.removeChild(D),e=D.getAttribute(q+"event")||D.getAttribute("event"),g=
D.getAttribute(q+"prop"),N=D.getAttribute(q+"method"),w=D.getAttribute(q+"advice"),t=D.getAttribute("type"),D=this._functionFromScript(D,q),e?"dojo/connect"==t?M.push({method:e,func:D}):"dojo/on"==t?T.push({event:e,func:D}):v[e]=D:"dojo/aspect"==t?M.push({method:N,advice:w,func:D}):"dojo/watch"==t?P.push({prop:g,func:D}):J.push(D);a=(p=a.markupFactory||y.markupFactory)?p(v,d,a):new a(v,d);return a.then?a.then(x):x(a)},scan:function(a,b){function c(a){if(!a.inherited){a.inherited={};var b=a.node,d=
c(a.parent),b={dir:b.getAttribute("dir")||d.dir,lang:b.getAttribute("lang")||d.lang,textDir:b.getAttribute(n)||d.textDir},e;for(e in b)b[e]&&(a.inherited[e]=b[e])}return a.inherited}var d=[],e=[],g={},h=(b.scope||f._scopeName)+"Type",k="data-"+(b.scope||f._scopeName)+"-",l=k+"type",n=k+"textdir",k=k+"mixins",q=a.firstChild,s=b.inherited;if(!s){var x=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&x(a.parentNode,b)},s={dir:x(a,"dir"),lang:x(a,"lang"),textDir:x(a,n)},y;for(y in s)s[y]||
delete s[y]}for(var s={inherited:s},t,u;;)if(q)if(1!=q.nodeType)q=q.nextSibling;else if(t&&"script"==q.nodeName.toLowerCase())(F=q.getAttribute("type"))&&/^dojo\/\w/i.test(F)&&t.push(q),q=q.nextSibling;else if(u)q=q.nextSibling;else{var F=q.getAttribute(l)||q.getAttribute(h);y=q.firstChild;if(!F&&(!y||3==y.nodeType&&!y.nextSibling))q=q.nextSibling;else{u=null;if(F){var L=q.getAttribute(k);t=L?[F].concat(L.split(/\s*,\s*/)):[F];try{u=v(t,b.contextRequire)}catch(X){}u||r.forEach(t,function(a){~a.indexOf("/")&&
!g[a]&&(g[a]=!0,e[e.length]=a)});L=u&&!u.prototype._noScript?[]:null;s={types:t,ctor:u,parent:s,node:q,scripts:L};s.inherited=c(s);d.push(s)}else s={node:q,scripts:t,parent:s};t=L;u=q.stopParser||u&&u.prototype.stopParser&&!b.template;q=y}}else{if(!s||!s.node)break;q=s.node.nextSibling;u=!1;s=s.parent;t=s.scripts}var M=new w;e.length?(m("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+e.join(", ")),(b.contextRequire||p)(e,function(){M.resolve(r.filter(d,function(a){if(!a.ctor)try{a.ctor=
v(a.types,b.contextRequire)}catch(c){}for(var d=a.parent;d&&!d.types;)d=d.parent;var e=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(e&&e.stopParser&&!b.template);a.instantiate=!d||d.instantiate&&d.instantiateChildren;return a.instantiate}))})):M.resolve(d);return M.promise},_require:function(a,b){var c=n("{"+a.innerHTML+"}"),d=[],e=[],f=new w,g=b&&b.contextRequire||p,h;for(h in c)d.push(h),e.push(c[h]);g(e,function(){for(var a=0;a<d.length;a++)l.setObject(d[a],arguments[a]);f.resolve(arguments)});
return f.promise},_scanAmd:function(a,b){var c=new w,d=c.promise;c.resolve(!0);var e=this;h("script[type\x3d'dojo/require']",a).forEach(function(a){d=d.then(function(){return e._require(a,b)});a.parentNode.removeChild(a)});return d},parse:function(a,b){var c;!b&&a&&a.rootNode?(b=a,c=b.rootNode):a&&l.isObject(a)&&!("nodeType"in a)?b=a:c=a;c=c?g.byId(c):e.body();b=b||{};var d=b.template?{template:!0}:{},f=[],h=this,k=this._scanAmd(c,b).then(function(){return h.scan(c,b)}).then(function(a){return h._instantiate(a,
d,b,!0)}).then(function(a){return f=f.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});l.mixin(f,k);return f}};f.parser=x;q.parseOnLoad&&a(100,x,"parse");return x})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(p,f,l,r,q,g,e,c,b,d,u,w,m){function h(){}
function k(a){return function(b,c,d,f){return b&&"string"==typeof c&&b[c]==h?b.on(c.substring(2).toLowerCase(),e.hitch(d,f)):a.apply(l,arguments)}}p.around(l,"connect",k);g.connect&&p.around(g,"connect",k);p=r("dijit._Widget",[u,w,m],{onClick:h,onDblClick:h,onKeyDown:h,onKeyPress:h,onKeyUp:h,onMouseDown:h,onMouseMove:h,onMouseOut:h,onMouseOver:h,onMouseLeave:h,onMouseEnter:h,onMouseUp:h,constructor:function(a){this._toConnect={};for(var b in a)this[b]===h&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=
a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===h?l.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){g.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(a,b)},attr:function(a,
b){if(f.isDebug){var c=arguments.callee._ach||(arguments.callee._ach={}),d=(arguments.callee.caller||"unknown caller").toString();c[d]||(g.deprecated(this.declaredClass+"::attr() is deprecated. Use get() or set() instead, called from "+d,"","2.0"),c[d]=!0)}return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){g.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?
c("[widgetId]",this.containerNode).map(d.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});q("dijit-legacy-requires")&&b(0,function(){require(["dijit/_base"])});return p})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-class dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(p,f,l,r,q,g,e,c,b,d,u,w,m,h,k,a,n){var s,v=new (f([w,e],{curNode:null,activeStack:[],constructor:function(){var a=c.hitch(this,function(a){l.isDescendant(this.curNode,a)&&this.set("curNode",null);l.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});p.before(q,"empty",a);p.before(q,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,c){var d=this,e=a.document&&a.document.body;if(e){var f=b(a.document,"mousedown, touchstart",function(a){d._justMouseDowned=
!0;setTimeout(function(){d._justMouseDowned=!1},0);if(!a||!(a.target&&null==a.target.parentNode))d._onTouchNode(c||a.target,"mouse")}),g=b(e,"focusin",function(a){s=(new Date).getTime();if(a.target.tagName){var b=a.target.tagName.toLowerCase();"#document"==b||"body"==b||(k.isTabNavigable(a.target)?d._onFocusNode(c||a.target):d._onTouchNode(c||a.target))}}),h=b(e,"focusout",function(a){(new Date).getTime()<s+100||d._onBlurNode(c||a.target)});return{remove:function(){f.remove();g.remove();h.remove();
e=f=g=h=null}}}},_onBlurNode:function(a){this._clearFocusTimer&&clearTimeout(this._clearFocusTimer);this._clearFocusTimer=setTimeout(c.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0);this._justMouseDowned||(this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),this._clearActiveWidgetsTimer=setTimeout(c.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0))},_onTouchNode:function(b,c){this._clearActiveWidgetsTimer&&
(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);var d=[];try{b&&(g.contains(b,"dijitMenuPopup")&&!b.getAttribute("dijitPopupParent"))&&(b=b.firstChild);for(;b;){var e=r.get(b,"dijitPopupParent");if(e)b=a.byId(e).domNode;else if(b.tagName&&"body"==b.tagName.toLowerCase()){if(b===m.body())break;b=h.get(b.ownerDocument).frameElement}else{var f=b.getAttribute&&b.getAttribute("widgetId"),k=f&&a.byId(f);k&&!("mouse"==c&&k.get("disabled"))&&d.unshift(f);b=b.parentNode}}}catch(l){}this._setStack(d,
c)},_onFocusNode:function(a){a&&9!=a.nodeType&&(this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(b,c){var d=this.activeStack,e=d.length-1,f=b.length-1;if(b[f]!=d[e]){this.set("activeStack",b);var g;for(g=e;0<=g&&d[g]!=b[g];g--)if(e=a.byId(d[g]))e._hasBeenBlurred=!0,e.set("focused",!1),e._focusManager==this&&e._onBlur(c),this.emit("widget-blur",
e,c);for(g++;g<=f;g++)if(e=a.byId(b[g]))e.set("focused",!0),e._focusManager==this&&e._onFocus(c),this.emit("widget-focus",e,c)}},focus:function(a){if(a)try{a.focus()}catch(b){}}}));d(function(){var a=v.registerWin(h.get(document));u("ie")&&b(window,"unload",function(){a&&(a.remove(),a=null)})});n.focus=function(a){v.focus(a)};for(var t in v)/^_/.test(t)||(n.focus[t]="function"==typeof v[t]?c.hitch(v,t):v[t]);v.watch(function(a,b,c){n.focus[a]=c});return v})},"dijit/_FocusMixin":function(){define(["./focus",
"./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(p,f,l,r){r.extend(f,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return l("dijit._FocusMixin",null,{_focusManager:p})})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(p,f,l,r,q,g,e){var c=p(null,{declaredClass:"esri.layers.MosaicRule",method:null,
where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,constructor:function(b){f.isObject(b)&&(f.mixin(this,b),b.mosaicMethod&&(this.method=b.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),b.mosaicOperation&&(this.operation=b.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),
b.fids&&(this.objectIds=b.fids),b.viewpoint&&(this.viewpoint=new e(b.viewpoint)))},toJson:function(){var b={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation};return g.filter(b,function(b){if(null!==b)return!0})},_getMethodEnum:function(b){if(b){var d=c.METHOD_NONE;switch(b.toLowerCase()){case "byattribute":d=
c.METHOD_ATTRIBUTE;break;case "center":d=c.METHOD_CENTER;break;case "lockraster":d=c.METHOD_LOCKRASTER;break;case "nadir":d=c.METHOD_NADIR;break;case "northwest":d=c.METHOD_NORTHWEST;break;case "seamline":d=c.METHOD_SEAMLINE;break;case "viewpoint":d=c.METHOD_VIEWPOINT}return d}},_getOperatorEnum:function(b){if(b)switch(b.toLowerCase()){case "first":return c.OPERATION_FIRST;case "last":return c.OPERATION_LAST;case "max":return c.OPERATION_MAX;case "min":return c.OPERATION_MIN;case "blend":return c.OPERATION_BLEND;
case "mean":return c.OPERATION_MEAN}}});f.mixin(c,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND"});r("extend-esri")&&
f.setObject("layers.MosaicRule",c,q);return c})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),function(p,f,l,r,q,g,e,c,b,d,u,w,m){p=p(w,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},
constructor:function(b,c){this._handler=f.hitch(this,this._handler);this._relationshipQueryHandler=f.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=f.hitch(this,this._executeForIdsHandler);this._countHandler=f.hitch(this,this._countHandler);this._extentHandler=f.hitch(this,this._extentHandler);this.source=c&&c.source;this.gdbVersion=c&&c.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],
e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},onExecuteForExtentComplete:function(){},execute:function(b,d,a,e,g){var l=g.assembly;b=this._encode(f.mixin({},this._url.query,{f:"json"},b.toJson(l&&l[0])));var m=this._handler,p=this._errorHandler;this.source&&(l={source:this.source.toJson()},
b.layer=q.toJson(l));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return c({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,c){m(b,c,d,a,g.dfd)},error:function(b){p(b,a,g.dfd)},callbackSuffix:e},this.requestOptions)},executeRelationshipQuery:function(d,e,a){d=this._encode(f.mixin({},this._url.query,{f:"json"},d.toJson()));var g=this._relationshipQueryHandler,l=this._errorHandler;this.gdbVersion&&(d.gdbVersion=this.gdbVersion);var m=new r(b._dfdCanceller);m._pendingDfd=
c({url:this._url.path+"/queryRelatedRecords",content:d,callbackParamName:"callback",load:function(b,c){g(b,c,e,a,m)},error:function(b){l(b,a,m)}},this.requestOptions);return m},executeForIds:function(b,d,a,e){var g=e.assembly;b=this._encode(f.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},b.toJson(g&&g[0])));var l=this._executeForIdsHandler,m=this._errorHandler;this.source&&(g={source:this.source.toJson()},b.layer=q.toJson(g));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return c({url:this._url.path+
"/query",content:b,callbackParamName:"callback",load:function(b,c){l(b,c,d,a,e.dfd)},error:function(b){m(b,a,e.dfd)}},this.requestOptions)},executeForCount:function(b,d,a,e){var g=e.assembly;b=this._encode(f.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},b.toJson(g&&g[0])));var l=this._countHandler,m=this._errorHandler;this.source&&(g={source:this.source.toJson()},b.layer=q.toJson(g));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return c({url:this._url.path+"/query",content:b,
callbackParamName:"callback",load:function(b,c){l(b,c,d,a,e.dfd)},error:function(b){m(b,a,e.dfd)}},this.requestOptions)},executeForExtent:function(b,d,a,e){var g=e.assembly;b=this._encode(f.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},b.toJson(g&&g[0])));var l=this._extentHandler,m=this._errorHandler;this.source&&(g={source:this.source.toJson()},b.layer=q.toJson(g));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return c({url:this._url.path+"/query",content:b,callbackParamName:"callback",
load:function(b,c){l(b,c,d,a,e.dfd)},error:function(b){m(b,a,e.dfd)}},this.requestOptions)},_handler:function(b,c,a,d,e){try{var f=new m(b);this._successHandler([f],"onComplete",a,e)}catch(g){this._errorHandler(g,d,e)}},_relationshipQueryHandler:function(b,c,a,d,e){try{var f=b.geometryType,g=b.spatialReference,q={};l.forEach(b.relatedRecordGroups,function(a){var b={};b.geometryType=f;b.spatialReference=g;b.features=a.relatedRecords;b=new m(b);if(null!=a.objectId)q[a.objectId]=b;else for(var c in a)a.hasOwnProperty(c)&&
"relatedRecords"!==c&&(q[a[c]]=b)});this._successHandler([q],"onExecuteRelationshipQueryComplete",a,e)}catch(p){this._errorHandler(p,d,e)}},_executeForIdsHandler:function(b,c,a,d,e){try{this._successHandler([b.objectIds],"onExecuteForIdsComplete",a,e)}catch(f){this._errorHandler(f,d,e)}},_countHandler:function(b,c,a,d,e){try{var f,g=b.features,l=b.objectIds;if(l)f=l.length;else{if(g)throw Error("Unable to perform query. Please check your parameters.");f=b.count}this._successHandler([f],"onExecuteForCountComplete",
a,e)}catch(m){this._errorHandler(m,d,e)}},_extentHandler:function(b,c,a,e,f){try{b.extent&&(b.extent=new d(b.extent)),this._successHandler([b],"onExecuteForExtentComplete",a,f)}catch(g){this._errorHandler(g,e,f)}}});u._createWrappers(p);g("extend-esri")&&f.setObject("tasks.QueryTask",p,e);return p})},"esri/layers/ArcGISImageServiceLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/has dojo/io-query ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../SpatialReference ./MosaicRule ./DynamicMapServiceLayer ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters ../geometry/Polygon".split(" "),
function(p,f,l,r,q,g,e,c,b,d,u,w,m,h,k,a,n,s,v,t,y,x,A,z,B){p=p(v,{declaredClass:"esri.layers.ArcGISImageServiceLayer",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0},constructor:function(a,b){this._url=h.urlToObject(a);var c=b&&b.imageServiceParameters;this.format=c&&c.format;this.interpolation=c?c.interpolation:null;this.compressionQuality=c?c.compressionQuality:null;this.bandIds=c?c.bandIds:null;this.mosaicRule=c?c.mosaicRule:null;this.renderingRule=c?c.renderingRule:null;this._params=
f.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},c?c.toJson():{});this._initLayer=f.hitch(this,this._initLayer);this._queryVisibleRastersHandler=f.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this.useMapImage=b&&b.useMapImage||!1;this.infoTemplate=b&&b.infoTemplate;this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._loadCallback=
b&&b.loadCallback;(c=b&&b.resourceInfo)?this._initLayer(c):w({url:this._url.path,content:f.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,b){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var c=this.minScale,d=this.maxScale;f.mixin(this,a);this.minScale=c;this.maxScale=d;this.initialExtent=this.fullExtent=this.extent=
new k(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var e=this.minValues,g=this.maxValues,h=this.meanValues,l=this.stdvValues,m=this.bands=[],c=0,d=this.bandCount;c<d;c++)m[c]={min:e[c],max:g[c],mean:h[c],stddev:l[c]};this.timeInfo=(c=this.timeInfo)&&c.timeExtent?new t(c):null;d=this.fields=[];if(e=a.fields)for(c=0;c<e.length;c++)d.push(new y(e[c]));this.version=a.currentVersion;this.version||
(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);u.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);u.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);c={};a.defaultMosaicMethod?(c.method=a.defaultMosaicMethod,c.operation=a.mosaicOperator,c.sortField=a.sortField,c.sortValue=a.sortValue):c.method=s.METHOD_NONE;this.defaultMosaicRule=new s(c);this.defaultMosaicRule.ascending=!0;10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(f.hitch(this,
function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=f.clone(a.features));a&&(a.fields&&0<a.fields.length)&&(this._rasterAttributeTableFields=f.clone(a.fields))}));this.loaded=!0;this.onLoad(this);if(c=this._loadCallback)delete this._loadCallback,c(this)},getKeyProperties:function(){var a=this._url.path+"/keyProperties",b=new l(m._dfdCanceller);10<this.version?(b._pendingDfd=w({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},
function(a){b.errback(a)})):(a=Error("Layer does not have key properties"),a.log=g.isDebug,b.errback(a));return b},getRasterAttributeTable:function(){var a=this._url.path+"/rasterAttributeTable",b=new l(m._dfdCanceller);10<this.version&&this.hasRasterAttributeTable?(b._pendingDfd=w({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},function(a){b.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=g.isDebug,
b.errback(a));return b},_getRasterAttributeTableFeatures:function(){var a=new l;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(f.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=f.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},getCustomRasterFields:function(a){var b=
a?a.rasterAttributeTableFieldPrefix:"",c={name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};a=this.fields?f.clone(this.fields):[];var d=a.length;a[d]={name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a[d+1]=c;this._rasterAttributeTableFields&&0<this._rasterAttributeTableFields.length&&
(c=r.filter(this._rasterAttributeTableFields,function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),c=r.map(c,function(a){var c=f.clone(a);c.name=b+a.name;return c}),a=a.concat(c));return a},getImageUrl:function(a,b,e,g){var k=a.spatialReference.wkid||q.toJson(a.spatialReference.toJson());delete this._params._ts;var l=this._url.path+"/exportImage?";f.mixin(this._params,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:k,bboxSR:k,size:b+","+e},this.disableClientCaching?
{_ts:(new Date).getTime()}:{});var m=this._params.token=this._getToken();a=h.addProxy(l+c.objectToQuery(f.mixin(this._params,{f:"image"})));a.length>d.defaults.io.postLength||this.useMapImage?this._jsonRequest=w({url:l,content:f.mixin(this._params,{f:"json"}),callbackParamName:"callback",load:function(a,b){var c=a.href;m&&(c+=-1===c.indexOf("?")?"?token\x3d"+m:"\x26token\x3d"+m);g(h.addProxy(c))},error:this._errorHandler}):g(a)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,
b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=
a},setMosaicRule:function(a,b){var c=!1;this.mosaicRule!==a&&(c=!0);this.mosaicRule=a;this._params.mosaicRule=q.toJson(a.toJson());if(c&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},setRenderingRule:function(a,b){var c=!1;this.renderingRule!==a&&(c=!0);this.renderingRule=a;this._params.renderingRule=a?q.toJson(a.toJson()):null;if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=a;b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=
a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=s.METHOD_NONE);c.where=a;c=new s(c);this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},refresh:function(a){if(a)this.inherited(arguments);else{var b=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=
b}},exportMapImage:function(a,b){var c=d.defaults.map,c=f.mixin({size:c.width+","+c.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete c._ts;this._exportMapImage(this._url.path+"/exportImage",c,b)},queryVisibleRasters:function(b,c,d,e){var f=this._map,g=m._fixDfd(new l(m._dfdCanceller));this._visibleRasters=[];var k,h,q=!0,n;if(this.infoTemplate&&this.infoTemplate.info.fieldInfos&&0<this.infoTemplate.info.fieldInfos.length){q=!1;n=this.infoTemplate.info;for(k=0;k<n.fieldInfos.length;k++)if((h=
n.fieldInfos[k])&&"raster.servicepixelvalue"!==h.fieldName.toLowerCase()&&(h.visible||n.title&&-1<n.title.toLowerCase().indexOf(h.fieldName.toLowerCase()))){q=!0;break}}k=new z;k.geometry=b.geometry;k.returnGeometry=this._map.spatialReference.equals(this.spatialReference);k.returnCatalogItems=q;k.timeExtent=b.timeExtent;k.mosaicRule=this.mosaicRule?this.mosaicRule:null;k.renderingRule=this.renderingRule?this.renderingRule:null;f&&(b=new a((f.extent.xmax-f.extent.xmin)/(2*f.width),(f.extent.ymax-f.extent.ymin)/
(2*f.height),f.extent.spatialReference),k.pixelSize=b);var p=this;b=new A(this.url);(g._pendingDfd=b.execute(k)).addCallbacks(function(a){p._queryVisibleRastersHandler(a,c,d,e,g)},function(a){p._resolve([a],null,e,g,!0)});return g},_queryVisibleRastersHandler:function(a,b,c,d,e){function g(){var a=this.getCustomRasterFields(b),d=this._getDomainFields(a),k=b?b.returnDomainValues:!1,q=b&&b.rasterAttributeTableFieldPrefix,n,p,s,x,t,z,v,w;this._getRasterAttributeTableFeatures().then(f.hitch(this,function(a){for(n=
0;n<m.length;n++){J=m[n];J.setInfoTemplate(this.infoTemplate);J._layer=this;if(h&&(p=h,l&&l.length>=n&&(s=l[n],p=s.replace(/ /gi,", ")),J.attributes["Raster.ItemPixelValue"]=p,J.attributes["Raster.ServicePixelValue"]=h,a&&0<a.length&&(x=r.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==p:a.attributes.VALUE==p}),0<x.length&&(t=f.clone(x[0]),q&&t)))){w={};for(z in t.attributes)t.attributes.hasOwnProperty(z)&&(v=q+z,w[v]=t.attributes[z]);t.attributes=
w;J.attributes=f.mixin(J.attributes,t.attributes)}k&&(d&&0<d.length)&&r.forEach(d,function(a){if(a){var b=J.attributes[a.name];u.isDefined(b)&&(b=this._getDomainValue(a.domain,b),u.isDefined(b)&&(J.attributes[a.name]=b))}},this);P.push(J);this._visibleRasters.push(J)}this._resolve([P,null,!0],null,c,e)}))}var h=a.value,l,m,n=0,p=0,s=this,t=this.objectIdField,z;if(a.catalogItems){d=0;var v,y,A=a.catalogItems.features.length;v=0;m=Array(A);l=Array(A);z=Array(A);for(n=0;n<A;n++)-1<a.properties.Values[n].toLowerCase().indexOf("nodata")&&
v++;v=A-v;for(n=0;n<A;n++)y=-1<a.properties.Values[n].toLowerCase().indexOf("nodata")?v++:d++,m[y]=a.catalogItems.features[n],l[y]=a.properties.Values[n],z[y]=m[y].attributes[t]}this._visibleRasters=[];var J;a=-1<h.toLowerCase().indexOf("nodata");h&&(!m&&!a)&&(t="ObjectId",m=[],J=new x(new k(this.fullExtent),null,{ObjectId:0}),m.push(J));var P=[];m?!this._map.spatialReference.equals(this.spatialReference)&&z&&0<z.length?w({url:this._url.path+"/query",content:{f:"json",objectIds:z.join(","),returnGeometry:!0,
outSR:q.toJson(s._map.spatialReference.toJson()),outFields:t},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)s._resolve([P,null,null],null,c,e);else{for(n=0;n<a.features.length;n++)for(p=0;p<m.length;p++)m[p].attributes[t]==a.features[n].attributes[t]&&(m[p].geometry=new B(a.features[n].geometry),m[p].geometry.setSpatialReference(s._map.spatialReference));g.call(s)}},error:function(a){s._resolve([P,null,null],null,c,e)}}):g.call(this):this._resolve([P,null,
null],null,c,e)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},_getDomainFields:function(a){if(a){var b=[];r.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;r.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&m._resDfd(d,
a,e)}});e("extend-esri")&&f.setObject("layers.ArcGISImageServiceLayer",p,b);return p})},"esri/arcgis/csv":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/sniff dojo/number dojox/data/CsvStore ../kernel ../config ../request ../SpatialReference ../geometry/Geometry ../geometry/jsonUtils ../geometry/webMercatorUtils".split(" "),function(p,f,l,r,q,g,e,c,b,d,u,w,m){function h(a){var b=0,c="";f.forEach([","," ",";","|","\t"],function(d){var e=a.split(d).length;e>b&&(b=e,c=d)});
return c}function k(a,b){if(!a||"[object Date]"!==Object.prototype.toString.call(a)||isNaN(a.getTime()))return!1;var c=!0;if(r("chrome")&&/\d+\W*$/.test(b)){var d=b.match(/[a-zA-Z]{2,}/);if(d){for(var c=!1,e=0,f=d.length,g=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i;!c&&e<=f&&!(c=!g.test(d[e]));)e++;c=!c}}return c}function a(a,b,c){var d=a.indexOf("\n"),d=p.trim(a.substr(0,
d)),e=b.columnDelimiter;e||(e=h(d));var l=new g({data:a,separator:e});l.fetch({onComplete:function(a,d){var e=0,g={layerDefinition:b.layerDefinition,featureSet:{features:[],geometryType:"esriGeometryPoint"}},h=g.layerDefinition.objectIdField;!h&&!f.some(g.layerDefinition.fields,function(a){return"esriFieldTypeOID"==a.type?(h=a.name,!0):!1})&&(g.layerDefinition.fields.push({name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,domain:null}),h="__OBJECTID");var m,n,p=l._attributes,
r=[],s=[];f.forEach(g.layerDefinition.fields,function(a,b){"esriFieldTypeDate"===a.type?r.push(a.name):("esriFieldTypeDouble"===a.type||"esriFieldTypeInteger"===a.type)&&s.push(a.name)});b.locationInfo&&"coordinates"===b.locationInfo.locationType?(m=b.locationInfo.latitudeFieldName,n=b.locationInfo.longitudeFieldName):f.forEach(p,function(a){var b;b=f.indexOf(t,a.toLowerCase());-1!==b&&(m=a);b=f.indexOf(y,a.toLowerCase());-1!==b&&(n=a)},this);if(!m||!n)setTimeout(function(){console.error("File does not seem to contain fields with point coordinates.")},
1),c&&c(null,Error("File does not seem to contain fields with point coordinates."));else{-1===f.indexOf(s,m)&&s.push(m);-1===f.indexOf(s,n)&&s.push(n);var p=0,x=a.length;for(p;p<x;p++){var u=a[p],v=l.getAttributes(u),w={};f.forEach(v,function(a,b){if(a){var c=a;0===a.length&&f.forEach(g.layerDefinition.fields,function(b,c){b.name==="attribute_"+(c-1)&&(a="attribute_"+(c-1))});if(-1<f.indexOf(r,a)){var c=l.getValue(u,c),d=new Date(c);w[a]=k(d,c)?d.getTime():null}else if(-1<f.indexOf(s,a)){d=q.parse(l.getValue(u,
c));if((a==m||a==n)&&(isNaN(d)||181<Math.abs(d)))d=parseFloat(l.getValue(u,c));isNaN(d)?w[a]=null:w[a]=d}else w[a]=l.getValue(u,c)}});w[h]=e;e++;var v=w[m],B=w[n];null==B||(null==v||isNaN(v)||isNaN(B))||g.featureSet.features.push({geometry:{x:B,y:v,spatialReference:{wkid:4326}},attributes:w})}g.layerDefinition.name="csv";c&&c(g)}},onError:function(a){console.error("Error fetching items from CSV store: ",a);c&&c(null,a)}});return!0}function n(a,b,d,e,g,k){0===a.length&&g(null);var h=w.getGeometryType(b),
l=[];f.forEach(a,function(a){a=new h(a);a.spatialReference=d;l.push(a)},this);b=[102113,102100,3857];d.wkid&&4326===d.wkid&&e.wkid&&-1<f.indexOf(b,e.wkid)?(f.forEach(l,function(a){a.xmin?(a.xmin=Math.max(a.xmin,-180),a.xmax=Math.min(a.xmax,180),a.ymin=Math.max(a.ymin,-89.99),a.ymax=Math.min(a.ymax,89.99)):a.rings?f.forEach(a.rings,function(a){f.forEach(a,function(a){a[0]=Math.min(Math.max(a[0],-180),180);a[1]=Math.min(Math.max(a[1],-89.99),89.99)},this)},this):a.paths?f.forEach(a.paths,function(a){f.forEach(a,
function(a){a[0]=Math.min(Math.max(a[0],-180),180);a[1]=Math.min(Math.max(a[1],-89.99),89.99)},this)},this):a.x&&(a.x=Math.min(Math.max(a.x,-180),180),a.y=Math.min(Math.max(a.y,-89.99),89.99))},this),a=[],f.forEach(l,function(b){b=m.geographicToWebMercator(b);102100!==e.wkid&&(b.spatialReference=e);a.push(b.toJson())},this),g(a)):null!==d.wkid&&-1<f.indexOf(b,d.wkid)&&null!==e.wkid&&4326===e.wkid?(a=[],f.forEach(l,function(b){a.push(m.webMercatorToGeographic(b).toJson())},this),g(a)):(b=function(b,
c){b&&b.length===a.length?(a=[],f.forEach(b,function(b){b&&(b.rings&&0<b.rings.length&&0<b.rings[0].length&&0<b.rings[0][0].length&&!isNaN(b.rings[0][0][0])&&!isNaN(b.rings[0][0][1])||b.paths&&0<b.paths.length&&0<b.paths[0].length&&0<b.paths[0][0].length&&!isNaN(b.paths[0][0][0])&&!isNaN(b.paths[0][0][1])||b.xmin&&!isNaN(b.xmin)&&b.ymin&&!isNaN(b.ymin)||b.x&&!isNaN(b.x)&&b.y&&!isNaN(b.y))?a.push(b.toJson()):a.push(null)},this),g(a)):k(b,c)},c.defaults.geometryService?c.defaults.geometryService.project(l,
e,p.hitch(this,b),k):g(null))}function s(a,b){var c=[102113,102100,3857];return a&&b&&a.wkid===b.wkid&&a.wkt===b.wkt||a&&b&&a.wkid&&b.wkid&&-1<f.indexOf(c,a.wkid)&&-1<f.indexOf(c,b.wkid)?!0:!1}function v(a,b,c,e){if(a.featureSet&&0!==a.featureSet.features.length)if(s(c,b))e(a);else{var g=function(b){var c=[];f.forEach(a.featureSet.features,function(a,d){b[d]&&(a.geometry=b[d],c.push(a))},this);e(a)},k=function(b,c){console.error("error projecting featureSet ("+a.layerDefinition.name+"). Final try.");
e(a)},h=function(d,e){console.error("error projecting featureSet ("+a.layerDefinition.name+"). Try one more time.");n(l,a.featureSet.geometryType,b,c,p.hitch(this,g),p.hitch(this,k))};if(a.featureSet.features&&0<a.featureSet.features.length){var l=[];f.forEach(a.featureSet.features,function(b){if(b.geometry.toJson)l.push(b.geometry);else{var c=w.getGeometryType(a.featureSet.geometryType);l.push(new c(b.geometry))}});b.toJson||(b=new d(b));c.toJson||(c=new d(c));n(l,a.featureSet.geometryType,b,c,p.hitch(this,
g),p.hitch(this,h))}else e(a)}}var t="lat latitude y ycenter latitude83 latdecdeg POINT-Y".split(" "),y="lon lng long longitude x xcenter longitude83 longdecdeg POINT-X".split(" ");u={latFieldStrings:t,longFieldStrings:y,buildCSVFeatureCollection:function(c){var d=new l,e=function(a,b){b?d.errback(b):d.callback(a)};b({url:c.url,handleAs:"text",load:function(b){a(b,c,p.hitch(this,e))},error:function(a){d.errback(a);console.error("error: "+a)}},{usePost:!1});return d},projectFeatureCollection:function(a,
b,c){var e=new l;c||(c=new d({wkid:4326}));v(a,c,b,p.hitch(this,function(a){e.callback(a)}));return e},generateDefaultPopupInfo:function(a){var b={esriFieldTypeDouble:1,esriFieldTypeSingle:1},c={esriFieldTypeInteger:1,esriFieldTypeSmallInteger:1},d={esriFieldTypeDate:1},e=null;a=f.map(a.layerDefinition.fields,p.hitch(this,function(a){"NAME"===a.name.toUpperCase()&&(e=a.name);var f="esriFieldTypeOID"!==a.type&&"esriFieldTypeGlobalID"!==a.type&&"esriFieldTypeGeometry"!==a.type,g=null;if(f){var k=a.name.toLowerCase();
if(-1<",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,".indexOf(","+k+",")||-1<k.indexOf("area")||-1<k.indexOf("length")||-1<k.indexOf("shape")||-1<k.indexOf("perimeter")||-1<k.indexOf("objectid")||k.indexOf("_")===k.length-1||k.indexOf("_i")===k.length-2&&1<k.length)f=!1;a.type in c?g={places:0,digitSeparator:!0}:a.type in b?g={places:2,digitSeparator:!0}:a.type in d&&(g={dateFormat:"shortDateShortTime"})}return p.mixin({},{fieldName:a.name,label:a.alias,
isEditable:!0,tooltip:"",visible:f,format:g,stringFieldOption:"textbox"})}));return{title:e?"{"+e+"}":"",fieldInfos:a,description:null,showAttachments:!1,mediaInfos:[]}},_getSeparator:h,_isValidDate:k,_processCsvData:a,_projectGeometries:n,_sameSpatialReference:s,_projectFeatureSet:v};r("extend-esri")&&p.setObject("arcgis.csv",u,e);return u})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(p,f,l){return l("dijit.Destroyable",null,{destroy:function(f){this._destroyed=
!0},own:function(){p.forEach(arguments,function(l){var q="destroyRecursive"in l?"destroyRecursive":"destroy"in l?"destroy":"remove",g=f.before(this,"destroy",function(c){l[q](c)}),e=f.after(l,q,function(){g.remove();e.remove()},!0)},this);return arguments}})})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(p,f,l,r){p=p(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(l){l&&f.isObject(l)&&(this.objectId=
l.objectId,this.success=l.success,l.success||(l=l.error,this.error=Error(),this.error.code=l.code,this.error.message=l.description))}});l("extend-esri")&&f.setObject("layers.FeatureEditResult",p,r);return p})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(p){return p.cache})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),
function(p,f,l,r,q,g,e,c,b,d,u){p=p(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(b){if(b){f.mixin(this,b);var g=this.features,h=b.spatialReference,k=d.getGeometryType(b.geometryType),h=this.spatialReference=new c(h);this.geometryType=b.geometryType;b.fields&&(this.fields=b.fields);l.forEach(g,function(a,b){var c=a.geometry&&a.geometry.spatialReference;g[b]=new e(k&&a.geometry?new k(a.geometry):null,a.symbol&&u.fromJson(a.symbol),a.attributes);g[b].geometry&&!c&&g[b].geometry.setSpatialReference(h)})}else this.features=
[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(c){var e={};this.displayFieldName&&(e.displayFieldName=this.displayFieldName);this.fields&&(e.fields=this.fields);this.spatialReference?e.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(e.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(e.geometryType=d.getJsonType(this.features[0].geometry)),
e.features=b._encodeGraphics(this.features,c));e.exceededTransferLimit=this.exceededTransferLimit;return g.fixJson(e)}});r("extend-esri")&&f.setObject("tasks.FeatureSet",p,q);return p})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(p,f,l,r,q,g){p=p(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(e){e&&f.isObject(e)&&(this.name=e.name,this.description=e.description,this.drawingTool=
e.drawingTool,e=e.prototype,this.prototype=new g(e.geometry,null,e.attributes))},toJson:function(){return q.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,prototype:this.prototype&&this.prototype.toJson()})}});f.mixin(p,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",
TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});l("extend-esri")&&f.setObject("layers.FeatureTemplate",p,r);return p})},"esri/layers/ImageServiceParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../lang".split(" "),
function(p,f,l,r,q,g){p=p(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,noData:null,toJson:function(e){var c=this.bbox||this.extent;e=(c=c&&e&&c._normalize(!0))?c.spatialReference.wkid||l.toJson(c.spatialReference.toJson()):null;var b=this.imageSpatialReference,c={bbox:c?c.xmin+","+c.ymin+","+c.xmax+","+c.ymax:
null,bboxSR:e,size:null!==this.width&&null!==this.height?this.width+","+this.height:null,imageSR:b?b.wkid||l.toJson(b.toJson()):e,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?l.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?l.toJson(this.renderingRule.toJson()):null,noData:this.noData,noDataInterpretation:this.noDataInterpretation};e=this.timeExtent;
c.time=e?e.toJson().join(","):null;return g.filter(c,function(b){if(null!==b&&void 0!==b)return!0})}});f.mixin(p,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});r("extend-esri")&&f.setObject("layers.ImageServiceParameters",p,q);return p})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel"],function(p,f,l,r){p=p(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});l("extend-esri")&&f.setObject("tasks.StatisticDefinition",p,r);return p})},"dojo/data/util/filter":function(){define(["../../_base/lang"],
function(p){var f={};p.setObject("dojo.data.util.filter",f);f.patternToRegExp=function(f,p){for(var q="^",g=null,e=0;e<f.length;e++)switch(g=f.charAt(e),g){case "\\":q+=g;e++;q+=f.charAt(e);break;case "*":q+=".*";break;case "?":q+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":q+="\\";default:q+=g}q+="$";return p?RegExp(q,"mi"):RegExp(q,"m")};return f})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),
function(p,f,l,r,q,g,e,c){p=p([g,e],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(b,c){f.mixin(this,c);this.initialize(b,c)},getTitle:function(b){var c;this.info&&(c=this.titleHasRelatedFields?"":this._getPopupValues(b,!0).title);return c||""},getContent:function(b){return this.info?(new c({template:this,graphic:b,chartTheme:this.chartTheme},r.create("div"))).domNode:""}});l("extend-esri")&&f.setObject("dijit.PopupTemplate",p,q);return p})},
"*noref":1}});
define("esri/arcgis/utils","require dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/on dojo/DeferredList dojo/dom-construct ../kernel ../config ../lang ../request ../SpatialReference ../map ../urlUtils ../geometry/ScreenPoint ../geometry/Extent ../geometry/webMercatorUtils ../symbols/jsonUtils ../renderers/jsonUtils ../dijit/PopupTemplate ../dijit/Popup ../tasks/query ../tasks/GeometryService ./csv ../layers/ArcGISTiledMapServiceLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/ArcGISImageServiceLayer ../layers/CSVLayer ../layers/OpenStreetMapLayer ../layers/WebTiledLayer ../layers/FeatureLayer ../layers/WMSLayer ../layers/KMLLayer ../layers/GeoRSSLayer ../layers/LabelClass ../virtualearth/VETiledLayer ../layers/TileInfo ../layers/DynamicLayerInfo ../layers/LayerDrawingOptions ../layers/ImageParameters ../layers/ImageServiceParameters ../layers/RasterFunction ../layers/MosaicRule ../layers/WMSLayerInfo dojo/i18n!../nls/jsapi".split(" "),function(p,
f,l,r,q,g,e,c,b,d,u,w,m,h,k,a,n,s,v,t,y,x,A,z,B,C,H,I,S,R,Y,ia,aa,D,G,E,Q,N,F,L,X,M,J,P,T,ja,ka,Z){function W(a){return h({url:O.arcgisUrl+"/"+a.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function $(a,b){var c={f:"json"};b&&(c.token=b);return h({url:a,content:c,callbackParamName:"callback"},{disableIdentityLookup:!0})}function K(a){a.itemProperties.layerDefinition&&(a.layerDefinition?(a.layerDefinition.drawingInfo||(a.layerDefinition.drawingInfo=
a.itemProperties.layerDefinition.drawingInfo),m.isDefined(a.layerDefinition.definitionExpression)||(a.layerDefinition.definitionExpression=a.itemProperties.layerDefinition.definitionExpression),m.isDefined(a.layerDefinition.minScale)||(a.layerDefinition.minScale=a.itemProperties.layerDefinition.minScale),m.isDefined(a.layerDefinition.maxScale)||(a.layerDefinition.maxScale=a.itemProperties.layerDefinition.maxScale)):a.layerDefinition=a.itemProperties.layerDefinition);a.itemProperties.popupInfo&&(!a.popupInfo&&
!a.disablePopup)&&(a.popupInfo=a.itemProperties.popupInfo);m.isDefined(a.itemProperties.showLegend)&&!m.isDefined(a.showLegend)&&(a.showLegend=a.itemProperties.showLegend);m.isDefined(a.itemProperties.refreshInterval)&&!m.isDefined(a.refreshInterval)&&(a.refreshInterval=a.itemProperties.refreshInterval)}function ba(a,c){var d=new q,e=a.itemData,f=[],g=[];l.forEach(e.operationalLayers,function(a){if(a.itemId&&!a.type){var b=a.url.toLowerCase();-1<b.indexOf("/featureserver")||-1<b.indexOf("/mapserver/")?
(g.push(a),f.push(W(a))):-1<b.indexOf("/mapserver")&&-1===b.indexOf("/mapserver/")&&(!a.layers||!m.isDefined(a.minScale)&&!m.isDefined(a.maxScale))?(g.push(a),f.push(W(a))):-1<b.indexOf("/imageserver")&&(!m.isDefined(a.minScale)&&!m.isDefined(a.maxScale))&&(g.push(a),f.push(W(a)))}});e.baseMap&&e.baseMap.baseMapLayers&&l.forEach(e.baseMap.baseMapLayers,function(a){a.itemId&&(g.push(a),f.push(W(a)))});if(0<f.length){var k={};(new b(f)).addCallback(function(b){l.forEach(g,function(a,c){var d=b[c][1];
if(d&&!(d instanceof Error)&&(k[a.itemId]=d,!a.type)){var e=a.url.toLowerCase();if((-1<e.indexOf("/featureserver")||-1<e.indexOf("/mapserver/"))&&d.layers)l.forEach(d.layers,function(b){if(e.endsWith("/featureserver/"+b.id)||e.endsWith("/mapserver/"+b.id))a.itemProperties=b,K(a)});else if(-1<e.indexOf("/mapserver"))d.layers&&!a.layers&&(a.layers=d.layers),m.isDefined(d.minScale)&&!m.isDefined(a.minScale)&&(a.minScale=d.minScale),m.isDefined(d.maxScale)&&!m.isDefined(a.maxScale)&&(a.maxScale=d.maxScale),
m.isDefined(d.refreshInterval)&&!m.isDefined(a.refreshInterval)&&(a.refreshInterval=d.refreshInterval);else if(-1<e.indexOf("/imageserver")&&(m.isDefined(d.minScale)&&!m.isDefined(a.minScale)&&(a.minScale=d.minScale),m.isDefined(d.maxScale)&&!m.isDefined(a.maxScale)&&(a.maxScale=d.maxScale),m.isDefined(d.refreshInterval)&&!m.isDefined(a.refreshInterval)&&(a.refreshInterval=d.refreshInterval),d.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=d.popupInfo),d.renderingRule&&!a.renderingRule&&
(a.renderingRule=d.renderingRule,d.renderingRule.functionName&&(a.renderingRule.rasterFunction=d.renderingRule.functionName)),d.bandIds&&!a.bandIds&&(a.bandIds=d.bandIds),d.mosaicRule&&!a.mosaicRule&&(a.mosaicRule=d.mosaicRule),d.format&&!a.format&&(a.format=d.format),m.isDefined(d.compressionQuality)&&!m.isDefined(a.compressionQuality)&&(a.compressionQuality=d.compressionQuality),d.layerDefinition&&d.layerDefinition.definitionExpression&&(!m.isDefined(a.layerDefinition)||!m.isDefined(a.layerDefinition.definitionExpression))))a.layerDefinition=
a.layerDefinition||{},a.layerDefinition.definitionExpression=d.layerDefinition.definitionExpression}});a.relatedItemsData=k;d.callback(a)})}else d.callback(a);return d}function Ma(a,b){var c=new q,d=a.itemData,e=d.baseMap.baseMapLayers[0];if("BingMapsAerial"===e.type||"BingMapsRoad"===e.type||"BingMapsHybrid"===e.type)if(e.portalUrl)delete b.bingMapsKey,u.id.checkSignInStatus(n.urlToObject(O.arcgisUrl).path).then(f.hitch(null,function(a,b,c,d,g){$(e.portalUrl,g.token).then(f.hitch(null,la,a,b,c,d),
f.hitch(null,ca,a,b,c,d))},a,b,d,c),f.hitch(null,function(a,b,c,d,g){$(e.portalUrl).then(f.hitch(null,la,a,b,c,d),f.hitch(null,ca,a,b,c,d))},a,b,d,c));else if(b.bingMapsKey){var g=new F({bingMapsKey:b.bingMapsKey,mapStyle:F.MAP_STYLE_AERIAL});r.connect(g,"onLoad",f.hitch(this,function(){c.callback([a,b])}));r.connect(g,"onError",function(f){delete b.bingMapsKey;a.itemData=da(d);e=a.itemData.baseMap.baseMapLayers[0];e.errors=[];e.errors.push({message:"The owner of the application has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});
c.callback([a,b])})}else a.itemData=da(d),e=a.itemData.baseMap.baseMapLayers[0],e.errors=[],e.errors.push({message:"The owner of the application has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),c.callback([a,b]);else c.callback([a,b]);return c}function la(a,b,c,d,e){e.bingKey?(b.bingMapsKey=e.bingKey,e=new F({bingMapsKey:b.bingMapsKey,mapStyle:F.MAP_STYLE_AERIAL}),r.connect(e,"onLoad",f.hitch(this,function(){d.callback([a,b])})),r.connect(e,"onError",function(e){delete b.bingMapsKey;
a.itemData=da(c);e=a.itemData.baseMap.baseMapLayers[0];e.errors=[];e.errors.push({message:"The owner of the map has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});d.callback([a,b])})):ca(a,b,c,d)}function ca(a,b,c,d){delete b.bingMapsKey;a.itemData=da(c);c=a.itemData.baseMap.baseMapLayers[0];c.errors=[];c.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."});d.callback([a,b])}function da(a){a.baseMap=
"BingMapsAerial"===a.baseMap.baseMapLayers[0].type?{title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:"BingMapsRoad"===a.baseMap.baseMapLayers[0].type?{title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:{title:"Imagery with Labels",baseMapLayers:[{id:"World_Imagery_6611",
opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};return a}function ma(a,b,c,d){var e=a.dynamicLayerInfos||a.layerInfos,f=b.layers;if(f&&e)if(d.usePopupManager){var g;l.forEach(e,function(a){var b=a.id;if(!a.subLayerIds)for(a=0;a<f.length;a++){var d=f[a];
if(d.id===b&&d.popupInfo){g||(g={});g[b]={infoTemplate:new c(d.popupInfo),layerUrl:d.layerUrl};break}}});g&&a.setInfoTemplates(g)}else{var k=[],h=[],n=[],q=[],p=[],r=[];l.forEach(e,function(b){var c=b.id;if(!b.subLayerIds&&-1!==l.indexOf(a.visibleLayers,c))for(b=0;b<f.length;b++){var d=f[b];if(d.id===c){h.push(c);k.push(d.popupInfo);n.push(d.layerUrl||"");d.layerDefinition&&d.layerDefinition.definitionExpression?q.push(d.layerDefinition.definitionExpression):q.push("");p.push(m.isDefined(d.minScale)?
d.minScale:null);r.push(m.isDefined(d.maxScale)?d.maxScale:null);break}}});k.length&&(a.__popups=k,a.__popupIds=h,a.__popupUrls=n,a.__popupWhereClauses=q,a.__popupMinScales=p,a.__popupMaxScales=r,a.__resourceInfo=b.resourceInfo)}}function na(a){if(!a)return!1;var b=(new e(O.arcgisUrl)).authority;return-1!==a.indexOf(".arcgis.com/")||-1!==a.indexOf(b)}function wa(a){return!a?!1:-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/")}function U(a){if("https:"===location.protocol&&
(na(a)||wa(a)))a=a.replace("http:","https:");return a}function oa(a,b,c){var d=[],e;a.displayLevels||(d=l.map(a.resourceInfo.tileInfo.lods,function(a){return a.level}));a.exclusionAreas&&(e=f.clone(a.exclusionAreas),e=l.map(e,function(a){a.geometry=new v(a.geometry);return a}));d=new I(U(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,displayLevels:a.displayLevels||d,id:a.id,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval,exclusionAreas:e});c.ignorePopups||
ma(d,a,b,c);return d}function pa(a,b){if(!a||!b||0===b.length)return[];var c=","+b+",",d=[],e,f=",";for(e=0;e<a.length;e++)if(null!==a[e].subLayerIds){if(-1===c.indexOf(","+a[e].id+",")||-1<f.indexOf(","+a[e].id+","))f+=a[e].subLayerIds.toString()+","}else-1<c.indexOf(","+a[e].id+",")&&-1===f.indexOf(","+a[e].id+",")&&d.push(a[e].id);return d}function xa(a,b,c){var d=new J;d.format="png24";a.resourceInfo&&(a.resourceInfo.supportedImageFormatTypes&&-1<a.resourceInfo.supportedImageFormatTypes.indexOf("PNG32"))&&
(d.format="png32");var d=new S(U(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageParameters:d,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval}),e=a.visibleLayers;if(!a.visibleLayers){var g="";l.forEach(d.layerInfos,function(a){a.defaultVisibility&&(g+=(0<g.length?",":"")+a.id)});e=g}if(a.layers&&0<a.layers.length){var k=[],h=[],m,n=[],q,p;l.forEach(a.layers,function(b){b.layerDefinition&&b.layerDefinition.definitionExpression&&(k[b.id]=
b.layerDefinition.definitionExpression);if(b.layerDefinition&&b.layerDefinition.source){m=null;p=b.layerDefinition.source;if("mapLayer"===p.type){var c=l.filter(a.resourceInfo.layers,function(a){return a.id===p.mapLayerId});c.length&&(m=f.mixin(c[0],b))}else m=f.mixin({},b);m&&(m.source=p,delete m.popupInfo,m=new X(m),a.visibleLayers&&(c="string"==typeof a.visibleLayers?a.visibleLayers.split(","):a.visibleLayers,-1<l.indexOf(c,b.id)?m.defaultVisibility=!0:m.defaultVisibility=!1),h.push(m))}b.layerDefinition&&
(b.layerDefinition.source&&b.layerDefinition.drawingInfo)&&(q=new M(b.layerDefinition.drawingInfo),n[b.id]=q)},this);0<k.length&&d.setLayerDefinitions(k);0<h.length?(d.setDynamicLayerInfos(h,!0),0<n.length&&d.setLayerDrawingOptions(n,!0)):(e=pa(d.layerInfos,e),d.setVisibleLayers(e))}else e=pa(d.layerInfos,e),d.setVisibleLayers(e);c.ignorePopups||ma(d,a,b,c);return d}function Na(a,b,c){var d=new P;d.bandIds=a.bandIds;null!=a.format&&(d.format=a.format,null!=a.compressionQuality&&(d.compressionQuality=
a.compressionQuality));if(a.renderingRule&&a.renderingRule.rasterFunction){var e=new T(a.renderingRule);d.renderingRule=e}a.mosaicRule&&(e=new ja(a.mosaicRule),d.mosaicRule=e);m.isDefined(a.noData)&&(d.noData=a.noData);m.isDefined(a.noDataInterpretation)&&(d.noDataInterpretation=a.noDataInterpretation);m.isDefined(a.interpolation)&&(d.interpolation=a.interpolation);d=new R(U(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageServiceParameters:d,minScale:a.minScale,
maxScale:a.maxScale,refreshInterval:a.refreshInterval});a.layerDefinition&&a.layerDefinition.definitionExpression&&d.setDefinitionExpression(a.layerDefinition.definitionExpression,!0);!c.ignorePopups&&a.popupInfo&&d.setInfoTemplate(new b(a.popupInfo));return d}function ra(a,b,c){var d=[102113,102100,3857],e=c||new k(b[0].layerObject.fullExtent.spatialReference),f=new k(a.resourceInfo.fullExtent.spatialReference);return e.wkt==f.wkt&&(e.wkid==f.wkid||m.isDefined(e.latestWkid)&&e.latestWkid==f.wkid||
m.isDefined(f.latestWkid)&&e.wkid==f.latestWkid||m.isDefined(e.latestWkid)&&e.latestWkid==f.latestWkid)||e.wkid&&f.wkid&&l.some(d,function(a){return a===f.wkid})&&l.some(d,function(a){return a===e.wkid})?!0:!1}function sa(a,b){if(!b[0].layerObject.tileInfo)return!1;var c=[];l.forEach(b,function(a){a.baseMapLayer&&a.layerObject.tileInfo&&(c=c.concat(l.map(a.layerObject.tileInfo.lods,function(a){return a.scale})))});return l.some(a.resourceInfo.tileInfo.lods,function(a){return l.some(c,function(b){return b===
a.scale})})}function ta(a,b,c,d,e){var h,p=c._clazz;if("OpenStreetMap"===a.type)h=new ia({id:a.id,opacity:a.opacity,visible:null!==a.visibility&&void 0!==a.visibility?a.visibility:!0});else if("WMS"===a.type){var q=[],s=[];l.forEach(a.layers,function(a){s.push(new ka({name:a.name,title:a.title,legendURL:a.legendURL}));q.push(a.name)},this);a.visibleLayers&&(q=a.visibleLayers);d={extent:new v(a.extent[0][0],a.extent[0][1],a.extent[1][0],a.extent[1][1],new k({wkid:4326})),layerInfos:s,version:a.version,
maxWidth:a.maxWidth,maxHeight:a.maxHeight,getMapURL:a.mapUrl,spatialReferences:a.spatialReferences,title:a.title,copyright:a.copyright,minScale:a.minScale||0,maxScale:a.maxScale||0,format:a.format};h=new G(a.url,{id:a.id,visibleLayers:q,format:"png",transparent:a.baseMapLayer?!1:!0,opacity:a.opacity,visible:null!==a.visibility?a.visibility:!0,resourceInfo:d,refreshInterval:a.refreshInterval});h.spatialReference.wkid=d.spatialReferences[0]}else if("KML"===a.type){c=a.url;if(u.id&&(p=u.id.findCredential(n.urlToObject(O.arcgisUrl).path))){b=
O.arcgisUrl.substring(O.arcgisUrl.indexOf("//")+2,O.arcgisUrl.indexOf("/",O.arcgisUrl.indexOf("//")+3));e=b.split(".");e=e[e.length-2]+"."+e[e.length-1];var t=c.indexOf(e);-1<t&&(c="https://"+b+c.substring(t+e.length));c+="?token\x3d"+p.token}h=new E(c,{id:a.id,visible:null!==a.visibility?a.visibility:!0,outSR:d,refreshInterval:a.refreshInterval});r.connect(h,"onLoad",function(){(a.opacity||0===a.opacity)&&h.setOpacity(a.opacity);m.isDefined(a.minScale)&&m.isDefined(a.maxScale)&&h.setScaleRange(a.minScale,
a.maxScale);a.visibleFolders&&l.forEach(h.folders,function(b){-1<l.indexOf(a.visibleFolders,b.id)?h.setFolderVisibility(b,!0):h.setFolderVisibility(b,!1)},this)})}else"WebTiledLayer"===a.type?(h=new aa(a.templateUrl,{id:a.id,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent&&new v(a.fullExtent),initialExtent:a.fullExtent&&new v(a.fullExtent),subDomains:a.subDomains,tileInfo:a.tileInfo?new L(a.tileInfo):null,refreshInterval:a.refreshInterval}),
r.connect(h,"onLoad",function(){(m.isDefined(a.minScale)||m.isDefined(a.maxScale))&&h.setScaleRange(a.minScale,a.maxScale)})):"GeoRSS"===a.type?(h=new Q(a.url,{id:a.id,opacity:a.opacity,outSpatialReference:d,refreshInterval:a.refreshInterval}),r.connect(h,"onLoad",function(){!1===a.visibility&&h.hide();m.isDefined(a.minScale)&&m.isDefined(a.maxScale)&&h.setScaleRange(a.minScale,a.maxScale);var b=h.getFeatureLayers();l.forEach(b,function(c){a.pointSymbol&&"esriGeometryPoint"===c.geometryType?(c.renderer.symbol=
y.fromJson(a.pointSymbol),1===b.length&&(h.pointSymbol=y.fromJson(a.pointSymbol))):a.lineSymbol&&"esriGeometryPolyline"===c.geometryType?(c.renderer.symbol=y.fromJson(a.lineSymbol),1===b.length&&(h.polylineSymbol=y.fromJson(a.lineSymbol))):a.polygonSymbol&&"esriGeometryPolygon"===c.geometryType&&(c.renderer.symbol=y.fromJson(a.polygonSymbol),1===b.length&&(h.polygonSymbol=y.fromJson(a.polygonSymbol)))})})):"CSV"==a.type&&a.url?(d={layerDefinition:a.layerDefinition,columnDelimiter:a.columnDelimiter,
id:a.id?a.id:null,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,refreshInterval:a.refreshInterval},a.locationInfo&&(d.latitudeFieldName=a.locationInfo.latitudeFieldName,d.longitudeFieldName=a.locationInfo.longitudeFieldName),c.ignorePopups||(d.infoTemplate=new A(a.popupInfo?a.popupInfo:H.generateDefaultPopupInfo(a))),h=new Y(a.url,d)):a.layerDefinition&&!a.url?(d=g.fromJson(g.toJson(a)),delete d.id,delete d.opacity,delete d.visibility,h=new D(d,{id:a.id,opacity:a.opacity,visible:a.visibility,
outFields:["*"],autoGeneralize:!0}),!c.ignorePopups&&d.popupInfo&&h.setInfoTemplate(new p(d.popupInfo))):"BingMapsAerial"===a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===a.type?c.bingMapsKey?(d=F.MAP_STYLE_AERIAL_WITH_LABELS,"BingMapsAerial"===a.type?d=F.MAP_STYLE_AERIAL:"BingMapsRoad"===a.type&&(d=F.MAP_STYLE_ROAD),h=new F({bingMapsKey:c.bingMapsKey,mapStyle:d,opacity:a.opacity,id:a.id}),r.connect(h,"onError",f.hitch(this,function(a){a.errors=a.errors||[];a.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+
a.type+"]"})},a))):(a.errors=a.errors||[],a.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})):a.resourceInfo&&a.resourceInfo.mapName?h=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||ra(a,b,d)&&sa(a,e))?oa(a,p,c):xa(a,p,c):a.resourceInfo&&a.resourceInfo.pixelSizeX?h=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||ra(a,b,d)&&sa(a,e))?oa(a,p,c):Na(a,p,c):a.resourceInfo&&"Feature Layer"===a.resourceInfo.type&&
(a.capabilities&&(a.resourceInfo.capabilities=a.capabilities),h=new D(U(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,mode:na(a.url)?D.MODE_AUTO:m.isDefined(a.mode)?a.mode:D.MODE_ONDEMAND,outFields:["*"],autoGeneralize:!0,refreshInterval:a.refreshInterval}),!c.ignorePopups&&a.popupInfo&&h.setInfoTemplate(new p(a.popupInfo)),a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(d=x.fromJson(a.layerDefinition.drawingInfo.renderer),
d.isMaxInclusive=!0,h.setRenderer(d)),a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.labelingInfo&&(d=l.map(a.layerDefinition.drawingInfo.labelingInfo,function(a){return new N(a)}),h.setLabelingInfo(d)),a.layerDefinition.definitionExpression&&h.setDefinitionExpression(a.layerDefinition.definitionExpression),m.isDefined(a.layerDefinition.minScale)&&h.setMinScale(a.layerDefinition.minScale),m.isDefined(a.layerDefinition.maxScale)&&h.setMaxScale(a.layerDefinition.maxScale)));h&&(h.arcgisProps=
{title:a.title},a.baseMapLayer&&(h._basemapGalleryLayerType=a.isReference?"reference":"basemap"));return h}function ua(a,b,c,d){l.forEach(a,function(e,f){if(e.url&&!e.type){if(0===f||a[0].layerObject)e.layerObject=ta(e,a,b,c,d)}else e.layerObject=ta(e,a,b,c,d)});var e=l.filter(a,function(a){return!a.isReference}),f=l.filter(a,function(a){return!!a.isReference});return a=e.concat(f)}function qa(a){var b=null;a=a[0];a.url&&!a.type?a.resourceInfo.spatialReference&&(b=new k,a.resourceInfo.spatialReference.wkid&&
(b.wkid=a.resourceInfo.spatialReference.wkid),a.resourceInfo.spatialReference.wkt&&(b.wkt=a.resourceInfo.spatialReference.wkt)):-1<a.type.indexOf("BingMaps")||"OpenStreetMap"==a.type?b=new k({wkid:102100}):"WMS"==a.type&&(b=new k({wkid:a.spatialReferences[0]}));return b}function ya(a,b,c,d,e,f,g){l.forEach(b,function(b,c){b.url&&!b.type&&(b.resourceInfo=a[b.deferredsPos][1],delete b.deferredsPos)});f=f||qa(b);b=ua(b,c,f,g);e.callback(b);return e}function za(a,b){var c=U(a);return h({url:c,content:{f:"json"},
callbackParamName:"callback",error:function(a,d){a.message=a.message?a.message+(" [url:"+c+"]"):"[url:"+c+"]";b.push(a);w.defaults.io.errorHandler(a,d)}})}function Aa(a){var b=O.arcgisUrl+"/"+a.itemId+"/data";return h({url:b,content:{f:"json"},callbackParamName:"callback",error:function(c,d){c.message=c.message?c.message+(" [url:"+b+"]"):"[url:"+b+"]";a.errors=a.errors||[];a.errors.push(c);w.defaults.io.errorHandler(c,d)}})}function Ba(a,b,c){var d=new q;if((!c.featureCollection||!c.featureCollection.layers)&&
!c.layers)return console.log("Invalid Feature Collection item data [item id: "+a.itemId+"]: ",c),a.errors=a.errors||[],a.errors.push({message:"Invalid Feature Collection item data. [item id: "+a.itemId+"]"}),d.errback(),d;c.layers&&(c.featureCollection={layers:c.layers},delete c.layers,m.isDefined(c.showLegend)&&(c.featureCollection.showLegend=c.showLegend,delete c.showLegend));Ca(a,c.featureCollection,b).then(function(b){c.featureCollection=b;a.featureCollection&&a.featureCollection.layers?l.forEach(c.featureCollection.layers,
function(b,c){var d=a.featureCollection.layers[c];if(!d.poupInfo&&!d.layerDefinition)d.popupInfo=b.popupInfo,d.layerDefinition=b.layerDefinition;else if(d.layerDefinition){if(m.isDefined(d.layerDefinition.minScale)&&m.isDefined(d.layerDefinition.maxScale)&&(d.layerDefinition.minScale!==b.layerDefinition.minScale||d.layerDefinition.maxScale!==b.layerDefinition.maxScale))delete b.layerDefinition.minscale,delete b.layerDefinition.maxScale;d.layerDefinition.drawingInfo&&g.toJson(d.layerDefinition.drawingInfo)!==
g.toJson(b.layerDefinition.drawingInfo)&&delete b.layerDefinition.drawingInfo;d.layerDefinition.showLegend!==b.layerDefinition.showLegend&&delete b.layerDefinition.showLegend;d.layerDefinition=f.mixin(d.layerDefinition,b.layerDefinition)}else d.layerDefinition=b.layerDefinition;d.featureSet=b.featureSet;d.nextObjectId=b.nextObjectId}):(a.featureCollection=a.featureCollection||{},a.featureCollection=f.mixin(a.featureCollection,c.featureCollection));d.callback(a)});return d}function Ca(a,c,d){var e=
new q,f=[];l.forEach(c.layers,function(a){a.featureSet&&(a.featureSet.features&&a.featureSet.features.length&&a.featureSet.features[0].geometry&&a.featureSet.features[0].geometry.spatialReference)&&(a.deferredsPos=f.length,f.push(H.projectFeatureCollection(a,d,a.featureSet.features[0].geometry.spatialReference)))});(new b(f)).addCallback(function(){l.forEach(c.layers,function(b){m.isDefined(b.deferredsPos)&&(f[b.deferredsPos].results&&f[b.deferredsPos].results.length?b=f[b.deferredsPos].results[0]:
(console.log("Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"),b.errors=b.errors||[],b.errors.push({message:"Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"})),delete b.deferredsPos)});e.callback(c)});return e}function ea(a,d,e,g){var h=new q,k=new q,m=[],n;l.forEach(a.operationalLayers,function(a){a.itemId&&"Feature Collection"==a.type&&m.push(Aa(a).then(f.hitch(null,Ba,a,e)))});0===m.length?Da(a,d,e,g,k):(n=new b(m),n.addCallback(function(b){Da(a,
d,e,g,k)}));k.then(function(a){m=[];l.forEach(a,function(a){a=a.layerObject;if(a instanceof D&&!a.loaded&&!a.loadError){var b=new q;c.once(a,"load, error",function(){b.callback(a)});m.push(b)}});if(m.length){var d=new q;n=new b(m);n.addCallback(function(){d.callback(a)});return d.promise}return a}).then(function(a){var b=[];l.forEach(a,function(a){if(a.layerObject instanceof D){var c=a.layerObject;c.loaded&&(c.labelingInfo&&(a.showLabels||c._collection))&&b.push(c)}});b.length?p(["../layers/LabelLayer"],
function(c){var d=new c;l.forEach(b,function(a){d.addFeatureLayer(a)});a.push({layerObject:d});h.callback(a)}):h.callback(a)});return h}function Da(a,c,d,e,f){var g=[],h=[],k=[];l.forEach(a.operationalLayers,function(a,b){a.featureCollection?l.forEach(a.featureCollection.layers,function(c,d){var e=!0;a.visibleLayers&&-1==l.indexOf(a.visibleLayers,d)&&(e=!1);c.visibility=a.visibility&&e;c.opacity=a.opacity;c.id=(a.id||"operational"+b)+"_"+d;k.push(c)},this):k.push(a)});l.forEach(a.baseMap.baseMapLayers,
function(a,b){a.baseMapLayer=!0;a.id=a.id||"base"+b;g.push(a)});l.forEach(k,function(a,b){a.id=a.id||"operational"+b;g.push(a)});l.forEach(g,function(a){a.url&&!a.type&&(a.deferredsPos=h.length,a.errors=a.errors||[],h.push(za(a.url,a.errors)))});0===h.length?(d=d||qa(g),g=ua(g,c,d,e),f.callback(g)):(new b(h)).addCallback(function(a){ya(a,g,c,h,f,d,e)});return f}function fa(a,b,c,d){var e=a.minScale,f=a.maxScale;if(10.1>=c.version&&b)for(a=b.length-1;0<=a;a--){if(b[a].id==d)if(0==e&&0<b[a].minScale?
e=b[a].minScale:0<e&&0==b[a].minScale?e=c.minScale:0<e&&0<b[a].minScale&&(e=Math.min(e,b[a].minScale)),f=Math.max(c.maxScale||0,b[a].maxScale||0),c.setScaleRange(e,f),-1<b[a].parentLayerId)d=b[a].parentLayerId;else break}else 10.1<c.version&&(l.forEach(a.layerInfos,function(a){a.id==d&&(0==e&&0<a.minScale?e=a.minScale:0<e&&0==a.minScale||0<e&&0<a.minScale&&(e=Math.min(e,a.minScale)),f=Math.max(f||0,a.maxScale||0))}),c.setScaleRange(e,f))}function ga(a,b,c,d){var e=a.url,g=a.__popupIds,h=a.__popupUrls,
k=a.__popupWhereClauses,n=a.__popupMinScales,p=a.__popupMaxScales,q=a.__resourceInfo,s=[];l.forEach(a.__popups,function(d,f){if(d){var t,u=[];l.forEach(d.fieldInfos,function(a){"shape"!==a.fieldName.toLowerCase()&&u.push(a.fieldName)});if(a.dynamicLayerInfos&&0<a.dynamicLayerInfos.length){var v=l.filter(a.dynamicLayerInfos,function(a){return g[f]==a.id})[0].source;t=new D(e+"/dynamicLayer",{id:a.id+"_"+g[f],source:v,outFields:u,mode:D.MODE_SELECTION,infoTemplate:d&&new c(d),drawMode:!1,visible:a.visible,
autoGeneralize:!0});var w=function(c,d){0<k[c].length&&d.setDefinitionExpression(k[c]);if(!m.isDefined(n[c])&&!m.isDefined(p[c]))fa(a,b||q.layers,d,g[c]);else if(m.isDefined(a.minScale)||m.isDefined(a.maxScale)){var e=a.minScale,f=a.maxScale;0==e&&0<n[c]?e=n[c]:0<e&&0==n[c]||0<e&&0<n[c]&&(e=Math.min(e,n[c]));f=Math.max(f||0,p[c]||0);d.setScaleRange(e,f)}else d.setScaleRange(n[c],p[c])};t.loaded?w(f,t):r.connect(t,"onLoad",function(a){w(f,t)})}else{var x=null,y=e+"/"+g[f];if(h[f].length)y=h[f];else if(b)for(v=
0;v<b.length;v++)if(b[v].id===g[f]){x=b[v];break}t=new D(U(y),{id:a.id+"_"+g[f],outFields:u,mode:D.MODE_SELECTION,infoTemplate:d&&new c(d),drawMode:!1,visible:a.visible,resourceInfo:x,autoGeneralize:!0});t.loaded?(0<k[f].length&&t.setDefinitionExpression(k[f]),fa(a,b||q.layers,t,g[f])):r.connect(t,"onLoad",function(c){0<k[f].length&&t.setDefinitionExpression(k[f]);fa(a,b||q.layers,c,g[f])})}s.push(t)}});0<s.length&&(r.connect(a,"onVisibilityChange",f.hitch(this,function(a,b){l.forEach(a,function(a){b?
a.show():a.hide()})},s)),r.connect(d,"onLayerRemove",f.hitch(this,function(a,b,c){a.id===c.id&&l.forEach(b,function(a){d.removeLayer(a)})},a,s)));delete a.__popups;delete a.__popupIds;delete a.__popupUrls;delete a.__popupWhereClauses;delete a.__popupMinScales;delete a.__popupMaxScales;delete a.__resourceInfo;return s}function Ea(a){return h({url:U(a.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}})}function Fa(a,c,d){var e=[];l.forEach(a,function(a){var b=a.__popups;
b&&(1<b.length&&10<=a.version)&&(a.__deferredsPos=e.length,e.push(Ea(a)))});var f=[];0<e.length?(new b(e)).addCallback(function(b){l.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(a.__deferredsPos||0===a.__deferredsPos?(f=f.concat(ga(a,b[a.__deferredsPos][1].layers,d,c)),delete a.__deferredsPos):f=f.concat(ga(a,null,d,c)))});c.addLayers(f)}):(l.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(f=f.concat(ga(a,null,d,c)))}),c.addLayers(f))}function Ga(a){l.forEach(a,function(a){var b=
a.layer;b.toJson&&(a=b.toJson(),a.featureSet&&-1<b.name.indexOf("Text")&&l.forEach(a.featureSet.features,function(a,c){if(a.attributes.TEXT){var d=b.graphics[c];d.symbol.setText(a.attributes.TEXT);a.symbol.horizontalAlignment&&(d.symbol.align=a.symbol.horizontalAlignment);d.setSymbol(d.symbol);d.setAttributes(a.attributes)}},this))})}function Ha(a){var b=6;l.forEach(a,function(a){if(a=a.renderer)"esri.renderer.SimpleRenderer"===a.declaredClass?((a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset))),
a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))):("esri.renderer.UniqueValueRenderer"===a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)&&l.forEach(a.infos,function(a){(a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset)));a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))})});return b}function va(a){var b=this,c=b.infoWindow,d=a.graphic;if(b.loaded){c.hide();c.clearFeatures();var e=[];l.forEach(b.graphicsLayerIds,function(a){if((a=b.getLayer(a))&&-1!==a.declaredClass.indexOf("FeatureLayer")&&
a.loaded&&a.visible)a.clearSelection(),a.infoTemplate&&!a.suspended&&e.push(a)});l.forEach(b.layerIds,function(a){(a=b.getLayer(a))&&(-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")&&a.loaded&&a.visible&&a.infoTemplate)&&e.push(a)});d=d&&d.getInfoTemplate()?d:null;if(e.length||d){var f=Ha(e),g=a.screenPoint,h=b.toMap(new s(g.x-f,g.y+f)),f=b.toMap(new s(g.x+f,g.y-f)),h=new v(h.x,h.y,f.x,f.y,b.spatialReference),k=new B;k.geometry=h;k.timeExtent=b.timeExtent;var m=!0,h=l.map(e,function(b){var c;
-1!==b.declaredClass.indexOf("ArcGISImageServiceLayer")?(k.geometry=a.mapPoint,m=!1,c=b.queryVisibleRasters(k,{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),c.addCallback(function(){return b.getVisibleRasters()})):(c=b.selectFeatures(k),c.addCallback(function(){return b.getSelectedFeatures()}));return c});d&&(f=new q,f.callback([d]),h.splice(0,0,f));if(!l.some(h,function(a){return-1===a.fired})){var n=d?1:0;l.forEach(e,function(a){n=-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?
n+a.getVisibleRasters().length:n+a.getSelectedFeatures().length});if(!n)return}c.setFeatures(h);c.show(a.mapPoint,{closestFirst:m})}}}function Oa(b,c){var e=c.mapOptions||{},f;e.infoWindow||(f=new z({visibleWhenEmpty:!1},d.create("div")),e.infoWindow=f);!m.isDefined(e.showInfoWindowOnClick)&&!c.usePopupManager&&(e.showInfoWindowOnClick=!1);e=new a(b,e);r.connect(e,"onLayersAddResult",Ga);return e}function V(a,b,c,d,e,f){var g,h,k,m;d.map?(g=d.map,h=d.clickEventHandle,k=d.clickEventListener,m=d.errors):
(g=Oa(d,e),!e.ignorePopups&&(!e.disableClickBehavior&&!e.usePopupManager)&&(h=r.connect(g,"onClick",va),k=va));g.addLayers(a);!e.ignorePopups&&!e.usePopupManager&&Fa(a,g,e._clazz);var n=m||[];l.forEach(b,function(a){a.errors&&(n=n.concat(a.errors))},this);g.loaded?f.callback({map:g,itemInfo:c,errors:n,clickEventHandle:h,clickEventListener:k}):r.connect(g,"onLoad",function(){f.callback({map:g,itemInfo:c,errors:n,clickEventHandle:h,clickEventListener:k})})}function ha(a,b,c,d,e){var g=[];l.forEach(e,
function(a){f.isArray(a.layerObject)?l.forEach(a.layerObject,function(a){g.push(a)}):g.push(a.layerObject)});if("BingMapsAerial"===e[0].type||"BingMapsRoad"===e[0].type||"BingMapsHybrid"===e[0].type)var h=setInterval(function(){if(e[0].layerObject&&e[0].layerObject.loaded)clearInterval(h),Ia(a,b,c,d,e,g);else if(e[0].errors){clearInterval(h);var f="";e[0].errors&&e[0].errors.length&&(f=" ("+e[0].errors[0].message+")");d.errback(Error(Z.arcgis.utils.baseLayerError+f))}},10);else if(!g[0]&&e[0].baseMapLayer){var k=
"";e[0].errors&&e[0].errors.length&&(k=" ("+e[0].errors[0].message+")");d.errback(Error(Z.arcgis.utils.baseLayerError+k))}else Ia(a,b,c,d,e,g)}function Ia(a,b,c,d,e,f){try{var g=c.mapOptions||{};c.mapOptions=g;var h=a.item;f=l.filter(f,m.isDefined);if(h)if(h.extent&&h.extent.length)if(g.extent)V(f,e,a,b,c,d);else{var n=new v(h.extent[0][0],h.extent[0][1],h.extent[1][0],h.extent[1][1],new k({wkid:4326})),p=f[0].spatialReference;4326===p.wkid?(g.extent=n,V(f,e,a,b,c,d)):102100===p.wkid||102113===p.wkid||
3857===p.wkid?(n.xmin=Math.max(n.xmin,-180),n.xmax=Math.min(n.xmax,180),n.ymin=Math.max(n.ymin,-89.99),n.ymax=Math.min(n.ymax,89.99),g.extent=t.geographicToWebMercator(n),V(f,e,a,b,c,d)):c.geometryServiceURL||w.defaults.geometryService?(c.geometryServiceURL?new C(c.geometryServiceURL):w.defaults.geometryService).project([n],p,function(h){h=h[0];g.extent=g.extent||h;V(f,e,a,b,c,d)},function(){V(f,e,a,b,c,d)}):d.errback(Error(Z.arcgis.utils.geometryServiceError))}else V(f,e,a,b,c,d);else V(f,e,a,b,
c,d)}catch(q){d.errback(q)}}function Ja(a){var b=[];a=a.baseMap.baseMapLayers.concat(a.operationalLayers);l.forEach(a,function(a,c){var d={};if(a.featureCollection&&"CSV"!==a.type)!0===a.featureCollection.showLegend&&l.forEach(a.featureCollection.layers,function(c){!1!==c.showLegend&&(d={layer:c.layerObject,title:a.title,defaultSymbol:c.renderer&&c.renderer.defaultSymbol&&c.renderer.defaultLabel?!0:!1},1<a.featureCollection.layers.length&&(d.title+=" - "+c.layerDefinition.name),b.push(d))});else if(a.baseMapLayer&&
!0===a.showLegend&&a.layerObject||!a.baseMapLayer&&!1!==a.showLegend&&a.layerObject){var e=a.layerObject.renderer,e=!e||e&&e.defaultSymbol&&e.defaultLabel?!0:!1;if(10.1>a.layerObject.version&&(a.layerObject instanceof S||a.layerObject instanceof I)||a.layerObject instanceof R)e=!0;d={layer:a.layerObject,title:a.title,defaultSymbol:e};a.layers&&(e=l.map(l.filter(a.layers,function(a){return!1===a.showLegend}),function(a){return a.id}),e.length&&(d.hideLayers=e));b.push(d)}});return b}function Ka(a,
b,c,d){Ma(d,b).then(function(b){var d=b[0],e=b[1];if(!d.itemData.operationalLayers||0===d.itemData.operationalLayers.length)ba(d,e).addCallback(function(b){ea(b.itemData,e).addCallback(f.hitch(null,ha,b,a,e,c))});else{var g=new q,h=d.itemData.baseMap.baseMapLayers.slice(0),k=l.filter(d.itemData.baseMap.baseMapLayers,function(a){return!a.isReference});b={item:d.item,itemData:{baseMap:{baseMapLayers:k}}};d.itemData.baseMap.baseMapLayers=l.filter(d.itemData.baseMap.baseMapLayers,function(a){return a.isReference});
ba(b,e).addCallback(function(b){ea(b.itemData,e).addCallback(f.hitch(null,ha,b,a,e,g))});g.then(function(a){ba(d,e).addCallback(function(b){ea(b.itemData,e,a.map.spatialReference,k).addCallback(function(d){b.itemData.baseMap.baseMapLayers=h;ha(b,a,e,c,d)})})},f.hitch(c,c.errback))}})}function La(a){O._arcgisUrl&&0<O._arcgisUrl.length&&(O.arcgisUrl=O._arcgisUrl);var b=O.arcgisUrl+"/"+a,c={},d=new q;h({url:b,content:{f:"json"},callbackParamName:"callback",load:function(a){c.item=a;h({url:b+"/data",
content:{f:"json"},callbackParamName:"callback",load:function(a){c.itemData=a;d.callback(c)},error:function(a){d.errback(a)}})},error:function(a){d.errback(a)}});return d}String.prototype.endsWith=function(a){return this.match(a+"$")==a};var O;O={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:La,createMap:function(a,b,c){var d=new q;c=c||{};var e=c.infoTemplateClass;c._clazz=e&&(f.isObject(e)?e:f.getObject(e))||A;f.isString(a)?La(a).addCallback(f.hitch(null,Ka,b,
c,d)).addErrback(f.hitch(d,d.errback)):Ka(b,c,d,a);return d},getLegendLayers:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?Ja(a.itemInfo.itemData):[]},_arcgisUrl:null,_getItemProps:ba,_getItemData:W,_getBingKey:$,_portalUrlResponse:la,_portalUrlFailure:ca,_processFSItemProperties:K,_getLayers:ea,_preBuildLayerObjects:ya,_buildLayerObjects:ua,_preCreateMap:ha,_getMapSR:qa,_createMap:V,_addSelectionLayers:Fa,_createSelectionFeatureLayers:ga,_getServiceInfo:za,_getFeatureCollectionItem:Aa,_mergeFeatureCollectionItem:Ba,
_projectFeatureCollection:Ca,_getLayersInfo:Ea,_initLayer:ta,_loadAsCached:oa,_loadAsDynamic:xa,_processPopups:ma,_onLayersAddResult:Ga,_sameSpatialReferenceAsBasemap:ra,_sameTilingSchemeAsBasemap:sa,_showPopup:va,_calculateClickTolerance:Ha,_getVisibleFeatureLayers:pa,_updateLayerScaleInfo:fa,_checkUrl:U,_isHostedService:na,_isAgolService:wa,_getLegendLayers:Ja};f.setObject("arcgis.utils",O,u);return O});